<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×”×¦×¢×•×ª ××—×™×¨ - ×‘××œ×™ ×§×¨×•×– (Full Version)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        
        /* Sticky Preview Fix */
        .sticky-preview-container {
            position: sticky;
            top: 20px;
            height: calc(100vh - 40px);
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        /* PDF Specifics */
        .pdf-page {
            background: white;
            width: 100%;
            max-width: 210mm;
            min-height: 297mm;
            padding: 10mm;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .pdf-spacer { display: block; width: 100%; height: 20px; }
        .no-split { break-inside: avoid; page-break-inside: avoid; }

        @media print {
            body * { visibility: hidden; }
            #previewSection, #previewSection * { visibility: visible; }
            #previewSection { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; }
            .sticky-preview-container { position: static; height: auto; overflow: visible; box-shadow: none; }
            .no-print { display: none !important; }
        }

        /* Form styling */
        input, select, textarea { 
            border: 1px solid #d1d5db; 
            border-radius: 0.375rem; 
            padding: 0.5rem; 
            width: 100%; 
            transition: border-color 0.2s;
        }
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: #2563eb; 
            box-shadow: 0 0 0 3px rgba(37,99,235,0.1); 
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="loginModal" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold text-blue-900 mb-6">×›× ×™×¡×” ×œ××¢×¨×›×ª</h2>
            <select id="loginSelect" class="mb-4 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5">
                <option value="">×‘×—×¨ ×™×•×¢×¥...</option>
            </select>
            <input type="password" id="loginPass" placeholder="×¡×™×¡××”" class="mb-4">
            <p id="loginError" class="text-red-500 text-sm hidden mb-2">×¡×™×¡××” ×©×’×•×™×”</p>
            <button onclick="attemptLogin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition">×”×ª×—×‘×¨</button>
        </div>
    </div>

    <div id="app" class="hidden w-full max-w-[1900px] mx-auto p-4 flex-grow">
        <header class="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm no-print">
            <div>
                <h1 class="text-2xl font-bold text-blue-900">××—×•×œ×œ ×”×¦×¢×•×ª ××—×™×¨</h1>
                <p class="text-sm text-gray-500">××—×•×‘×¨ ×›: <span id="advisorNameDisplay" class="font-bold"></span></p>
            </div>
            <div class="flex gap-2">
                <button onclick="resetForm()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded">×”×¦×¢×” ×—×“×©×”</button>
                <button onclick="generatePDF()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded flex items-center gap-2">
                    <span>×”×•×¨×“ PDF</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                </button>
            </div>
        </header>

        <div class="flex flex-col xl:flex-row gap-6">
            
            <div class="w-full xl:w-1/2 no-print">
                <form id="quoteForm" class="bg-white p-6 rounded-xl shadow-lg space-y-6">
                    
                    <section>
                        <h3 class="text-lg font-bold border-b pb-2 mb-4 text-gray-700">×¤×¨×˜×™ ×”×”×¦×¢×”</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">×¡×•×’ ××¡××š</label>
                                <div class="flex gap-4 mt-2">
                                    <label class="flex items-center cursor-pointer"><input type="radio" name="docType" value="quote" checked onchange="updatePreview()" class="ml-2">×”×¦×¢×ª ××—×™×¨</label>
                                    <label class="flex items-center cursor-pointer"><input type="radio" name="docType" value="confirmation" onchange="updatePreview()" class="ml-2">××™×©×•×¨ ×”×–×× ×”</label>
                                </div>
                            </div>
                            <div><label class="block text-sm font-medium mb-1">×ª××¨×™×š</label><input type="date" id="offerDate" onchange="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1">×©× ×œ×§×•×—</label><input type="text" id="clientName" oninput="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1">×˜×œ×¤×•×Ÿ ×œ×§×•×—</label><input type="text" id="clientPhone" oninput="updatePreview()"></div>
                        </div>
                    </section>

                    <section class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <div class="flex justify-between mb-4">
                            <h3 class="text-lg font-bold text-blue-900">×¤×¨×˜×™ ×”×©×™×™×˜</h3>
                            <label class="text-xs text-red-500 flex items-center cursor-pointer font-bold"><input type="checkbox" id="hideCruise" onchange="updatePreview()" class="mr-1 ml-1"> ×”×¡×ª×¨ ×©×™×™×˜</label>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><label class="block text-sm font-medium mb-1">×—×‘×¨×ª ×©×™×™×˜</label><select id="cruiseLine" onchange="updateShips(); updatePreview()"></select></div>
                            <div><label class="block text-sm font-medium mb-1">××•× ×™×™×”</label><select id="shipName" onchange="updateShipDetails(); updatePreview()"></select></div>
                            <div><label class="block text-sm font-medium mb-1">×ª××¨×™×š ×™×¦×™××”</label><input type="date" id="cruiseDate" onchange="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1">××©×š (×œ×™×œ×•×ª)</label><input type="number" id="cruiseDuration" value="7" oninput="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1">× ××œ ×™×¦×™××”</label><input type="text" id="portDep" oninput="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1">× ××œ ×—×–×¨×”</label><input type="text" id="portArr" oninput="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1 text-blue-700 font-bold">××¡×¤×¨ ×”×–×× ×”</label><input type="text" id="bookingNum" class="bg-white border-blue-300" oninput="updatePreview()"></div>
                            <div><label class="block text-sm font-medium mb-1 text-green-700 font-bold">×”×˜×‘×•×ª (OBC)</label><input type="text" id="benefits" class="bg-white border-green-300" oninput="updatePreview()"></div>
                            <div class="md:col-span-2"><label class="block text-sm font-medium mb-1">×œ×™× ×§ ×œ×•×™×“××•</label><input type="text" id="videoLink" oninput="updatePreview()"></div>
                        </div>

                        <div class="mt-4 bg-white p-3 rounded border border-dashed border-gray-400 text-center cursor-pointer hover:bg-gray-50" id="pasteArea" contenteditable="true">
                            <p class="text-gray-400 pointer-events-none">ğŸ“¸ ×œ×—×¥ ×›××Ÿ ×•×”×“×‘×§ ×ª××•× ×” (Ctrl+V)</p>
                        </div>
                        <div class="mt-2 flex gap-4">
                            <label class="text-sm"><input type="radio" name="itinType" value="image" checked onchange="updatePreview()" class="ml-1">×ª××•× ×”</label>
                            <label class="text-sm"><input type="radio" name="itinType" value="text" onchange="updatePreview()" class="ml-1">×˜×§×¡×˜</label>
                        </div>
                        <textarea id="itinText" class="hidden mt-2" rows="3" placeholder="×¤×™×¨×•×˜ ××¡×œ×•×œ ×™×“× ×™..." oninput="updatePreview()"></textarea>

                        <div class="mt-4">
                            <h4 class="font-bold text-sm mb-2">×—×“×¨×™×</h4>
                            <div id="roomsInputs" class="space-y-2"></div>
                            <button type="button" onclick="addRoom()" class="text-blue-600 text-sm font-bold mt-2 hover:underline">+ ×”×•×¡×£ ×—×“×¨</button>
                        </div>
                    </section>

                    <section class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold text-gray-700 mb-2">×˜×™×¡×•×ª</h3>
                        <div id="flightsInputs" class="space-y-2"></div>
                        <button type="button" onclick="addFlight()" class="text-blue-600 text-sm font-bold mt-2 hover:underline">+ ×”×•×¡×£ ×˜×™×¡×”</button>
                        
                        <div class="mt-4 grid grid-cols-1 gap-2">
                            <textarea id="flightIncludes" rows="2" placeholder="×›×•×œ×œ ×›×‘×•×“×”..." oninput="updatePreview()">××–×•×•×“×” 20 ×§"×’, ×˜×¨×•×œ×™ 7 ×§"×’</textarea>
                            <div class="border p-2 rounded bg-white">
                                <label class="font-bold text-sm block mb-1">×ª× ××™ ×‘×™×˜×•×œ ×˜×™×¡×”:</label>
                                <div class="flex gap-4 text-sm">
                                    <label><input type="radio" name="flightCancel" value="no" onchange="updatePreview()" class="ml-1"> ×œ×œ× ×”×—×–×¨</label>
                                    <label><input type="radio" name="flightCancel" value="yes" checked onchange="updatePreview()" class="ml-1"> ×“××™ ×‘×™×˜×•×œ</label>
                                </div>
                                <div id="flightFees" class="flex gap-2 mt-2">
                                    <input type="text" id="flightCancelFee" placeholder="×“××™ ×‘×™×˜×•×œ ($)" class="text-sm" oninput="updatePreview()">
                                    <input type="text" id="flightChangeFee" placeholder="×“××™ ×©×™× ×•×™ ($)" class="text-sm" oninput="updatePreview()">
                                </div>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-lg font-bold border-b pb-2 mb-4 text-gray-700">×ª×•×¡×¤×•×ª (××œ×•× ×•×ª/×”×¢×‘×¨×•×ª)</h3>
                        <div id="extrasInputs" class="space-y-2"></div>
                        <div class="flex gap-4 mt-2">
                            <button type="button" onclick="addHotel()" class="text-blue-600 text-sm font-bold hover:underline">+ ×”×•×¡×£ ××œ×•×Ÿ</button>
                            <button type="button" onclick="addTransfer()" class="text-blue-600 text-sm font-bold hover:underline">+ ×”×•×¡×£ ×”×¢×‘×¨×”</button>
                        </div>
                        <div class="mt-4">
                            <label class="text-sm font-bold">×¢×œ×•×ª ×›×•×œ×œ×ª ×œ×ª×•×¡×¤×•×ª ($)</label>
                            <input type="number" id="extrasCost" oninput="updatePreview()">
                        </div>
                    </section>

                    <section>
                        <label class="block text-sm font-medium mb-1">×”×¢×¨×•×ª × ×•×¡×¤×•×ª</label>
                        <textarea id="customNotes" rows="4" oninput="updatePreview()"></textarea>
                        <label class="flex items-center mt-2 font-bold"><input type="checkbox" id="hideTotal" onchange="updatePreview()" class="ml-2"> ×”×¡×ª×¨ ×¡×”"×› ×œ×ª×©×œ×•×</label>
                    </section>

                </form>
            </div>

            <div class="w-full xl:w-1/2 bg-gray-200 p-4 rounded-xl" id="previewContainer">
                <div class="sticky-preview-container custom-scrollbar">
                    <div id="previewSection" class="pdf-page text-gray-800">
                        
                        <div class="flex justify-between items-start border-b-2 border-gray-100 pb-4 mb-6">
                            <img src="https://balicruise.co.il/wp-content/uploads/2023/02/bali-cruise-logo500-X-145-Custom.png" alt="Logo" class="h-16">
                            <div class="text-left text-sm">
                                <p id="prevDate"></p>
                                <p class="font-bold text-lg mt-1" id="prevTitle">×”×¦×¢×ª ××—×™×¨</p>
                            </div>
                        </div>

                        <div class="mb-6">
                            <p class="text-xl">×œ×›×‘×•×“ <span id="prevClientName" class="font-bold"></span>,</p>
                            <p id="prevOpening" class="mt-2 text-gray-600">×©××—×ª×™ ×œ×©×•×—×— ××™×ª×š, ×œ×”×œ×Ÿ ×¤×¨×˜×™ ×”×”×¦×¢×” ×›×¤×™ ×©×‘×™×§×©×ª:</p>
                        </div>

                        <div id="prevCruise" class="mb-6 border rounded-lg overflow-hidden border-blue-100 no-split">
                            <div class="bg-blue-50 p-3 flex justify-between items-center border-b border-blue-100">
                                <h3 class="font-bold text-blue-900 text-lg">âš“ ×¤×¨×˜×™ ×”×©×™×™×˜</h3>
                                <span id="prevShipNameDisplay" class="font-semibold text-blue-800"></span>
                            </div>
                            <div class="p-4 bg-white text-sm space-y-2">
                                <div class="grid grid-cols-2 gap-2">
                                    <p><span class="text-gray-500">×—×‘×¨×”:</span> <span id="prevLine" class="font-bold"></span></p>
                                    <p><span class="text-gray-500">×ª××¨×™×›×™×:</span> <span id="prevDates" class="font-bold"></span></p>
                                    <p><span class="text-gray-500">××©×š:</span> <span id="prevDuration" class="font-bold"></span> ×œ×™×œ×•×ª</p>
                                    <p><span class="text-gray-500">××¡×œ×•×œ:</span> <span id="prevRoute" class="font-bold"></span></p>
                                    <p id="prevBooking" class="hidden col-span-2 bg-gray-50 p-1 rounded"><span class="text-gray-500">×”×–×× ×”:</span> <span id="prevBookingVal" class="font-bold"></span></p>
                                    <p id="prevBenefits" class="hidden col-span-2 text-green-700 font-bold"></p>
                                </div>
                                
                                <div id="prevItinBox" class="my-4 border rounded overflow-hidden">
                                    <img id="prevItinImg" class="w-full object-contain max-h-60 bg-gray-50 hidden">
                                    <div id="prevItinTxt" class="p-4 whitespace-pre-wrap hidden"></div>
                                </div>

                                <div id="prevRooms" class="space-y-2"></div>
                                
                                <p id="guaranteeNote" class="hidden text-xs bg-yellow-50 text-yellow-800 p-2 rounded mt-2">
                                    * ×œ×ª×©×•××ª ×œ×‘×š: ×—×“×¨ ××¡×•×’ "×’×¨× ×˜×™" (Guarantee) ××©××¢×• ×©×—×‘×¨×ª ×”×©×™×™×˜ ××ª×—×™×™×‘×ª ×œ×§×˜×’×•×¨×™×” ×©× ×‘×—×¨×” (××• ×’×‘×•×”×” ×™×•×ª×¨), ××š ××™×§×•× ×”×—×“×¨ ×•×§×•××” ×™×™×§×‘×¢×• ×¢"×™ ×”×—×‘×¨×” ×‘×¡××•×š ×œ××•×¢×“ ×”×”×¤×œ×’×”.
                                </p>

                                <div class="mt-2 pt-2 border-t text-gray-600 text-xs">
                                    <p>â€¢ ××™×¨×•×— ×¢×œ ×‘×¡×™×¡ ×¤× ×¡×™×•×Ÿ ××œ×.</p>
                                    <p id="prevTips"></p>
                                </div>
                            </div>
                        </div>

                        <div id="prevExtras" class="space-y-4 mb-6">
                            <div id="prevFlights" class="border rounded-lg overflow-hidden border-gray-200 hidden no-split">
                                <div class="bg-gray-50 p-2 font-bold text-gray-700 border-b">âœˆï¸ ×˜×™×¡×•×ª</div>
                                <div class="p-3 bg-white text-sm space-y-2">
                                    <div id="prevFlightsList" class="space-y-1"></div>
                                    <div class="text-xs text-gray-500 border-t pt-2 mt-2" id="prevFlightIncludesTxt"></div>
                                    <div class="text-xs text-red-500 font-semibold" id="prevFlightPolicyTxt"></div>
                                </div>
                            </div>

                            <div id="prevOther" class="border rounded-lg overflow-hidden border-gray-200 hidden no-split">
                                <div class="bg-gray-50 p-2 font-bold text-gray-700 border-b">ğŸ¨ ×©×™×¨×•×ª×™ ×§×¨×§×¢ (××œ×•× ×•×ª/×”×¢×‘×¨×•×ª)</div>
                                <div class="p-3 bg-white text-sm" id="prevOtherList"></div>
                            </div>
                        </div>

                        <div id="prevTotalSection" class="bg-blue-900 text-white p-6 rounded-xl shadow-lg mb-6 no-split">
                            <div class="flex justify-between items-end">
                                <div>
                                    <h3 class="text-xl font-bold">×¡×™×›×•× ×¢×œ×•×™×•×ª</h3>
                                    <p class="text-blue-200 text-xs mt-1">×”××—×™×¨×™× × ×›×•× ×™× ×œ×¨×’×¢ ×–×” ×•×¢×©×•×™×™× ×œ×”×©×ª× ×•×ª.</p>
                                </div>
                                <div class="text-right">
                                    <div id="prevTotalDisplay" class="text-2xl font-bold"></div>
                                </div>
                            </div>
                            
                            <div id="prevPayment" class="hidden mt-4 pt-4 border-t border-blue-700 text-sm">
                                <p id="prevDeposit"></p>
                                <p id="prevFinal" class="font-bold text-green-300 mt-1"></p>
                            </div>
                        </div>

                        <div class="text-sm text-gray-600 no-split">
                            <h4 class="font-bold text-black mb-1">×”×¢×¨×•×ª:</h4>
                            <div id="prevNotesList" class="whitespace-pre-wrap mb-4"></div>
                            
                            <div class="border-t pt-4 mt-4 text-xs">
                                <p class="font-bold text-blue-900">×ª×•×“×” ×©×‘×—×¨×ª× ×œ×”×¤×œ×™×’ ××™×ª× ×•!</p>
                                <p id="prevAdvisorDetails" class="mt-1"></p>
                                <p class="text-gray-400 mt-2">××¡××š ×–×” ×”×•×¤×§ ×¢"×™ ××¢×¨×›×ª ×‘××œ×™ ×§×¨×•×– ×‘×ª××¨×™×š <span id="printDate"></span></p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- Data Configuration (The "Heavy" Parts) ---
    const advisors = {
        "lior": { name: "×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™", email: "lior@balicruise.co.il", pass: "lior1234", phone: "03-3106454" },
        "tatiana": { name: "×˜×˜×™×× ×” ×œ××•× ×•×‘", email: "tatiana@balicruise.co.il", pass: "tatiana1234", phone: "03-3106454" },
        "koren": { name: "×§×•×¨×Ÿ ××‘×¡×¢×™×“", email: "koren@balicruise.co.il", pass: "koren1234", phone: "03-3106454" },
        "yarden": { name: "×™×¨×“×Ÿ ×©×§×“", email: "yarden@balicruise.co.il", pass: "yarden1234", phone: "03-3106454" },
        "nir": { name: "× ×™×¨", email: "nir@balicruise.co.il", pass: "nir1234", phone: "03-3106454" },
        "natan": { name: "× ×ª×Ÿ", email: "natan@balicruise.co.il", pass: "natan1234", phone: "03-3106454" },
        "aviv": { name: "××‘×™×‘", email: "aviv@balicruise.co.il", pass: "aviv1234", phone: "03-3106454" },
        "adi": { name: "×¢×“×™", email: "adi@balicruise.co.il", pass: "adi1234", phone: "03-3106454" }
    };

    const cruiseData = {
        "MSC": [
            { "name": "MSC Preziosa", "video": "https://www.youtube.com/watch?v=LzWd7k_JqwE", "image": "https://i.postimg.cc/vBPv6qWq/MSC16008892.jpg" },
            { "name": "MSC Splendida", "video": "https://www.youtube.com/watch?v=wuI1iqyS80o", "image": "https://i.postimg.cc/250WHqV3/MSC13015955.jpg" },
            { "name": "MSC Magnifica", "video": "https://www.youtube.com/watch?v=3VNHV9rVLjk", "image": "https://i.postimg.cc/ZqbsQDxH/MSC19019079.jpg" },
            { "name": "MSC Musica", "video": "https://www.youtube.com/watch?v=ze1A0OJ5ddw", "image": "https://i.postimg.cc/5Nmwr9Kc/MSC13014701.jpg" },
            { "name": "MSC Orchestra", "video": "https://www.youtube.com/watch?v=eRnLETQwMLA", "image": "https://i.postimg.cc/nhPQ8XvW/MSC16006817.jpg" },
            { "name": "MSC Poesia", "video": "https://www.youtube.com/watch?v=Pfo49__jig0", "image": "https://i.postimg.cc/yxRmyYrN/MSC25037328.jpg" },
            { "name": "MSC Armonia", "video": "https://www.youtube.com/watch?v=QkVpYGrpb2M", "image": "https://i.postimg.cc/KzSpXwS4/MSC16006221-1.jpg" },
            { "name": "MSC Lirica", "video": "https://www.youtube.com/watch?v=hj0E3bOObdA", "image": "https://i.postimg.cc/MKSqwZJb/MSC16006932.jpg" },
            { "name": "MSC Opera", "video": "https://www.youtube.com/watch?v=TwdHj0Cod1M", "image": "https://i.postimg.cc/VvFTm8XD/MSC15004313.jpg" },
            { "name": "MSC Sinfonia", "video": "https://www.youtube.com/watch?v=LWH-o-XGAi4", "image": "https://i.postimg.cc/Y90j1rCm/MSC16006204.jpg" },
            { "name": "MSC Divina", "video": "https://www.youtube.com/watch?v=GnJp5B8jZbc", "image": "https://i.postimg.cc/HkTMrCXb/MSC13011902.jpg" },
            { "name": "MSC Fantasia", "video": "https://www.youtube.com/watch?v=m_UlYTVhBzY", "image": "https://i.postimg.cc/MTwJSthZ/MSC13012071.jpg" },
            { "name": "MSC World America", "video": "https://www.youtube.com/watch?v=jYPYZEQxpHI", "image": "https://i.postimg.cc/MGkh7dZ0/MSC25040915.jpg" },
            { "name": "MSC World Asia", "video": "", "image": "https://i.postimg.cc/C1xJkq8H/MSC25035094.jpg" },
            { "name": "MSC World Europa", "video": "https://www.youtube.com/watch?v=DL6hnxPqUUo", "image": "https://i.postimg.cc/NM2DdwN5/MSC22013055.jpg" },
            { "name": "MSC Seashore", "video": "https://www.youtube.com/watch?v=KHqmnA5UDZo", "image": "https://i.postimg.cc/R0HJ8VB5/MSC21007729.jpg" },
            { "name": "MSC Seaside", "video": "https://www.youtube.com/watch?v=1ZNpczW1bL8", "image": "https://i.postimg.cc/4xrmzkh8/MSC18014069.jpg" },
            { "name": "MSC Seascape", "video": "https://www.youtube.com/watch?v=H2IwM2uoon0", "image": "https://i.postimg.cc/7PsswmzH/MSC21008179.jpg" },
            { "name": "MSC Seaview", "video": "https://www.youtube.com/watch?v=Fmxi2uJcjQg", "image": "https://i.postimg.cc/pdWz9tNg/MSC19018890.jpg" },
            { "name": "MSC Bellissima", "video": "https://www.youtube.com/watch?v=dkL4LSiilQo", "image": "https://i.postimg.cc/xjwxFgbc/MSC18013997.jpg" },
            { "name": "MSC Euribia", "video": "https://www.youtube.com/watch?v=PDtK-GM5MRM", "image": "https://i.postimg.cc/Sswr3NRw/MSC23019432.jpg" },
            { "name": "MSC Grandiosa", "video": "https://www.youtube.com/watch?v=5URU14l8EgE", "image": "https://i.postimg.cc/nr62DVqH/MSC19001443.jpg" },
            { "name": "MSC Meraviglia", "video": "https://www.youtube.com/watch?v=ql-b48h1oUw", "image": "https://i.postimg.cc/DzMxTcmJ/MSC17011157.jpg" },
            { "name": "MSC Virtuosa", "video": "https://www.youtube.com/watch?v=OLS9W9cMj1o", "image": "https://i.postimg.cc/bwF5yPBw/MSC18017765.jpg" }
        ],
        "Norwegian Cruise Line": [
            { "name": "Norwegian Aqua", "video": "https://www.youtube.com/watch?v=omxujspTlJw" },
            { "name": "Norwegian Bliss", "video": "https://www.youtube.com/watch?v=OtTbM6KUKCk" },
            { "name": "Norwegian Breakaway", "video": "https://www.youtube.com/watch?v=v2kFn36kW7w" },
            { "name": "Norwegian Dawn", "video": "https://www.youtube.com/watch?v=mHw-Gxxe4FA" },
            { "name": "Norwegian Encore", "video": "https://www.youtube.com/watch?v=87Ri0lawr_U" },
            { "name": "Norwegian Epic", "video": "https://www.youtube.com/watch?v=Syk85jAwues" },
            { "name": "Norwegian Escape", "video": "https://www.youtube.com/watch?v=09YP6AhVAVA" },
            { "name": "Norwegian Getaway", "video": "https://www.youtube.com/watch?v=DW9UgPpeXv0" },
            { "name": "Norwegian Jade", "video": "https://www.youtube.com/watch?v=HQ-X6Vr0Pu4" },
            { "name": "Norwegian Jewel", "video": "https://www.youtube.com/watch?v=DKwxb8UHJq8" },
            { "name": "Norwegian Joy", "video": "https://www.youtube.com/watch?v=HoKjNrNww0o" },
            { "name": "Norwegian Luna", "video": "https://www.youtube.com/watch?v=uK2uUAHEs3Q" },
            { "name": "Norwegian Pearl", "video": "https://www.youtube.com/watch?v=bV977mnd8FY" },
            { "name": "Norwegian Prima", "video": "https://www.youtube.com/watch?v=ugOF9hHC5U0" },
            { "name": "Norwegian Sky", "video": "https://www.youtube.com/watch?v=3k_inYuoEho" },
            { "name": "Norwegian Spirit", "video": "https://www.youtube.com/watch?v=-GPrS81xEkE" },
            { "name": "Norwegian Star", "video": "" },
            { "name": "Norwegian Sun", "video": "" },
            { "name": "Norwegian Viva", "video": "https://www.youtube.com/watch?v=LDCkEPw9cvk" },
            { "name": "Norwegian Gem", "video": "" },
            { "name": "Pride of America", "video": "" }
        ],
        "Royal Caribbean": [
            { "name": "Adventure of the Seas" }, { "name": "Allure of the Seas" }, { "name": "Anthem of the Seas" },
            { "name": "Brilliance of the Seas" }, { "name": "Enchantment of the Seas" }, { "name": "Explorer of the Seas" },
            { "name": "Freedom of the Seas" }, { "name": "Grandeur of the Seas" }, { "name": "Harmony of the Seas" },
            { "name": "Icon of the Seas" }, { "name": "Independence of the Seas" }, { "name": "Jewel of the Seas" },
            { "name": "Liberty of the Seas" }, { "name": "Mariner of the Seas" }, { "name": "Navigator of the Seas" },
            { "name": "Oasis of the Seas" }, { "name": "Odyssey of the Seas" }, { "name": "Ovation of the Seas" },
            { "name": "Quantum of the Seas" }, { "name": "Radiance of the Seas" }, { "name": "Rhapsody of the Seas" },
            { "name": "Serenade of the Seas" }, { "name": "Spectrum of the Seas" }, { "name": "Star of the Seas" },
            { "name": "Symphony of the Seas" }, { "name": "Utopia of the Seas" }, { "name": "Wonder of the Seas" }
        ],
        "CELEBRITY": [{ "name": "Celebrity Apex" }, { "name": "Celebrity Ascent" }, { "name": "Celebrity Beyond" }, { "name": "Celebrity Edge" }, { "name": "Celebrity Millennium" }, { "name": "Celebrity Solstice" }],
        "COSTA": [{ "name": "Costa Smeralda" }, { "name": "Costa Toscana" }, { "name": "Costa Deliziosa" }, { "name": "Costa Fascinosa" }],
        "Disney Cruise Line": [{ "name": "Disney Magic" }, { "name": "Disney Wonder" }, { "name": "Disney Dream" }, { "name": "Disney Fantasy" }, { "name": "Disney Wish" }],
        "Carnival": [{ "name": "Carnival Celebration" }, { "name": "Carnival Mardi Gras" }, { "name": "Carnival Jubilee" }],
        "Mano": [{ "name": "Crown Iris" }],
        "P&O Cruises": [{ "name": "Arvia" }, { "name": "Iona" }],
        "Cunard": [{ "name": "Queen Mary 2" }, { "name": "Queen Anne" }]
    };

    const currencies = {
        'COSTA': 'â‚¬', 'P&O Cruises': 'Â£', 'Mano': 'â‚¬', 'Cunard': 'Â£'
    };

    // Deposit Logic
    const depositAmounts = {
        'MSC': () => '500$ ×‘×¢×‘×•×¨ ×›×œ ×—×“×¨',
        'Norwegian Cruise Line': () => '350$ ×‘×¢×‘×•×¨ ×›×œ ×—×“×¨',
        'Virgin Voyages': () => '500$ ×‘×¢×‘×•×¨ ×›×œ ×—×“×¨',
        'Oceania Cruises': () => '250$ ×‘×¢×‘×•×¨ ×›×œ ×—×“×¨ (×“××™ ×˜×™×¤×•×œ)',
        'Azamara': () => '550$ ×‘×¢×‘×•×¨ ×›×œ ×—×“×¨',
        'Royal Caribbean': (dur, pax, rooms) => dur <= 5 ? (pax * 105 + rooms * 100) + '$' : (pax * 170 + rooms * 100) + '$',
        'CELEBRITY': (dur, pax, rooms) => dur <= 5 ? (pax * 105 + rooms * 100) + '$' : (dur <= 14 ? (pax * 170 + rooms * 100) + '$' : (pax * 490 + rooms * 100) + '$'),
        'Carnival': (dur) => dur <= 5 ? '300$ ×œ××“×' : '500$ ×œ××“×',
        'COSTA': (dur, pax, rooms) => (pax * 100 + rooms * 100) + 'â‚¬',
        'Disney Cruise Line': () => '20% ××¢×œ×•×ª ×”×”×¤×œ×’×”',
        'Mano': () => '××§×“××” ×›×—×•×§ (5% ××• 100â‚ª ×”× ××•×š ××‘×™× ×™×”×)',
        'Default': () => '20% ××¢×œ×•×ª ×”×”×¤×œ×’×”'
    };

    let currentUser = null;

    // --- Init ---
    window.onload = function() {
        const sel = document.getElementById('loginSelect');
        Object.keys(advisors).forEach(key => {
            const opt = document.createElement('option');
            opt.value = key;
            opt.textContent = advisors[key].name;
            sel.appendChild(opt);
        });

        const cruiseSel = document.getElementById('cruiseLine');
        Object.keys(cruiseData).forEach(key => {
            const opt = document.createElement('option');
            opt.value = key;
            opt.textContent = key;
            cruiseSel.appendChild(opt);
        });
        
        // Default Date
        document.getElementById('offerDate').valueAsDate = new Date();
        document.getElementById('printDate').textContent = new Date().toLocaleDateString('he-IL');

        // Paste Listener
        document.getElementById('pasteArea').addEventListener('paste', handlePaste);
        
        // Start fresh
        addRoom();
        addFlight(); 
        updateShips();
    };

    // --- Auth ---
    function attemptLogin() {
        const user = document.getElementById('loginSelect').value;
        const pass = document.getElementById('loginPass').value;
        if(advisors[user] && advisors[user].pass === pass) {
            currentUser = advisors[user];
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('advisorNameDisplay').textContent = currentUser.name;
            updatePreview();
        } else {
            document.getElementById('loginError').classList.remove('hidden');
        }
    }

    // --- Dynamic Logic ---
    function updateShips() {
        const line = document.getElementById('cruiseLine').value;
        const shipSel = document.getElementById('shipName');
        shipSel.innerHTML = '';
        if(cruiseData[line]) {
            cruiseData[line].forEach(ship => {
                const opt = document.createElement('option');
                opt.value = ship.name;
                opt.textContent = ship.name;
                shipSel.appendChild(opt);
            });
        }
        updateShipDetails();
    }

    function updateShipDetails() {
        const line = document.getElementById('cruiseLine').value;
        const shipName = document.getElementById('shipName').value;
        const ship = cruiseData[line]?.find(s => s.name === shipName);
        document.getElementById('videoLink').value = ship?.video || '';
    }

    function addRoom() {
        const div = document.createElement('div');
        div.className = 'grid grid-cols-1 md:grid-cols-4 gap-2 bg-gray-50 p-2 rounded border room-row relative';
        div.innerHTML = `
            <button type="button" onclick="this.parentElement.remove(); updatePreview()" class="absolute top-0 left-0 text-red-500 px-1 font-bold">x</button>
            <select class="p-1 rounded border r-comp" onchange="updatePreview()">
                <option value="×–×•×’">×–×•×’</option>
                <option value="×–×•×’ + 1">×–×•×’ + 1</option>
                <option value="×–×•×’ + 2">×–×•×’ + 2</option>
                <option value="3 ××‘×•×’×¨×™×">3 ××‘×•×’×¨×™×</option>
            </select>
            <input type="text" class="p-1 rounded border r-type" placeholder="×¡×•×’ ×—×“×¨ (×œ×“×•×’××”: ×¤× ×™××™ ×’×¨× ×˜×™)" oninput="updatePreview()">
            <input type="number" class="p-1 rounded border r-price" placeholder="××—×™×¨" oninput="updatePreview()">
            <input type="text" class="p-1 rounded border r-names" placeholder="×©××•×ª × ×•×¡×¢×™×" oninput="updatePreview()">
        `;
        document.getElementById('roomsInputs').appendChild(div);
    }

    function addFlight() {
        const div = document.createElement('div');
        div.className = 'grid grid-cols-1 gap-1 border p-2 rounded bg-white flight-row relative';
        div.innerHTML = `
            <button type="button" onclick="this.parentElement.remove(); updatePreview()" class="absolute top-0 left-0 text-red-500 px-1 font-bold">x</button>
            <div class="grid grid-cols-2 gap-2">
                <input type="text" class="p-1 border rounded f-line" placeholder="×—×‘×¨×ª ×ª×¢×•×¤×”">
                <input type="text" class="p-1 border rounded f-route" placeholder="× ×ª×™×‘ (×ª''×-×¨×•××)">
            </div>
            <div class="grid grid-cols-3 gap-2">
                <input type="date" class="p-1 border rounded f-date">
                <input type="text" class="p-1 border rounded f-time" placeholder="×©×¢×•×ª">
                <input type="number" class="p-1 border rounded f-price" placeholder="××—×™×¨ ($)">
            </div>
        `;
        document.getElementById('flightsInputs').appendChild(div);
    }

    function addHotel() {
        const div = document.createElement('div');
        div.className = 'grid grid-cols-1 md:grid-cols-3 gap-2 border p-2 rounded bg-white extra-row relative';
        div.innerHTML = `
            <button type="button" onclick="this.parentElement.remove(); updatePreview()" class="absolute top-0 left-0 text-red-500 px-1 font-bold">x</button>
            <input type="text" class="p-1 border rounded e-desc" placeholder="×©× ×”××œ×•×Ÿ / ×¤×¨×˜×™×" oninput="updatePreview()">
            <input type="text" class="p-1 border rounded e-dates" placeholder="×ª××¨×™×›×™× / ×œ×™×œ×•×ª" oninput="updatePreview()">
            <input type="text" class="p-1 border rounded e-pension" placeholder="×¤× ×¡×™×•×Ÿ / ×¡×•×’ ×—×“×¨" oninput="updatePreview()">
        `;
        document.getElementById('extrasInputs').appendChild(div);
    }

    function addTransfer() {
        const div = document.createElement('div');
        div.className = 'flex gap-2 border p-2 rounded bg-white extra-row relative';
        div.innerHTML = `
            <button type="button" onclick="this.parentElement.remove(); updatePreview()" class="absolute top-0 left-0 text-red-500 px-1 font-bold">x</button>
            <select class="p-1 border rounded w-1/3 e-desc" onchange="updatePreview()">
                <option>×”×¢×‘×¨×”: ×©×“×”-××œ×•×Ÿ</option>
                <option>×”×¢×‘×¨×”: ××œ×•×Ÿ-× ××œ</option>
                <option>×”×¢×‘×¨×”: × ××œ-×©×“×”</option>
            </select>
            <input type="text" class="p-1 border rounded w-2/3 e-dates" placeholder="×¤×¨×˜×™× × ×•×¡×¤×™×" oninput="updatePreview()">
            <input type="hidden" class="e-pension"> `;
        document.getElementById('extrasInputs').appendChild(div);
    }

    function handlePaste(e) {
        e.preventDefault();
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (const item of items) {
            if (item.type.indexOf('image') === 0) {
                const blob = item.getAsFile();
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.getElementById('prevItinImg');
                    img.src = event.target.result;
                    img.classList.remove('hidden');
                    document.getElementById('pasteArea').innerHTML = '<span class="text-green-600 font-bold">×ª××•× ×” × ×§×œ×˜×”!</span>';
                    updatePreview();
                };
                reader.readAsDataURL(blob);
            }
        }
    }

    // --- MAIN RENDER FUNCTION ---
    function updatePreview() {
        if(!currentUser) return;

        // General
        const docType = document.querySelector('input[name="docType"]:checked').value;
        const line = document.getElementById('cruiseLine').value;
        const currency = currencies[line] || '$';
        
        document.getElementById('prevTitle').textContent = docType === 'quote' ? '×”×¦×¢×ª ××—×™×¨' : '××™×©×•×¨ ×”×–×× ×”';
        document.getElementById('prevDate').textContent = '×ª××¨×™×š: ' + new Date(document.getElementById('offerDate').value).toLocaleDateString('he-IL');
        document.getElementById('prevClientName').textContent = document.getElementById('clientName').value;
        document.getElementById('prevOpening').textContent = docType === 'quote' ? 
            '×‘×”××©×š ×œ×©×™×—×ª× ×•, ×©××—×ª×™ ×œ×”×›×™×Ÿ ×¢×‘×•×¨×š ××ª ×”×”×¦×¢×” ×”×‘××”:' : '××¦×•×¨×£ ××™×©×•×¨ ×œ×”×–×× ×ª×š. ×× × ×¢×‘×¨×• ×¢×œ ×”×¤×¨×˜×™× ×•××©×¨×• ×‘×”×•×“×¢×” ×—×•×–×¨×ª.';

        // Cruise
        if(document.getElementById('hideCruise').checked) {
            document.getElementById('prevCruise').classList.add('hidden');
        } else {
            document.getElementById('prevCruise').classList.remove('hidden');
            document.getElementById('prevShipNameDisplay').textContent = document.getElementById('shipName').value;
            document.getElementById('prevLine').textContent = line;
            
            const cDate = document.getElementById('cruiseDate').value;
            const cDur = parseInt(document.getElementById('cruiseDuration').value) || 0;
            if(cDate) {
                const start = new Date(cDate);
                const end = new Date(start);
                end.setDate(start.getDate() + cDur);
                document.getElementById('prevDates').textContent = `${start.toLocaleDateString('he-IL')} - ${end.toLocaleDateString('he-IL')}`;
            }

            document.getElementById('prevDuration').textContent = cDur;
            document.getElementById('prevRoute').textContent = `${document.getElementById('portDep').value} -> ${document.getElementById('portArr').value}`;
            
            // Booking Num & Benefits
            const bNum = document.getElementById('bookingNum').value;
            if(bNum) {
                document.getElementById('prevBooking').classList.remove('hidden');
                document.getElementById('prevBookingVal').textContent = bNum;
            } else { document.getElementById('prevBooking').classList.add('hidden'); }

            const ben = document.getElementById('benefits').value;
            if(ben) {
                document.getElementById('prevBenefits').classList.remove('hidden');
                document.getElementById('prevBenefits').textContent = "×”×˜×‘×•×ª: " + ben;
            } else { document.getElementById('prevBenefits').classList.add('hidden'); }

            // Itinerary
            const itinType = document.querySelector('input[name="itinType"]:checked').value;
            if(itinType === 'text') {
                document.getElementById('prevItinImg').classList.add('hidden');
                document.getElementById('prevItinTxt').classList.remove('hidden');
                document.getElementById('prevItinTxt').textContent = document.getElementById('itinText').value;
            } else {
                if(document.getElementById('prevItinImg').src) document.getElementById('prevItinImg').classList.remove('hidden');
                document.getElementById('prevItinTxt').classList.add('hidden');
            }

            // Rooms Logic
            const rContainer = document.getElementById('prevRooms');
            rContainer.innerHTML = '';
            let cruiseTotal = 0;
            let totalRooms = 0;
            let totalPax = 0;
            let hasGuarantee = false;

            const rows = document.querySelectorAll('.room-row');
            rows.forEach(row => {
                const comp = row.querySelector('.r-comp').value;
                const type = row.querySelector('.r-type').value;
                const price = parseFloat(row.querySelector('.r-price').value) || 0;
                const names = row.querySelector('.r-names').value;
                
                cruiseTotal += price;
                totalRooms++;
                totalPax += (comp.includes('+') ? 3 : (comp.includes('3') ? 3 : (comp.includes('4') ? 4 : 2))); // Simple logic for deposit calc

                if(type.includes('×’×¨× ×˜×™')) hasGuarantee = true;

                const div = document.createElement('div');
                div.className = 'flex justify-between border-b pb-1 mb-1';
                div.innerHTML = `
                    <div><span class="font-bold">${type}</span> <span class="text-xs text-gray-500">(${comp})</span> ${names ? `<div class="text-xs">${names}</div>` : ''}</div>
                    <div class="font-bold">${currency}${price.toLocaleString()}</div>
                `;
                rContainer.appendChild(div);
            });

            document.getElementById('guaranteeNote').classList.toggle('hidden', !hasGuarantee);
            document.getElementById('prevTips').textContent = (line === 'MSC' || line === 'Costa' || line === 'Mano') ? 'â€¢ ×”××—×™×¨ ×›×•×œ×œ ×ª×©×œ×•× ×˜×™×¤×™× ××¨××©.' : 'â€¢ ×”××—×™×¨ ××™× ×• ×›×•×œ×œ ×˜×™×¤×™× (×ª×©×œ×•× ×‘××•× ×™×™×”).';
            
            // Deposit Logic
            if(docType === 'confirmation') {
                const depFunc = depositAmounts[line] || depositAmounts['Default'];
                const depText = typeof depFunc === 'function' ? depFunc(cDur, totalPax, totalRooms) : depFunc;
                document.getElementById('prevDeposit').innerHTML = `×ª×©×œ×•× ××§×“××”: <span class="font-bold">${depText}</span>`;
                
                // Final Payment (approx 60 days before)
                if(cDate) {
                    const finalD = new Date(cDate);
                    finalD.setDate(finalD.getDate() - 60);
                    document.getElementById('prevFinal').textContent = `×’××¨ ×—×©×‘×•×Ÿ ×¢×“ ×œ×ª××¨×™×š: ${finalD.toLocaleDateString('he-IL')}`;
                }
                document.getElementById('prevPayment').classList.remove('hidden');
            } else {
                document.getElementById('prevPayment').classList.add('hidden');
            }
        }

        // Flights & Extras
        const flightsList = document.getElementById('prevFlightsList');
        flightsList.innerHTML = '';
        const fRows = document.querySelectorAll('.flight-row');
        let flightTotal = 0;
        fRows.forEach(row => {
            const line = row.querySelector('.f-line').value;
            const route = row.querySelector('.f-route').value;
            const date = row.querySelector('.f-date').value;
            const time = row.querySelector('.f-time').value;
            const price = parseFloat(row.querySelector('.f-price').value) || 0;
            flightTotal += price;
            
            if(line || route) {
                const div = document.createElement('div');
                div.textContent = `âœˆ ${line} | ${route} | ${date} ${time} | $${price}`;
                flightsList.appendChild(div);
            }
        });

        document.getElementById('prevFlights').classList.toggle('hidden', fRows.length === 0);
        document.getElementById('prevFlightIncludesTxt').textContent = document.getElementById('flightIncludes').value;
        const cancelType = document.querySelector('input[name="flightCancel"]:checked').value;
        if(cancelType === 'no') {
            document.getElementById('prevFlightPolicyTxt').textContent = '×›×¨×˜×™×¡ ×œ×œ× ×”×—×–×¨ (Non-Refundable).';
        } else {
            const feeC = document.getElementById('flightCancelFee').value || 'X';
            const feeCh = document.getElementById('flightChangeFee').value || 'X';
            document.getElementById('prevFlightPolicyTxt').textContent = `×‘×™×˜×•×œ: ${feeC}$, ×©×™× ×•×™: ${feeCh}$ (×‘×›×¤×•×£ ×œ××—×œ×§×ª ×›×¨×˜×•×¡).`;
        }

        // Extras
        const otherList = document.getElementById('prevOtherList');
        otherList.innerHTML = '';
        const eRows = document.querySelectorAll('.extra-row');
        eRows.forEach(row => {
            const desc = row.querySelector('.e-desc').value;
            const dates = row.querySelector('.e-dates').value;
            const pen = row.querySelector('.e-pension').value;
            
            if(desc) {
                const div = document.createElement('div');
                div.className = 'mb-1';
                div.innerHTML = `<strong>${desc}</strong> ${dates} ${pen ? `(${pen})` : ''}`;
                otherList.appendChild(div);
            }
        });
        document.getElementById('prevOther').classList.toggle('hidden', eRows.length === 0);

        // Total
        const extrasCost = parseFloat(document.getElementById('extrasCost').value) || 0;
        const totalExtras = flightTotal + extrasCost;
        let cruiseTotalCalc = 0; 
        document.querySelectorAll('.r-price').forEach(i => cruiseTotalCalc += (parseFloat(i.value)||0));
        
        if(document.getElementById('hideTotal').checked) {
            document.getElementById('prevTotalDisplay').textContent = '';
        } else {
            if(currency === '$') {
                document.getElementById('prevTotalDisplay').textContent = `$${(cruiseTotalCalc + totalExtras).toLocaleString()}`;
            } else {
                if(totalExtras > 0 && cruiseTotalCalc > 0)
                    document.getElementById('prevTotalDisplay').textContent = `${currency}${cruiseTotalCalc.toLocaleString()} + $${totalExtras.toLocaleString()}`;
                else if(cruiseTotalCalc > 0)
                    document.getElementById('prevTotalDisplay').textContent = `${currency}${cruiseTotalCalc.toLocaleString()}`;
                else
                    document.getElementById('prevTotalDisplay').textContent = `$${totalExtras.toLocaleString()}`;
            }
        }

        // Footer
        document.getElementById('prevNotesList').textContent = document.getElementById('customNotes').value;
        document.getElementById('prevAdvisorDetails').innerHTML = `${currentUser.name}<br>${currentUser.phone}<br>${currentUser.email}`;
    }

    // --- PDF Logic (Smart Page Break) ---
    async function generatePDF() {
        // 1. Prepare
        const element = document.getElementById('previewSection');
        const opt = { scale: 2, useCORS: true };
        
        // 2. Clone to analyze height (avoid cutting logic for simplicity, relying on manual check or CSS 'break-inside: avoid')
        // The CSS .no-split handles the basic logic, but JS PDF requires rendering logic
        
        // Simple Method using JSPDF html() which is better now
        const doc = new jspdf.jsPDF('p', 'mm', 'a4');
        const pageWidth = 210;
        const pageHeight = 297;
        
        // Use html2canvas to create image then slice it (Standard reliable method)
        window.scrollTo(0,0);
        const canvas = await html2canvas(element, opt);
        const imgData = canvas.toDataURL('image/jpeg', 0.95);
        const imgWidth = 210; 
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        let heightLeft = imgHeight;
        let position = 0;

        doc.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            doc.addPage();
            doc.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        const client = document.getElementById('clientName').value || 'Quote';
        doc.save(`BaliCruise_${client}.pdf`);
    }

    function resetForm() {
        if(confirm('×œ× ×§×•×ª ××ª ×›×œ ×”×˜×•×¤×¡?')) {
            document.getElementById('quoteForm').reset();
            document.getElementById('roomsInputs').innerHTML = '';
            document.getElementById('flightsInputs').innerHTML = '';
            document.getElementById('extrasInputs').innerHTML = '';
            document.getElementById('prevItinImg').src = '';
            document.getElementById('pasteArea').innerHTML = '<p class="text-gray-400 pointer-events-none">ğŸ“¸ ×œ×—×¥ ×›××Ÿ ×•×”×“×‘×§ ×ª××•× ×” (Ctrl+V)</p>';
            addRoom();
            updatePreview();
        }
    }
</script>
</body>
</html>
