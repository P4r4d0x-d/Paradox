<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×”×¦×¢×•×ª ××—×™×¨ ×œ×§×¨×•×–×™×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1400px;
        }
        .preview-container * {
            pointer-events: none;
        }
        .no-split {
            break-inside: avoid;
        }
        .no-break-after {
            break-after: avoid;
        }
        @media print {
            .no-print { display: none; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        #previewItineraryImage, #previewShipImage {
            height: 300px;
            object-fit: cover;
        }
        .preview-section {
            min-height: 100px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
        }
        .close-btn {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="loginScreen" class="fixed inset-0 bg-gray-200 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm">
            <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">×›× ×™×¡×” ×œ××¢×¨×›×ª</h2>
            <div class="space-y-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">××™××™×™×œ</label>
                    <input type="email" id="email" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">×¡×™×¡××”</label>
                    <input type="password" id="password" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
            <p id="loginError" class="text-red-500 text-sm mt-2 hidden">×¤×¨×˜×™ ×”×ª×—×‘×¨×•×ª ×©×’×•×™×™×.</p>
            <button id="loginBtn" class="mt-6 w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded-lg">
                ×”×ª×—×‘×¨
            </button>
        </div>
    </div>
   
    <div id="mainContent" class="container mx-auto p-4 lg:p-8 hidden">
        <header class="text-center mb-8 no-print">
            <div class="flex justify-between items-center">
                <div>
                     <button id="showSavedQuotesBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">×”×¦×¢×•×ª ×©××•×¨×•×ª</button>
                     <button id="newQuoteBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg ml-2">×”×¦×¢×” ×—×“×©×”</button>
                </div>
                <h1 class="text-4xl font-bold text-blue-800">××—×•×œ×œ ×”×¦×¢×•×ª ××—×™×¨</h1>
                <div class="text-left">
                     <p>×©×œ×•×, <span id="loggedInAdvisor" class="font-bold"></span></p>
                     <p id="currentQuoteNumber" class="text-sm text-gray-600"></p>
                </div>
            </div>
            <p class="text-gray-600 mt-2">××œ× ××ª ×”×¤×¨×˜×™× ×‘×˜×•×¤×¡ ×›×“×™ ×œ×™×¦×•×¨ ×”×¦×¢×ª ××—×™×¨ ××§×¦×•×¢×™×ª ×‘×¤×•×¨××˜ PDF.</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-8">
            <div id="inputForm" class="lg:w-1/2 bg-white p-6 rounded-2xl shadow-lg no-print">
                <h2 class="text-2xl font-bold mb-6 border-b pb-3">×¤×¨×˜×™ ×”×”×¦×¢×”</h2>
               
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">×¡×•×’ ××¡××š</label>
                        <div class="flex items-center space-x-4 space-x-reverse mt-1">
                            <label><input type="radio" name="docType" value="quote" checked class="ml-1"> ×”×¦×¢×ª ××—×™×¨</label>
                            <label><input type="radio" name="docType" value="confirmation" class="ml-1"> ××™×©×•×¨ ×”×–×× ×”</label>
                        </div>
                    </div>
                     <div>
                        <label for="offerDate" class="block text-sm font-medium text-gray-700">×ª××¨×™×š ×”×”×¦×¢×”</label>
                        <input type="date" id="offerDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="clientName" class="block text-sm font-medium text-gray-700">×©× ×”×œ×§×•×—/×”</label>
                        <input type="text" id="clientName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div>
                        <label for="advisor" class="block text-sm font-medium text-gray-700">×™×•×¢×¥ ×©×™×™×˜</label>
                        <select id="advisor" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" disabled>
                            <option value="lior">×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™</option>
                            <option value="tatiana">×˜×˜×™×× ×” ×œ××•× ×•×‘</option>
                            <option value="koren">×§×•×¨×Ÿ ××‘×¡×¢×™×“</option>
                            <option value="yarden">×™×¨×“×Ÿ ×©×§×“</option>
                            <option value="nir">× ×™×¨</option>
                        </select>
                    </div>
                </div>
                <div id="cruiseSectionContainer" class="mt-6 border-t pt-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-xl font-bold">×©×™×™×˜</h3>
                         <div class="flex items-start">
                            <input id="hideCruise" type="checkbox" class="h-4 w-4 text-red-600 border-gray-300 rounded mt-1">
                            <label for="hideCruise" class="mr-2 block text-sm text-red-700 font-semibold">×”×¡×ª×¨ ×©×™×™×˜ ××”×”×¦×¢×”</label>
                        </div>
                    </div>
                    <div id="cruiseFields" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="cruiseLine" class="block text-sm font-medium text-gray-700">×—×‘×¨×ª ×©×™×™×˜</label>
                                <select id="cruiseLine" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    <option>MSC</option>
                                    <option>Royal Caribbean</option>
                                    <option>Norwegian Cruise Line</option>
                                    <option>CELEBRITY</option>
                                    <option>COSTA</option>
                                    <option>Carnival</option>
                                    <option>Azamara</option>
                                    <option>Virgin Voyages</option>
                                    <option>Seabourn</option>
                                    <option>Regent Seven Seas</option>
                                    <option>Ponant</option>
                                    <option>P&O Cruises</option>
                                    <option>Oceania Cruises</option>
                                    <option>Holland America</option>
                                    <option>Disney Cruise Line</option>
                                    <option>Cunard</option>
                                    <option>Crystal</option>
                                </select>
                            </div>
                            <div>
                                <label for="shipName" class="block text-sm font-medium text-gray-700">×©× ×”××•× ×™×™×”</label>
                                <select id="shipName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></select>
                            </div>
                            <div>
                                <label for="shipVideo" class="block text-sm font-medium text-gray-700">×§×™×©×•×¨ ×•×™×“××• (YouTube)</label>
                                <input type="text" id="shipVideo" placeholder="https://www.youtube.com/..." class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="cruiseDuration" class="block text-sm font-medium text-gray-700">××©×š ×”×”×¤×œ×’×” (×œ×™×œ×•×ª)</label>
                                <input type="number" id="cruiseDuration" value="7" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                            </div>
                             <div>
                                <label for="cruiseStartDate" class="block text-sm font-medium text-gray-700">×ª××¨×™×š ×™×¦×™××”</label>
                                <input type="date" id="cruiseStartDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                            </div>
                             <div class="col-span-2 grid grid-cols-2 gap-4">
                                <div>
                                    <label for="departurePort" class="block text-sm font-medium text-gray-700">× ××œ ×™×¦×™××”</label>
                                    <input type="text" id="departurePort" placeholder="×œ×“×•×’××”: ×¨×•××" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label for="arrivalPort" class="block text-sm font-medium text-gray-700">× ××œ ×—×–×¨×”</label>
                                    <input type="text" id="arrivalPort" placeholder="×œ×“×•×’××”: ×¨×•××" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">×ª××•× ×ª ××¡×œ×•×œ</label>
                            <div id="itineraryPasteTarget" contenteditable="true" tabindex="0" class="mt-1 flex justify-center items-center w-full h-24 border-2 border-dashed border-gray-300 rounded-md cursor-pointer text-gray-500 p-2 text-center transition-colors">
                                <span>×”×“×‘×§ ×ª××•× ×” ×›××Ÿ (Ctrl+V)</span>
                            </div>
                        </div>
                        <div id="roomsContainer">
                            <h3 class="text-xl font-bold mb-3">×—×“×¨×™×</h3>
                        </div>
                        <button id="addRoomBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ×—×“×¨</button>
                    </div>
                 </div>
                <div class="mt-6 border-t pt-4">
                    <h3 class="text-xl font-bold mb-3">×˜×™×¡×•×ª (××•×¤×¦×™×•× ×œ×™)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div id="flightsContainer" class="space-y-4"></div>
                        <button id="addFlightBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ×˜×™×¡×”</button>
                        <div>
                            <label for="flightIncludes" class="block text-sm font-medium text-gray-700">×”×›×¨×˜×™×¡ ×›×•×œ×œ (× ×™×ª×Ÿ ×œ×¢×¨×•×š)</label>
                            <textarea id="flightIncludes" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">××–×•×•×“×” 20 ×§"×’
×˜×¨×•×œ×™ 7 ×§"×’</textarea>
                        </div>
                        <div>
                            <label for="flightFreeText" class="block text-sm font-medium text-gray-700">××œ×œ ×—×•×¤×©×™ ×œ×˜×™×¡×•×ª</label>
                            <textarea id="flightFreeText" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                        </div>
                        <div>
                            <label for="flightCost" class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ×›×¨×˜×™×¡ ×˜×™×¡×” ×œ××“× ($)</label>
                            <input type="number" id="flightCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">×ª× ××™ ×‘×™×˜×•×œ/×©×™× ×•×™</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="flightNoCancel" name="flightCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightNoCancel" class="mr-2">×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="flightCancellable" name="flightCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightCancellable" class="mr-2">× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ / ×©×™× ×•×™</label>
                                </div>
                                <div id="flightCancelDetails" class="hidden space-y-2 mr-6">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="flightCancelCheck" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                        <label for="flightCancelCheck" class="mr-2">×‘×™×˜×•×œ</label>
                                        <input type="text" id="flightCancelFee" placeholder="×“××™ ×‘×™×˜×•×œ ×œ× ×•×¡×¢" class="mr-2 w-32 border-gray-300 rounded-md shadow-sm">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="flightChangeCheck" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                        <label for="flightChangeCheck" class="mr-2">×©×™× ×•×™</label>
                                        <input type="text" id="flightChangeFee" placeholder="×“××™ ×©×™× ×•×™ ×œ× ×•×¡×¢" class="mr-2 w-32 border-gray-300 rounded-md shadow-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 border-t pt-4">
                    <h3 class="text-xl font-bold mb-3">××œ×•× ×•×ª (××•×¤×¦×™×•× ×œ×™)</h3>
                    <div id="hotelsContainer" class="space-y-4"></div>
                    <button id="addHotelBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ××œ×•×Ÿ</button>
                </div>
                <div class="mt-6 border-t pt-4">
                    <h3 class="text-xl font-bold mb-3">×”×¢×‘×¨×•×ª (××•×¤×¦×™×•× ×œ×™)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div id="transfersContainer" class="space-y-4"></div>
                        <button id="addTransferBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ×”×¢×‘×¨×”</button>
                        <div>
                            <label for="transfersCost" class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ×›×œ ×”×”×¢×‘×¨×•×ª ($)</label>
                            <input type="number" id="transfersCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">×ª× ××™ ×‘×™×˜×•×œ</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="transfersNoCancel" name="transfersCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="transfersNoCancel" class="mr-2">×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="transfersCancellable" name="transfersCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="transfersCancellable" class="mr-2">× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ</label>
                                </div>
                                <div id="transfersCancelDetails" class="hidden space-y-2 mr-6">
                                     <div>
                                        <label for="transfersCancelDate" class="block text-sm font-medium text-gray-700">×¢×“ ×ª××¨×™×š</label>
                                        <input type="date" id="transfersCancelDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    </div>
                                    <div>
                                        <label for="transfersCancelFee" class="block text-sm font-medium text-gray-700">×“××™ ×‘×™×˜×•×œ</label>
                                        <input type="text" id="transfersCancelFee" placeholder="×œ×“×•×’××”: $50" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               
                <div class="mt-6 border-t pt-4">
                    <div class="flex items-start mb-4">
                        <input id="hideTotal" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                        <label for="hideTotal" class="mr-2 block text-sm text-gray-900">×”×¡×ª×¨ ×¡×”"×› ×¢×œ×•×ª</label>
                    </div>
                    <div>
                        <label for="customInclusions" class="block text-sm font-medium text-gray-700">×”×¢×¨×•×ª ×•×“×’×©×™× × ×•×¡×¤×™× (×›×œ ×©×•×¨×” ×ª×•×¤×™×¢ ×›×¡×¢×™×£ × ×¤×¨×“)</label>
                        <textarea id="customInclusions" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                    <div class="flex items-center mt-2">
                        <input id="hideMealInclusion" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="hideMealInclusion" class="mr-2 text-sm text-gray-700">×”×¡×ª×¨ ×¡×¢×™×£ ××¨×•×—×•×ª ×§×‘×•×¢</label>
                    </div>
                </div>
                <div class="mt-8 flex justify-between gap-4">
                    <button id="saveQuoteBtn" class="w-full lg:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg">×©××•×¨ ×”×¦×¢×”</button>
                    <button id="generatePDFBtn" class="w-full lg:w-auto bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg">×”×•×¨×“ PDF</button>
                </div>
            </div>
           
            <div class="lg:w-1/2">
                <div id="preview" class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-[794px] mx-auto relative">
                    <header class="flex justify-between items-center border-b-2 pb-4 border-gray-200">
                        <div class="text-right">
                            <img src="https://i.postimg.cc/8T2V9VQ8/2-300-X1200.png" alt="×‘××œ×™ ×§×¨×•×–" class="h-16" />
                        </div>
                        <div style="font-size: 40px; color: #3f3c66;">âš“</div>
                    </header>
                    <main id="preview-main" class="mt-8">
                        <div class="flex justify-between items-start">
                            <p class="text-xl mb-6"><span id="previewDocTitle"></span> <span id="previewClientName" class="font-bold"></span>,</p>
                             <div>
                                <p class="mb-1 text-left text-sm"><span id="previewDate" class="font-semibold"></span></p>
                                <p class="mb-4 text-left text-sm"><span id="previewQuoteNumber" class="font-semibold"></span></p>
                            </div>
                        </div>
                       
                        <p id="previewOpeningLine" class="mb-6"></p>
                        <div id="previewCruiseDetails" class="bg-blue-50 rounded-lg p-4 mb-6 no-split hidden preview-section">
                            <h2 class="text-2xl font-bold mb-4 text-blue-800">×¤×¨×˜×™ ×”×”×¤×œ×’×”</h2>
                            <div class="grid grid-cols-2 gap-4 text-md">
                                <p><strong>×—×‘×¨×ª ×©×™×™×˜:</strong> <span id="previewCruiseLine"></span></p>
                                <p><strong>××•× ×™×™×”:</strong> <span id="previewShipName"></span></p>
                                <p><strong>××©×š ×”×¤×œ×’×”:</strong> <span id="previewCruiseDuration"></span> ×œ×™×œ×•×ª</p>
                                <p><strong>×ª××¨×™×›×™×:</strong> <span id="previewCruiseDate"></span></p>
                                <p class="col-span-2"><strong>××¡×œ×•×œ:</strong> <span id="previewPorts"></span></p>
                            </div>
                        </div>
                        <div id="previewCruiseInclusions" class="mt-4 text-sm space-y-3 no-split preview-section hidden">
                            <ul id="previewCruiseInclusionsList" class="list-disc list-inside bg-gray-50 p-4 rounded-lg">
                            </ul>
                        </div>
                        <div id="previewItinerarySection" class="my-6 no-split hidden preview-section">
                            <h3 class="text-xl font-bold mb-3 no-break-after">××¡×œ×•×œ ×”×”×¤×œ×’×”:</h3>
                            <img id="previewItineraryImage" src="https://placehold.co/800x300/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××¡×œ×•×œ" class="w-full rounded-lg shadow-md" alt="Itinerary Map">
                        </div>
                        <div id="previewRoomsSection" class="my-6 hidden preview-section">
                            <h3 class="text-xl font-bold mb-3 no-break-after">×¤×¨×˜×™ ×”×—×“×¨×™×:</h3>
                            <div id="previewRoomsContainer" class="space-y-4"></div>
                            <div id="previewGuaranteeNote" class="mt-4 text-sm bg-yellow-100 p-3 rounded-lg hidden no-split">
                                ×—×“×¨ ××¡×•×’ "×’×¨× ×˜×™" ×”×•× ×—×“×¨ ×©×‘×• ×—×‘×¨×ª ×”×©×™×™×˜ ××ª×—×™×™×‘×ª ×œ×¡×•×’ ×”×—×“×¨ ×©×‘×—×¨×ª×, ××š ××™×§×•× ×”×—×“×¨ (×§×•××” ××• ××™×§×•× ×¡×¤×¦×™×¤×™ ×‘××•× ×™×™×”) ××™× ×• ××•×‘×˜×—. ××›×™×•×•×Ÿ ×©××™×§×•× ×”×—×“×¨ ××™× ×• ×™×“×•×¢ ××¨××©, ×œ× × ×™×ª×Ÿ ×œ×“×¢×ª ×× ×”× ×•×£ ××”×—×“×¨ ×™×”×™×” × ×•×£ ××œ×, ×—×œ×§×™ ××• ××•×¡×ª×¨.<br>ğŸ’¡ ×—×©×•×‘ ×œ×“×¢×ª!<br>×—×“×¨×™× ××¡×•×’ "×’×¨× ×˜×™" ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª ×¢×©×•×™×™× ×œ×”×™×•×ª ××©×•×“×¨×’×™× ×‘××§×¨×™× ×©×œ ××•×‘×¨×‘×•×§×™× ×’, ×›×š ×©×™×© ×¡×™×›×•×™ ×œ×§×‘×œ ×©×“×¨×•×’ ×œ×¡×•×’ ×—×“×¨ ×˜×•×‘ ×™×•×ª×¨ ğŸ˜Š
                            </div>
                        </div>
                        <div id="previewFlightsContainer" class="my-6 hidden preview-section">
                            <h3 class="text-xl font-bold mb-3 no-break-after">×¤×¨×˜×™ ×˜×™×¡×•×ª:</h3>
                            <div class="border p-3 rounded-lg bg-white space-y-2 no-split">
                                <div id="previewFlightsList" class="space-y-2"></div>
                                <div id="previewFlightIncludesContainer" class="hidden">
                                    <p class="font-semibold">×”×›×¨×˜×™×¡ ×›×•×œ×œ:</p>
                                    <ul id="previewFlightIncludes" class="list-disc list-inside"></ul>
                                </div>
                                <p id="previewFlightFreeText" style="white-space: pre-wrap;"></p>
                                <p class="font-semibold text-right" id="previewFlightCost"></p>
                                <div id="previewFlightConditions" class="text-sm"></div>
                            </div>
                        </div>
                       
                        <div id="previewHotelsSection" class="my-6 hidden preview-section">
                            <h3 class="text-xl font-bold mb-3 no-break-after">×¤×¨×˜×™ ××œ×•× ×•×ª:</h3>
                            <div id="previewHotelsContainer" class="space-y-4"></div>
                        </div>
                       
                        <div id="previewTransfersContainer" class="my-6 hidden preview-section">
                            <h3 class="text-xl font-bold mb-3 no-break-after">×¤×¨×˜×™ ×”×¢×‘×¨×•×ª:</h3>
                            <div class="border p-3 rounded-lg bg-white space-y-2 no-split">
                                <div id="previewTransfersList" class="space-y-2"></div>
                                <p class="font-semibold text-right" id="previewTransfersCost"></p>
                                <div id="previewTransfersConditions" class="text-sm"></div>
                            </div>
                        </div>
                       
                        <div id="previewTotalContainer" class="mt-6 text-2xl font-bold text-right text-blue-900 bg-gray-100 p-4 rounded-lg no-split">
                            ×¡×”"×› ×¢×œ×•×ª: $<span id="previewTotalPrice">0</span>
                        </div>
                        <div class="mt-8 text-sm space-y-3 no-split preview-section">
                             <h3 class="text-xl font-bold mb-3 no-break-after">×”×¢×¨×•×ª ×•×“×’×©×™×:</h3>
                            <ul id="previewInclusions" class="list-disc list-inside bg-gray-50 p-4 rounded-lg">
                            </ul>
                        </div>
                        <div id="previewShipImageSection" class="my-8 no-split hidden preview-section">
                           <img id="previewShipImage" src="https://placehold.co/800x300/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××•× ×™×™×”" class="w-full rounded-lg shadow-md" alt="Cruise Ship">
                           <p id="previewShipVideo" class="text-center mt-2 hidden"><a href="" target="_blank" class="text-blue-600 hover:underline">×¦×¤×” ×‘×¡×¨×˜×•×Ÿ ×”××•× ×™×™×”</a></p>
                        </div>
                       
                        <div class="mt-8 text-sm space-y-3">
                            <div class="border-t pt-4 mt-4 no-split">
                                <h4 class="font-bold no-break-after">×ª× ××™ ×ª×©×œ×•× ×•×‘×™×˜×•×œ:</h4>
                                <p><strong>××¤×©×¨×•×™×•×ª ×ª×©×œ×•×:</strong></p>
                                <ul class="list-disc list-inside">
                                    <li>×›×¨×˜×™×¡ ××©×¨××™ ×¢×“ 3 ×ª×©×œ×•××™× ×œ×œ× ×¨×™×‘×™×ª â€“ ×¢×“ 6 ×ª×©×œ×•××™× ×¢× ×¨×™×‘×™×ª 3% - ××¢×œ 6 ×•×¢×“ 18 ×‘×§×¨×“×™×˜.</li>
                                    <li>×”×¢×‘×¨×” ×‘× ×§××™×ª ×©×§×œ/×“×•×œ×¨/×™×•×¨×•</li>
                                    <li>××–×•××Ÿ ×œ×¤×™ ×—×•×§ ×”××–×•××Ÿ ×‘××©×¨×“× ×•</li>
                                </ul>
                                <p><strong>×ª× ××™ ×‘×™×˜×•×œ:</strong> ×‘×”×ª×× ×œ×ª× ××™ ×—×‘×¨×ª ×”×©×™×™×˜ ×”××¦×•×¨×¤×™× ×‘× ×¤×¨×“.</p>
                                <p class="text-xs text-black mt-2">×œ×ª×©×•××ª ×œ×‘×š: ×—×•×§ ×”×’× ×ª ×”×¦×¨×›×Ÿ ××™× ×• ×ª×§×£ ×œ×”×–×× ×•×ª ×©×™×¨×•×ª×™ ×ª×™×™×¨×•×ª ×”××ª×—×™×œ×™× ×•××¡×ª×™×™××™× ××—×•×¥ ×œ×™×©×¨××œ.</p>
                                <p class="text-xs text-black mt-2">×˜×œ"×—</p>
                                <p class="text-xs text-black mt-2">*×¨×›×™×©×ª ×›×œ ××•×¦×¨ ×•×‘×™×˜×•×œ×• ××™× ×” ×›×¤×•×¤×” ×œ×©×•× ××•×¦×¨ ××—×¨!</p>
                                <p id="importantNote" class="font-bold mt-4">×—×©×•×‘ ×œ×™ ×œ×¦×™×™×Ÿ ×©×›×œ ×”××—×™×¨×™× × ×›×•× ×™× ×œ×”×¨×’×¢ ×•×™×›×•×œ×™× ×œ×”×©×ª× ×•×ª ×‘×›×œ ×¨×’×¢ × ×ª×•×Ÿ.</p>
                            </div>
                        </div>
                    </main>
                    <footer class="text-center mt-12 border-t-2 pt-6 border-gray-200">
                        <p class="font-bold text-lg text-blue-800">×ª×•×“×” ×©×‘×—×¨×ª× ×œ×”×¤×œ×™×’ ××™×ª× ×•!</p>
                        <p id="previewAdvisor">×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™ | ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | lior@balicruise.co.il</p>
                    </footer>
                    <p id="previewInternalQuote" class="absolute bottom-0 left-0 text-xs text-gray-400">××¡×¤×¨ ×”×¦×¢×” ×¤× ×™××™: <span id="previewInternalNumber"></span></p>
                </div>
            </div>
        </div>
    </div>
   
    <div id="savedQuotesModal" class="modal">
        <div class="modal-content">
            <span id="closeModalBtn" class="close-btn">&times;</span>
            <h2 class="text-2xl font-bold mb-4">×”×¦×¢×•×ª ×©××•×¨×•×ª</h2>
            <div id="savedQuotesList" class="space-y-2 max-h-96 overflow-y-auto">
            </div>
        </div>
    </div>
    <template id="roomTemplate">
        <div class="room-entry border p-4 rounded-lg mt-2 bg-gray-50 relative">
            <button class="remove-room-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                 <div>
                    <label class="block text-sm font-medium text-gray-700">×”×¨×›×‘</label>
                    <select name="composition" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        <option value="">×‘×—×¨ ×”×¨×›×‘</option>
                        <option value="× ×•×¡×¢ ×™×—×™×“">× ×•×¡×¢ ×™×—×™×“</option>
                        <option value="×–×•×’">×–×•×’</option>
                        <option value="×–×•×’ + 1">×–×•×’ + 1</option>
                        <option value="×–×•×’ + 2">×–×•×’ + 2</option>
                        <option value="×–×•×’ + 3">×–×•×’ + 3</option>
                        <option value="××‘×•×’×¨ + ×™×œ×“">××‘×•×’×¨ + ×™×œ×“</option>
                        <option value="××‘×•×’×¨ + 2 ×™×œ×“×™×">××‘×•×’×¨ + 2 ×™×œ×“×™×</option>
                        <option value="××‘×•×’×¨ + 3 ×™×œ×“×™×">××‘×•×’×¨ + 3 ×™×œ×“×™×</option>
                        <option value="××‘×•×’×¨ + 4 ×™×œ×“×™×">××‘×•×’×¨ + 4 ×™×œ×“×™×</option>
                        <option value="3 ××‘×•×’×¨×™×">3 ××‘×•×’×¨×™×</option>
                        <option value="3 ××‘×•×’×¨×™× + 1">3 ××‘×•×’×¨×™× + 1</option>
                        <option value="3 ××‘×•×’×¨×™× + 2">3 ××‘×•×’×¨×™× + 2</option>
                        <option value="4 ××‘×•×’×¨×™×">4 ××‘×•×’×¨×™×</option>
                        <option value="4 ××‘×•×’×¨×™× + 1">4 ××‘×•×’×¨×™× + 1</option>
                        <option value="5 ××‘×•×’×¨×™×">5 ××‘×•×’×¨×™×</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª×™××•×¨ ×—×“×¨</label>
                    <select name="roomType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        <option value="">×‘×—×¨ ×¡×•×’ ×—×“×¨</option>
                        <option value="×¤× ×™××™ ×’×¨× ×˜×™">×¤× ×™××™ ×’×¨× ×˜×™</option>
                        <option value="×¤× ×™××™ ×¢× ×‘×—×™×¨×ª ××™×§×•×">×¤× ×™××™ ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="×—×œ×•×Ÿ ×’×¨× ×˜×™">×—×œ×•×Ÿ ×’×¨× ×˜×™</option>
                        <option value="×—×œ×•×Ÿ ×¢× ×‘×—×™×¨×ª ××™×§×•×">×—×œ×•×Ÿ ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="××¨×¤×¡×ª ×œ×™× ×’×¨× ×˜×™">××¨×¤×¡×ª ×œ×™× ×’×¨× ×˜×™</option>
                        <option value="××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×’×¨× ×˜×™">××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×’×¨× ×˜×™</option>
                        <option value="××¨×¤×¡×ª ×œ×™× ×¢× ×‘×—×™×¨×ª ××™×§×•×">××¨×¤×¡×ª ×œ×™× ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×¢× ×‘×—×™×¨×ª ××™×§×•×">××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="×¡×•×•×™×˜×”">×¡×•×•×™×˜×”</option>
                    </select>
                </div>
                <div class="room-details hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">×§×•××”</label>
                        <input type="text" name="floor" placeholder="×œ×“×•×’××”: 10" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">××¡×¤×¨ ×—×“×¨</label>
                        <input type="text" name="roomNumber" placeholder="×œ×“×•×’××”: 1234" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª×™××•×¨ × ×•×¡×£ (×œ× ×—×•×‘×”)</label>
                    <textarea name="extraDesc" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="×”×•×¡×£ ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×”×—×“×¨..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ($)</label>
                    <input type="number" name="roomCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <template id="flightTemplate">
        <div class="flight-entry border p-4 rounded-lg bg-gray-50 relative">
            <button class="remove-flight-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">×—×‘×¨×ª ×ª×¢×•×¤×”</label>
                    <input type="text" name="airline" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">××•×¦×</label>
                    <input type="text" name="from" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×™×¢×“</label>
                    <input type="text" name="to" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª××¨×™×š</label>
                    <input type="date" name="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×©×¢×ª ×”××¨××”</label>
                    <input type="text" name="takeoff" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×©×¢×ª × ×—×™×ª×”</label>
                    <input type="text" name="landing" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <template id="transferTemplate">
        <div class="transfer-entry border p-4 rounded-lg bg-gray-50 relative">
            <button class="remove-transfer-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¡×•×’ ×”×¢×‘×¨×”</label>
                    <select name="transferType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        <option value="">×‘×—×¨ ×¡×•×’</option>
                        <option value="×©×“×” ×ª×¢×•×¤×” - ××œ×•×Ÿ">×©×“×” ×ª×¢×•×¤×” - ××œ×•×Ÿ</option>
                        <option value="××œ×•×Ÿ - × ××œ ×§×¨×•×–×™×">××œ×•×Ÿ - × ××œ ×§×¨×•×–×™×</option>
                        <option value="× ××œ ×§×¨×•×–×™× - ××œ×•×Ÿ">× ××œ ×§×¨×•×–×™× - ××œ×•×Ÿ</option>
                        <option value="× ××œ ×§×¨×•×–×™× - ×©×“×” ×ª×¢×•×¤×”">× ××œ ×§×¨×•×–×™× - ×©×“×” ×ª×¢×•×¤×”</option>
                        <option value="××œ×•×Ÿ - ×©×“×” ×ª×¢×•×¤×”">××œ×•×Ÿ - ×©×“×” ×ª×¢×•×¤×”</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">××œ×œ ×—×•×¤×©×™</label>
                    <textarea name="transferFreeText" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                </div>
            </div>
        </div>
    </template>
    <template id="hotelTemplate">
        <div class="hotel-entry border p-4 rounded-lg bg-gray-50 relative">
            <button class="remove-hotel-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">×©× ×”××œ×•×Ÿ</label>
                    <input type="text" name="hotelName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">××¡×¤×¨ ×œ×™×œ×•×ª</label>
                        <input type="number" name="hotelNights" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">××ª××¨×™×š</label>
                        <input type="date" name="hotelStartDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¡×•×’ ×—×“×¨</label>
                    <textarea name="hotelRoomDesc" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¤× ×¡×™×•×Ÿ</label>
                    <select name="hotelPension" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        <option value="">×‘×—×¨</option>
                        <option value="×œ×™× ×” ×‘×œ×‘×“">×œ×™× ×” ×‘×œ×‘×“</option>
                        <option value="×œ×™× ×” ×•××¨×•×—×ª ×‘×•×§×¨">×œ×™× ×” ×•××¨×•×—×ª ×‘×•×§×¨</option>
                        <option value="×—×¦×™ ×¤× ×¡×™×•×Ÿ">×—×¦×™ ×¤× ×¡×™×•×Ÿ</option>
                        <option value="×¤× ×¡×™×•×Ÿ ××œ×">×¤× ×¡×™×•×Ÿ ××œ×</option>
                        <option value="×”×›×œ ×›×œ×•×œ">×”×›×œ ×›×œ×•×œ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ××œ×•×Ÿ ($)</label>
                    <input type="number" name="hotelCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª× ××™ ×‘×™×˜×•×œ</label>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" name="hotelCancellable" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <label class="mr-2">× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ ×¢× ×“××™</label>
                        </div>
                        <div class="hotel-cancel-details hidden space-y-2 mr-6">
                            <input type="text" name="hotelCancelFee" placeholder="×“××™ ×‘×™×˜×•×œ ×œ×—×“×¨" class="w-full border-gray-300 rounded-md shadow-sm">
                            <label class="block text-sm font-medium text-gray-700 mt-2">×¢×“ ×œ×ª××¨×™×š</label>
                            <input type="date" name="hotelCancelDate" class="w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="hotelNoCancel" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <label class="mr-2">×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ/×©×™× ×•×™</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
   
<script>
// --- DATA ---
const cruiseData = {
    "MSC": [
        { name: "MSC Preziosa", video: "https://www.youtube.com/watch?v=LzWd7k_JqwE", image: "https://i.postimg.cc/mrYsMd0L/MSC-300x225.webp" },
        { name: "MSC Splendida", video: "https://www.youtube.com/watch?v=wuI1iqyS80o", image: "https://i.postimg.cc/DwY9X9j3/MSC-300x225.webp" },
        { name: "MSC Magnifica", video: "https://www.youtube.com/watch?v=3VNHV9rVLjk", image: "https://i.postimg.cc/s2rpwX0Y/MSC-300x225.webp" },
        { name: "MSC Musica", video: "https://www.youtube.com/watch?v=ze1A0OJ5ddw", image: "https://i.postimg.cc/K8LPPLQc/MSC-300x225.webp" },
        { name: "MSC Orchestra", video: "https://www.youtube.com/watch?v=eRnLETQwMLA", image: "https://i.postimg.cc/BQwpcHFR/MSC-main-300x225.webp" },
        { name: "MSC Poesia", video: "https://www.youtube.com/watch?v=Pfo49__jig0", image: "https://i.postimg.cc/ZKJztFB2/MSC-300x225.webp" },
        { name: "MSC Armonia", video: "https://www.youtube.com/watch?v=QkVpYGrpb2M", image: "https://i.postimg.cc/FsKGLDYj/MSC-main-300x225.webp" },
        { name: "MSC Lirica", video: "https://www.youtube.com/watch?v=hj0E3bOObdA", image: "https://i.postimg.cc/fbfYFN66/MSC-300x225.webp" },
        { name: "MSC Opera", video: "https://www.youtube.com/watch?v=TwdHj0Cod1M", image: "https://i.postimg.cc/52Y3Pyqy/MSC-main-300x225.webp" },
        { name: "MSC Sinfonia", video: "https://www.youtube.com/watch?v=LWH-o-XGAi4", image: "https://i.postimg.cc/2jwXvpy9/MSC-300x225.webp" },
        { name: "MSC Divina", video: "https://www.youtube.com/watch?v=GnJpM5B8jZbc", image: "https://i.postimg.cc/yxsQtK65/MSC-main-300x225.webp" },
        { name: "MSC Fantasia", video: "https://www.youtube.com/watch?v=m_UlYTVhBzY", image: "https://i.postimg.cc/x877BHWp/MSC-300x225.webp" },
        { name: "MSC World America", video: "https://www.youtube.com/watch?v=jYPYZEQxpHI", image: "https://i.postimg.cc/rwC97TQJ/MSC-World-America-main-300x225.webp" },
        { name: "MSC World Asia", video: "", image: "https://i.postimg.cc/9F3QkF90/MSC-World-Asia.jpg" },
        { name: "MSC World Europa", video: "https://www.youtube.com/watch?v=DL6hnxPqUUo", image: "https://i.postimg.cc/V6jZKvwn/MSC-World-Europa-main-300x225.webp" },
        { name: "MSC Seashore", video: "https://www.youtube.com/watch?v=KHqmnA5UDZo", image: "https://i.postimg.cc/PrX9FX0k/MSC-300x225.webp" },
        { name: "MSC Seaside", video: "https://www.youtube.com/watch?v=1ZNpczW1bL8", image: "https://i.postimg.cc/cHG570f2/MSC-300x225.webp" },
        { name: "MSC Seascape", video: "https://www.youtube.com/watch?v=H2IwM2uoon0", image: "https://i.postimg.cc/wBmGs7RD/MSC-300x225.webp" },
        { name: "MSC Seaview", video: "https://www.youtube.com/watch?v=Fmxi2uJcjQg", image: "https://i.postimg.cc/J4zY5TBr/MSC-300x225.webp" },
        { name: "MSC Bellissima", video: "https://www.youtube.com/watch?v=dkL4LSiilQo", image: "https://i.postimg.cc/SNQ1GmvY/MSC-main-300x225.webp" },
        { name: "MSC Euribia", video: "https://www.youtube.com/watch?v=PDtK-GM5MRM", image: "https://i.postimg.cc/3w2ZTqqH/MSC-Euribia-main-300x225.webp" },
        { name: "MSC Grandiosa", video: "https://www.youtube.com/watch?v=5URU14l8EgE", image: "https://i.postimg.cc/yxjQzGkN/MSC-main-300x225.webp" },
        { name: "MSC Meraviglia", video: "https://www.youtube.com/watch?v=ql-b48h1oUw", image: "https://i.postimg.cc/J4S3HKNd/MSC-300x225.webp" },
        { name: "MSC Virtuosa", video: "https://www.youtube.com/watch?v=OLS9W9cMj1o", image: "https://i.postimg.cc/sXF0PSk3/MSC-300x225.webp" }
    ],
    "Norwegian Cruise Line": [
        { name: "Norwegian Aqua", video: "https://www.youtube.com/watch?v=omxujspTlJw", image: "https://i.postimg.cc/T3hRkwRy/NORWEIGAN-AQUA-300x202.png" },
        { name: "Norwegian Bliss", video: "https://www.youtube.com/watch?v=OtTbM6KUKCk", image: "https://i.postimg.cc/jC05VYZV/Norwegian-Bliss-300x225.webp" },
        { name: "Norwegian Breakaway", video: "https://www.youtube.com/watch?v=v2kFn36kW7w", image: "https://i.postimg.cc/MHx6tmTx/Norwegian-Breakaway-300x225.webp" },
        { name: "Norwegian Dawn", video: "https://www.youtube.com/watch?v=mHw-Gxxe4FA", image: "https://i.postimg.cc/5yMB3TL0/Norwegian-Dawn-300x225.webp" },
        { name: "Norwegian Encore", video: "https://www.youtube.com/watch?v=87Ri0lawr_U", image: "https://i.postimg.cc/wxhcvxYs/Norwegian-Encore-300x225.webp" },
        { name: "Norwegian Epic", video: "https://www.youtube.com/watch?v=Syk85jAwues", image: "https://i.postimg.cc/VLm9byzZ/Norwegian-Epic-300x225.webp" },
        { name: "Norwegian Escape", video: "https://www.youtube.com/watch?v=09YP6AhVAVA", image: "https://i.postimg.cc/CL7GGv1h/Norwegian-Escape-300x225.webp" },
        { name: "Norwegian Getaway", video: "https://www.youtube.com/watch?v=DW9UgPpeXv0", image: "https://i.postimg.cc/x8GFC77H/Norwegian-Getaway-300x225.webp" },
        { name: "Norwegian Jade", video: "https://www.youtube.com/watch?v=HQ-X6Vr0Pu4", image: "https://i.postimg.cc/4xxFfW17/Norwegian-Jade-300x225.webp" },
        { name: "Norwegian Jewel", video: "https://www.youtube.com/watch?v=DKwxbM6VrMww", image: "https://i.postimg.cc/dtq565pH/Norwegian-Jewel-300x225.webp" },
        { name: "Norwegian Joy", video: "https://www.youtube.com/watch?v=HoKjM NrNww0o", image: "https://i.postimg.cc/TPW01F5w/Norwegian-Joy-300x225.webp" },
        { name: "Norwegian Luna", video: "https://www.youtube.com/watch?v=uK2uUAHEs3Q", image: "https://i.postimg.cc/WzZb4xBs/NORWEGIAN-LUNA.jpg" },
        { name: "Norwegian Pearl", video: "https://www.youtube.com/watch?v=bV977mnd8FY", image: "https://i.postimg.cc/sxK9bRqn/Norwegian-Pearl-300x225.webp" },
        { name: "Norwegian Prima", video: "https://www.youtube.com/watch?v=ugOF9hHC5U0", image: "https://i.postimg.cc/xjPRXK8K/Norwegian-Prima-300x225.webp" },
        { name: "Norwegian Sky", video: "https://www.youtube.com/watch?v=3k_inYuoEho", image: "https://i.postimg.cc/yYYTck32/Norwegian-Sky-300x225.webp" },
        { name: "Norwegian Spirit", video: "https://www.youtube.com/watch?v=-GPrS81xEkE", image: "https://i.postimg.cc/L8JBQwTT/Norwegian-Spirit-300x225.webp" },
        { name: "Norwegian Star", video: "", image: "https://i.postimg.cc/qvWcPwDd/Norwegian-Star-300x225.webp" },
        { name: "Norwegian Sun", video: "", image: "https://i.postimg.cc/FsB0SG4J/Norwegian-Sun-300x225.webp" },
        { name: "Norwegian Viva", video: "https://www.youtube.com/watch?v=LDCkEPw9cvk", image: "https://i.postimg.cc/g09RSJrz/Norwegian-Viva-300x225.webp" },
        { name: "Norwegian Gem", video: "", image: "https://i.postimg.cc/90fqRwgp/Norwegian-Gem-300x225.webp" },
        { name: "Pride of America", video: "", image: "https://i.postimg.cc/59Pzcpjk/Pride-of-America-300x225.webp" }
    ],
    "Royal Caribbean": [
        { name: "Adventure of the Seas", video: "", image: "https://i.postimg.cc/gknzTbwr/Adventure-of-the-Seas-300x225.webp" },
        { name: "Allure of the Seas", video: "https://www.youtube.com/watch?v=KbH0tBNGu5Y", image: "https://i.postimg.cc/4xcJXvQg/Allure-of-the-Seas-300x225.webp" },
        { name: "Anthem of the Seas", video: "", image: "https://i.postimg.cc/fbhMy380/Anthem-of-the-Seas-300x225.webp" },
        { name: "Brilliance of the Seas", video: "", image: "https://i.postimg.cc/3wCYvKqf/Brilliance-of-the-Seas-300x225.webp" },
        { name: "Enchantment of the Seas", video: "", image: "https://i.postimg.cc/NMsY83qs/Enchantment-of-the-Seas-300x225.webp" },
        { name: "Explorer of the Seas", video: "https://www.youtube.com/watch?v=DTi1YCmpAa4", image: "https://i.postimg.cc/4xpTDfX4/Explorer-of-the-Seas-300x225.webp" },
        { name: "Freedom of the Seas", video: "https://www.youtube.com/watch?v=348M1LSXFHA", image: "https://i.postimg.cc/Bvgfvm8d/Freedom-of-the-Seas-300x225.webp" },
        { name: "Grandeur of the Seas", video: "", image: "https://i.postimg.cc/269pQ37G/Grandeur-of-the-Seas-300x225.webp" },
        { name: "Harmony of the Seas", video: "https://www.youtube.com/watch?v=mYuY5b88bZU", image: "https://i.postimg.cc/Y0v5bkXH/Harmony-of-the-Seas-300x225.webp" },
        { name: "Icon of the Seas", video: "https://www.youtube.com/watch?v=E66ugm_xhr4", image: "https://i.postimg.cc/ZYgt0BRK/Icon-of-the-Seas-300x225.webp" },
        { name: "Independence of the Seas", video: "https://www.youtube.com/watch?v=sZEigiftcII", image: "https://i.postimg.cc/2SxBzfwm/Independence-of-the-Seas-300x225.webp" },
        { name: "Jewel of the Seas", video: "", image: "https://i.postimg.cc/nzXsY9tc/Jewel-of-the-Seas-300x225.webp" },
        { name: "Legend of the Seas", video: "", image: "https://i.postimg.cc/C19RvMFC/LEGEND-OF-THE-SEAS-300x225.webp" },
        { name: "Liberty of the Seas", video: "https://www.youtube.com/watch?v=uKTrVQSQVwo", image: "https://i.postimg.cc/ZYyBWNcw/Liberty-of-the-Seas-300x225.webp" },
        { name: "Mariner of the Seas", video: "", image: "https://i.postimg.cc/QxQFbrv5/Mariner-of-the-Seas-300x225.webp" },
        { name: "Navigator of the Seas", video: "", image: "https://i.postimg.cc/9Qcrgnjk/Navigator-of-the-Seas-300x225.webp" },
        { name: "Oasis of the Seas", video: "https://www.youtube.com/watch?v=GUN6KVvFlYE", image: "https://i.postimg.cc/PrytJfB6/Oasis-of-the-Seas-300x225.webp" },
        { name: "Odyssey of the Seas", video: "", image: "https://i.postimg.cc/Fzm4FwG5/Odyssey-of-the-Seas-300x225.webp" },
        { name: "Ovation of the Seas", video: "", image: "https://i.postimg.cc/vTzd4XS1/Ovation-of-the-Seas-300x225.webp" },
        { name: "Quantum of the Seas", video: "", image: "https://i.postimg.cc/SsgrjMfS/Quantum-of-the-Seas-300x225.webp" },
        { name: "Radiance of the Seas", video: "", image: "https://i.postimg.cc/rsz94wfS/Radiance-of-the-Seas-300x225.webp" },
        { name: "Rhapsody of the Seas", video: "", image: "https://i.postimg.cc/zXbjX3bN/Rhapsody-of-the-Seas-300x225.webp" },
        { name: "Serenade of the Seas", video: "", image: "https://i.postimg.cc/02TC6xDw/Serenade-of-the-Seas-300x225.webp" },
        { name: "Spectrum of the Seas", video: "", image: "https://i.postimg.cc/bv8HTT6Y/Spectrum-of-the-Seas-300x225.webp" },
        { name: "Star of the Seas", video: "https://www.youtube.com/watch?v=Dzy3kbEqXXQ", image: "https://i.postimg.cc/284SNRdw/Star-of-the-Seas.jpg" },
        { name: "Symphony of the Seas", video: "https://www.youtube.com/watch?v=GOPIRTWBNMc", image: "https://i.postimg.cc/0NfGHw3Y/Symphony-of-the-Seas-300x225.webp" },
        { name: "Utopia of the Seas", video: "https://www.youtube.com/watch?v=dEQsBIA0jnE", image: "https://i.postimg.cc/Z54KT7Vh/Utopia-of-the-Seas.jpg" }
    ],
    "CELEBRITY": [
        { name: "Celebrity Apex", video: "https://www.youtube.com/watch?v=tP2rwE33VlU", image: "https://i.postimg.cc/76hB396G/Celebrity-Apex-300x225.webp" },
        { name: "Celebrity Ascent", video: "", image: "https://i.postimg.cc/zvR0MfTq/Celebrity-Ascent-300x225.webp" },
        { name: "Celebrity Beyond", video: "", image: "https://i.postimg.cc/JzmCNwWs/Celebrity-Beyond-300x225.webp" },
        { name: "Celebrity Constellation", video: "", image: "https://i.postimg.cc/N0jhn1FY/Celebrity-Constellation-300x225.webp" },
        { name: "Celebrity Eclipse", video: "", image: "https://i.postimg.cc/TwKzdfn4/Celebrity-Eclipse-300x225.webp" },
        { name: "Celebrity Edge", video: "https://www.youtube.com/watch?v=pZnY58nFJZA", image: "https://i.postimg.cc/1X6bFBC0/Celebrity-Edge-300x225.webp" },
        { name: "Celebrity Equinox", video: "", image: "https://i.postimg.cc/L6tr6yZ2/Celebrity-Equinox-300x225.webp" },
        { name: "Celebrity Flora", video: "", image: "https://i.postimg.cc/g2G1wvvR/Celebrity-Flora-300x225.webp" },
        { name: "Celebrity Infinity", video: "", image: "https://i.postimg.cc/jj59ct3S/Celebrity-Infinity-300x225.webp" },
        { name: "Celebrity Millennium", video: "", image: "https://i.postimg.cc/KYHWswCr/Celebrity-Millennium-300x225.webp" },
        { name: "Celebrity Reflection", video: "", image: "https://i.postimg.cc/C5yQwDhR/Celebrity-Reflection-300x225.webp" },
        { name: "Celebrity Silhouette", video: "", image: "https://i.postimg.cc/RhcbhFhX/Celebrity-Silhouette-300x225.webp" },
        { name: "Celebrity Solstice", video: "", image: "https://i.postimg.cc/1R6dJWBw/Celebrity-Solstice-300x225.webp" },
        { name: "Celebrity Summit", video: "https://www.youtube.com/watch?v=9_pogpg6sVc", image: "https://i.postimg.cc/VL8VTjZT/Celebrity-Summit-300x225.webp" },
        { name: "Celebrity Xce", video: "", image: "https://i.postimg.cc/ZKxMhC1q/Celebrity-Xcel-300x225.webp" }
    ],
    "COSTA": [
        { name: "Costa Deliziosa", video: "", image: "https://i.postimg.cc/ryCJD7gn/Costa-Deliziosa-300x225.webp" },
        { name: "Costa Diadema", video: "", image: "https://i.postimg.cc/Fsrx3GB9/Costa-Diadema-300x225.webp" },
        { name: "Costa Fascinosa", video: "https://www.youtube.com/watch?v=Drd_TRoAHYs", image: "https://i.postimg.cc/TYtJ9mzn/Costa-Fascinosa-300x225.webp" },
        { name: "Costa Favolosa", video: "", image: "https://i.postimg.cc/t4ft0bCT/Costa-Favolosa-300x225.webp" },
        { name: "Costa Fortuna", video: "https://www.youtube.com/watch?v=YCmi6a04q80", image: "https://i.postimg.cc/Ssb6sG9b/Costa-Fortuna-300x225.webp" },
        { name: "Costa Pacifica", video: "", image: "https://i.postimg.cc/bNwQsrZr/Costa-Pacifica-300x225.webp" },
        { name: "Costa Serena", video: "", image: "https://i.postimg.cc/7Z9Pb3WJ/Costa-Serena.jpg" },
        { name: "Costa Smeralda", video: "https://www.youtube.com/watch?v=YV1XNNUfcrg", image: "https://i.postimg.cc/YCgj9Bzj/Costa-Smeralda-300x225.webp" },
        { name: "Costa Toscana", video: "", image: "https://i.postimg.cc/FRK90M3y/Costa-Toscana-300x225.webp" },
        { name: "Costa Firenze", video: "", image: "https://i.postimg.cc/sgRsTQ5D/Costa-Firenze-300x225.webp" }
    ],
    "Carnival": [
        { name: "Carnival Adventure", video: "", image: "" },
        { name: "Carnival Breeze", video: "", image: "" },
        { name: "Carnival Celebration", video: "", image: "" },
        { name: "Carnival Conquest", video: "", image: "" },
        { name: "Carnival Dream", video: "", image: "" },
        { name: "Carnival Elation", video: "", image: "" },
        { name: "Carnival Encounter", video: "", image: "" },
        { name: "Carnival Festivale", video: "", image: "" },
        { name: "Carnival Firenze", video: "", image: "" },
        { name: "Carnival Freedom", video: "", image: "" },
        { name: "Carnival Glory", video: "", image: "" },
        { name: "Carnival Horizon", video: "", image: "" },
        { name: "Carnival Jubilee", video: "", image: "" },
        { name: "Carnival Legend", video: "", image: "" },
        { name: "Carnival Liberty", video: "", image: "" },
        { name: "Carnival Luminosa", video: "", image: "" },
        { name: "Carnival Magic", video: "", image: "" },
        { name: "Carnival Miracle", video: "", image: "" },
        { name: "Carnival Panorama", video: "", image: "" },
        { name: "Carnival Paradise", video: "", image: "" },
        { name: "Carnival Pride", video: "", image: "" },
        { name: "Carnival Radiance", video: "", image: "" },
        { name: "Carnival Spirit", video: "", image: "" },
        { name: "Carnival Splendor", video: "", image: "" },
        { name: "Carnival Sunrise", video: "", image: "" },
        { name: "Carnival Sunshine", video: "", image: "" },
        { name: "Carnival Valor", video: "", image: "" },
        { name: "Carnival Venezia", video: "", image: "" },
        { name: "Carnival Vista", video: "", image: "" },
        { name: "Mardi Gras", video: "", image: "" }
    ],
    "Azamara": [
        { name: "Azamara Journey", video: "", image: "" },
        { name: "Azamara Onward", video: "", image: "" },
        { name: "Azamara Pursuit", video: "", image: "" },
        { name: "Azamara Quest", video: "", image: "" }
    ],
    "Virgin Voyages": [
        { name: "Brilliant Lady", video: "", image: "" },
        { name: "Resilient Lady", video: "", image: "" },
        { name: "Scarlet Lady", video: "", image: "" },
        { name: "Valiant Lady", video: "", image: "" }
    ],
    "Seabourn": [
        { name: "Seabourn Encore", video: "", image: "" },
        { name: "Seabourn Ovation", video: "", image: "" },
        { name: "Seabourn Pursuit", video: "", image: "" },
        { name: "Seabourn Quest", video: "", image: "" },
        { name: "Seabourn Sojourn", video: "", image: "" },
        { name: "Seabourn Venture", video: "", image: "" }
    ],
    "Regent Seven Seas": [
        { name: "Seven Seas Explorer", video: "", image: "" },
        { name: "Seven Seas Grandeur", video: "", image: "" },
        { name: "Seven Seas Mariner", video: "", image: "" },
        { name: "Seven Seas Navigator", video: "", image: "" },
        { name: "Seven Seas Prestige", video: "", image: "" },
        { name: "Seven Seas Splendor", video: "", image: "" },
        { name: "Seven Seas Voyager", video: "", image: "" }
    ],
    "Ponant": [
        { name: "L'Austral", video: "", image: "" },
        { name: "Le Bellot", video: "", image: "" },
        { name: "Le Boreal", video: "", image: "" },
        { name: "Le Bougainville", video: "", image: "" },
        { name: "Le Champlain", video: "", image: "" },
        { name: "Le Commandant Charcot", video: "", image: "" },
        { name: "Le Dumont D'urville", video: "", image: "" },
        { name: "Le Jacques Cartier", video: "", image: "" },
        { name: "Le Laperouse", video: "", image: "" },
        { name: "Le Lyrial", video: "", image: "" },
        { name: "Le Ponant", video: "", image: "" },
        { name: "Le Soleal", video: "", image: "" },
        { name: "Spirit of Ponant", video: "", image: "" }
    ],
    "P&O Cruises": [
        { name: "Arcadia", video: "", image: "" },
        { name: "Arvia", video: "", image: "" },
        { name: "Aurora", video: "", image: "" },
        { name: "Azura", video: "", image: "" },
        { name: "Britannia", video: "", image: "" },
        { name: "Iona", video: "", image: "" },
        { name: "Ventura", video: "", image: "" }
    ],
    "Oceania Cruises": [
        { name: "Oceania Allura", video: "", image: "" },
        { name: "Oceania Insignia", video: "", image: "" },
        { name: "Oceania Marina", video: "", image: "" },
        { name: "Oceania Nautica", video: "", image: "" },
        { name: "Oceania Regatta", video: "", image: "" },
        { name: "Oceania Riviera", video: "", image: "" },
        { name: "Oceania Sirena", video: "", image: "" },
        { name: "Oceania Vista", video: "", image: "" }
    ],
    "Holland America": [
        { name: "Eurodam", video: "", image: "" },
        { name: "Koningsdam", video: "", image: "" },
        { name: "Nieuw Amsterdam", video: "", image: "" },
        { name: "Nieuw Statendam", video: "", image: "" },
        { name: "Noordam", video: "", image: "" },
        { name: "Oosterdam", video: "", image: "" },
        { name: "Rotterdam", video: "", image: "" },
        { name: "Volendam", video: "", image: "" },
        { name: "Westerdam", video: "", image: "" },
        { name: "Zaandam", video: "", image: "" },
        { name: "Zuiderdam", video: "", image: "" }
    ],
    "Disney Cruise Line": [
        { name: "Disney Adventure", video: "", image: "" },
        { name: "Disney Destiny", video: "", image: "" },
        { name: "Disney Dream", video: "", image: "" },
        { name: "Disney Fantasy", video: "", image: "" },
        { name: "Disney Magic", video: "", image: "" },
        { name: "Disney Treasure", video: "", image: "" },
        { name: "Disney Wish", video: "", image: "" },
        { name: "Disney Wonder", video: "", image: "" }
    ],
    "Cunard": [
        { name: "Queen Mary 2", video: "", image: "" },
        { name: "Queen Anne", video: "", image: "" },
        { name: "Queen Elizabeth", video: "", image: "" },
        { name: "Queen Victoria", video: "", image: "" }
    ],
    "Crystal": [
        { name: "Crystal Serenity", video: "", image: "" },
        { name: "Crystal Symphony", video: "", image: "" }
    ]
};
const advisors = {
    "lior": { name: "×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™", email: "lior@balicruise.co.il", pass: "lior1234", details: "×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™ / Lior Dovinovsky| ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | lior@balicruise.co.il" },
    "tatiana": { name: "×˜×˜×™×× ×” ×œ××•× ×•×‘", email: "tatiana@balicruise.co.il", pass: "tatiana1234", details: "×˜×˜×™×× ×” ×œ××•× ×•×‘/Tatyana Leonov | ×™×•×¢×¦×ª ×©×™×™×˜ | 03-3106454 | tatiana@balicruise.co.il" },
    "koren": { name: "×§×•×¨×Ÿ ××‘×¡×¢×™×“", email: "koren@balicruise.co.il", pass: "koren1234", details: "×§×•×¨×Ÿ ××‘×¡×¢×™×“ | Koren avsaid | ×× ×”×œ ××—×œ×§×ª ×©×™×™×˜ | 03-3106454 | Koren@balicruise.co.il" },
    "yarden": { name: "×™×¨×“×Ÿ ×©×§×“", email: "yarden@balicruise.co.il", pass: "yarden1234", details: "×™×¨×“×Ÿ ×©×§×“ | Yarden shaked | ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | Yarden@balicruise.co.il" },
    "nir": { name: "× ×™×¨", email: "nir@balicruise.co.il", pass: "nir1234", details: "× ×™×¨ | Nir | ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | nir@balicruise.co.il" }
};
const guaranteeMessage = "××™×§×•× ×”×—×“×¨ ×™×™×§×‘×¢ ×¢×œ ×™×“×™ ×—×‘×¨×ª ×”×©×™×™×˜";
const detailRoomTypes = [
    "×¤× ×™××™ ×¢× ×‘×—×™×¨×ª ××™×§×•×", "×—×œ×•×Ÿ ×¢× ×‘×—×™×¨×ª ××™×§×•×", "××¨×¤×¡×ª ×œ×™× ×¢× ×‘×—×™×¨×ª ××™×§×•×",
    "××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×¢× ×‘×—×™×¨×ª ××™×§×•×", "×¡×•×•×™×˜×”"
];
let currentQuoteId = null;
let isLoaded = false;
const DOMElements = {
    loginScreen: document.getElementById('loginScreen'),
    mainContent: document.getElementById('mainContent'),
    loginBtn: document.getElementById('loginBtn'),
    emailInput: document.getElementById('email'),
    passwordInput: document.getElementById('password'),
    loginError: document.getElementById('loginError'),
    loggedInAdvisor: document.getElementById('loggedInAdvisor'),
    currentQuoteNumber: document.getElementById('currentQuoteNumber'),
    inputForm: document.getElementById('inputForm'),
    clientName: document.getElementById('clientName'),
    offerDate: document.getElementById('offerDate'),
    advisor: document.getElementById('advisor'),
    cruiseLine: document.getElementById('cruiseLine'),
    shipName: document.getElementById('shipName'),
    shipVideo: document.getElementById('shipVideo'),
    cruiseDuration: document.getElementById('cruiseDuration'),
    cruiseStartDate: document.getElementById('cruiseStartDate'),
    departurePort: document.getElementById('departurePort'),
    arrivalPort: document.getElementById('arrivalPort'),
    itineraryPasteTarget: document.getElementById('itineraryPasteTarget'),
    roomsContainer: document.getElementById('roomsContainer'),
    addRoomBtn: document.getElementById('addRoomBtn'),
    hideTotal: document.getElementById('hideTotal'),
    hideCruise: document.getElementById('hideCruise'),
    cruiseFields: document.getElementById('cruiseFields'),
    cruiseSectionContainer: document.getElementById('cruiseSectionContainer'),
    customInclusions: document.getElementById('customInclusions'),
    hideMealInclusion: document.getElementById('hideMealInclusion'),
    flightsContainer: document.getElementById('flightsContainer'),
    addFlightBtn: document.getElementById('addFlightBtn'),
    flightIncludes: document.getElementById('flightIncludes'),
    flightFreeText: document.getElementById('flightFreeText'),
    flightCost: document.getElementById('flightCost'),
    flightNoCancel: document.getElementById('flightNoCancel'),
    flightCancellable: document.getElementById('flightCancellable'),
    flightCancelDetails: document.getElementById('flightCancelDetails'),
    flightCancelCheck: document.getElementById('flightCancelCheck'),
    flightChangeCheck: document.getElementById('flightChangeCheck'),
    flightCancelFee: document.getElementById('flightCancelFee'),
    flightChangeFee: document.getElementById('flightChangeFee'),
    transfersContainer: document.getElementById('transfersContainer'),
    addTransferBtn: document.getElementById('addTransferBtn'),
    transfersCost: document.getElementById('transfersCost'),
    transfersNoCancel: document.getElementById('transfersNoCancel'),
    transfersCancellable: document.getElementById('transfersCancellable'),
    transfersCancelDetails: document.getElementById('transfersCancelDetails'),
    transfersCancelDate: document.getElementById('transfersCancelDate'),
    transfersCancelFee: document.getElementById('transfersCancelFee'),
    hotelsContainer: document.getElementById('hotelsContainer'),
    addHotelBtn: document.getElementById('addHotelBtn'),
    generatePDFBtn: document.getElementById('generatePDFBtn'),
    saveQuoteBtn: document.getElementById('saveQuoteBtn'),
    newQuoteBtn: document.getElementById('newQuoteBtn'),
    previewClientName: document.getElementById('previewClientName'),
    previewDate: document.getElementById('previewDate'),
    previewQuoteNumber: document.getElementById('previewQuoteNumber'),
    previewDocTitle: document.getElementById('previewDocTitle'),
    previewOpeningLine: document.getElementById('previewOpeningLine'),
    previewCruiseDetails: document.getElementById('previewCruiseDetails'),
    previewCruiseLine: document.getElementById('previewCruiseLine'),
    previewShipName: document.getElementById('previewShipName'),
    previewCruiseDuration: document.getElementById('previewCruiseDuration'),
    previewCruiseDate: document.getElementById('previewCruiseDate'),
    previewPorts: document.getElementById('previewPorts'),
    previewItinerarySection: document.getElementById('previewItinerarySection'),
    previewItineraryImage: document.getElementById('previewItineraryImage'),
    previewRoomsSection: document.getElementById('previewRoomsSection'),
    previewRoomsContainer: document.getElementById('previewRoomsContainer'),
    previewGuaranteeNote: document.getElementById('previewGuaranteeNote'),
    previewCruiseInclusions: document.getElementById('previewCruiseInclusions'),
    previewCruiseInclusionsList: document.getElementById('previewCruiseInclusionsList'),
    previewInclusions: document.getElementById('previewInclusions'),
    previewFlightsContainer: document.getElementById('previewFlightsContainer'),
    previewFlightsList: document.getElementById('previewFlightsList'),
    previewFlightIncludesContainer: document.getElementById('previewFlightIncludesContainer'),
    previewFlightIncludes: document.getElementById('previewFlightIncludes'),
    previewFlightFreeText: document.getElementById('previewFlightFreeText'),
    previewFlightCost: document.getElementById('previewFlightCost'),
    previewFlightConditions: document.getElementById('previewFlightConditions'),
    previewHotelsSection: document.getElementById('previewHotelsSection'),
    previewHotelsContainer: document.getElementById('previewHotelsContainer'),
    previewTransfersContainer: document.getElementById('previewTransfersContainer'),
    previewTransfersList: document.getElementById('previewTransfersList'),
    previewTransfersCost: document.getElementById('previewTransfersCost'),
    previewTransfersConditions: document.getElementById('previewTransfersConditions'),
    previewTotalContainer: document.getElementById('previewTotalContainer'),
    previewTotalPrice: document.getElementById('previewTotalPrice'),
    previewShipImageSection: document.getElementById('previewShipImageSection'),
    previewShipImage: document.getElementById('previewShipImage'),
    previewShipVideo: document.getElementById('previewShipVideo'),
    previewAdvisor: document.getElementById('previewAdvisor'),
    previewElement: document.getElementById('preview'),
    importantNote: document.getElementById('importantNote'),
    previewInternalNumber: document.getElementById('previewInternalNumber'),
    savedQuotesModal: document.getElementById('savedQuotesModal'),
    showSavedQuotesBtn: document.getElementById('showSavedQuotesBtn'),
    closeModalBtn: document.getElementById('closeModalBtn'),
    savedQuotesList: document.getElementById('savedQuotesList'),
};
document.addEventListener('DOMContentLoaded', () => {
    setupEventListeners();
    const loggedInUser = sessionStorage.getItem('loggedInAdvisor');
    if (loggedInUser) {
        showMainContent(loggedInUser);
    }
});
function setupEventListeners() {
    DOMElements.loginBtn.addEventListener('click', handleLogin);
    DOMElements.passwordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleLogin();
    });
    DOMElements.inputForm.addEventListener('input', updateStateAndPreview);
    DOMElements.inputForm.addEventListener('change', updateStateAndPreview);
    DOMElements.addRoomBtn.addEventListener('click', () => { addRoom(); updateStateAndPreview(); });
    DOMElements.addFlightBtn.addEventListener('click', () => { addFlight(); updateStateAndPreview(); });
    DOMElements.addHotelBtn.addEventListener('click', () => { addHotel(); updateStateAndPreview(); });
    DOMElements.addTransferBtn.addEventListener('click', () => { addTransfer(); updateStateAndPreview(); });
    DOMElements.cruiseLine.addEventListener('change', () => {
        populateShips();
        updateStateAndPreview();
    });
    DOMElements.shipName.addEventListener('change', () => {
        const cruiseLine = DOMElements.cruiseLine.value;
        const shipName = DOMElements.shipName.value;
        const ship = cruiseData[cruiseLine]?.find(s => s.name === shipName);
        DOMElements.shipVideo.value = ship?.video || '';
        updateStateAndPreview();
    });
    DOMElements.itineraryPasteTarget.addEventListener('paste', handlePaste);
    DOMElements.generatePDFBtn.addEventListener('click', generatePDF);
    DOMElements.saveQuoteBtn.addEventListener('click', saveQuote);
    DOMElements.newQuoteBtn.addEventListener('click', startNewQuote);
    DOMElements.flightCancellable.addEventListener('change', toggleFlightCancelDetails);
    DOMElements.flightNoCancel.addEventListener('change', toggleFlightCancelDetails);
    DOMElements.transfersCancellable.addEventListener('change', toggleTransfersCancelDetails);
    DOMElements.showSavedQuotesBtn.addEventListener('click', showSavedQuotes);
    DOMElements.closeModalBtn.addEventListener('click', () => DOMElements.savedQuotesModal.style.display = 'none');
    window.addEventListener('click', (event) => {
        if (event.target == DOMElements.savedQuotesModal) {
            DOMElements.savedQuotesModal.style.display = 'none';
        }
    });
}
function handleLogin() {
    const email = DOMElements.emailInput.value.toLowerCase();
    const password = DOMElements.passwordInput.value;
    const advisorKey = Object.keys(advisors).find(key => advisors[key].email === email);
    if (advisorKey && advisors[advisorKey].pass === password) {
        sessionStorage.setItem('loggedInAdvisor', advisorKey);
        showMainContent(advisorKey);
    } else {
        DOMElements.loginError.classList.remove('hidden');
    }
}
function showMainContent(advisorKey) {
    DOMElements.loginScreen.classList.add('hidden');
    DOMElements.mainContent.classList.remove('hidden');
    DOMElements.loggedInAdvisor.textContent = advisors[advisorKey].name;
    DOMElements.advisor.value = advisorKey;
    populateShips();
    startNewQuote();
}
function getNextQuoteNumber() {
    let lastNumber = parseInt(localStorage.getItem('lastQuoteNumber') || '0');
    lastNumber++;
    localStorage.setItem('lastQuoteNumber', lastNumber);
    return lastNumber;
}
function saveQuote() {
    const state = getFormState();
    if (!state.clientName) {
        alert('×™×© ×œ×”×–×™×Ÿ ×©× ×œ×§×•×— ×œ×¤× ×™ ×©××™×¨×ª ×”×”×¦×¢×”.');
        return;
    }
    const allQuotes = JSON.parse(localStorage.getItem('savedQuotes') || '[]');
    const advisorKey = sessionStorage.getItem('loggedInAdvisor');
    if (currentQuoteId) {
        const quoteIndex = allQuotes.findIndex(q => q.id === currentQuoteId);
        if (quoteIndex > -1) {
            state.quoteNumber = allQuotes[quoteIndex].quoteNumber;
            allQuotes[quoteIndex].state = state;
            allQuotes[quoteIndex].clientName = state.clientName;
            allQuotes[quoteIndex].date = new Date().toISOString();
        }
    } else {
        const quoteNumber = getNextQuoteNumber();
        currentQuoteId = `Q${quoteNumber}-${Date.now()}`;
        state.quoteNumber = quoteNumber;
        allQuotes.push({
            id: currentQuoteId,
            quoteNumber: quoteNumber,
            advisor: advisorKey,
            clientName: state.clientName,
            date: new Date().toISOString(),
            state: state
        });
    }
    DOMElements.currentQuoteNumber.textContent = `××¡×¤×¨ ×”×¦×¢×”: ${state.quoteNumber}`;
    localStorage.setItem('savedQuotes', JSON.stringify(allQuotes));
    alert(`×”×¦×¢×” ××¡×¤×¨ ${state.quoteNumber} ×¢×‘×•×¨ ${state.clientName} × ×©××¨×” ×‘×”×¦×œ×—×”!`);
}
function loadQuote(quoteId) {
    const allQuotes = JSON.parse(localStorage.getItem('savedQuotes') || '[]');
    const quote = allQuotes.find(q => q.id === quoteId);
    if (quote) {
        currentQuoteId = quote.id;
        isLoaded = true;
        DOMElements.currentQuoteNumber.textContent = `××¡×¤×¨ ×”×¦×¢×”: ${quote.quoteNumber}`;
        loadState(quote.state);
        DOMElements.savedQuotesModal.style.display = 'none';
    }
}
function deleteQuote(quoteId) {
    if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×”×¦×¢×” ×–×•?')) {
        let allQuotes = JSON.parse(localStorage.getItem('savedQuotes') || '[]');
        allQuotes = allQuotes.filter(q => q.id !== quoteId);
        localStorage.setItem('savedQuotes', JSON.stringify(allQuotes));
        showSavedQuotes();
    }
}
function startNewQuote() {
    currentQuoteId = null;
    isLoaded = false;
    DOMElements.currentQuoteNumber.textContent = '×”×¦×¢×” ×—×“×©×”';
    DOMElements.inputForm.reset();
    DOMElements.roomsContainer.innerHTML = ' <h3 class="text-xl font-bold mb-3">×—×“×¨×™×</h3>';
    DOMElements.flightsContainer.innerHTML = '';
    DOMElements.hotelsContainer.innerHTML = '';
    DOMElements.transfersContainer.innerHTML = '';
    DOMElements.offerDate.valueAsDate = new Date();
    const loggedInUser = sessionStorage.getItem('loggedInAdvisor');
    if (loggedInUser) {
        DOMElements.advisor.value = loggedInUser;
    }
    addRoom();
    addFlight();
    addHotel();
    addTransfer();
    updateStateAndPreview();
}
function showSavedQuotes() {
    const advisorKey = sessionStorage.getItem('loggedInAdvisor');
    const allQuotes = JSON.parse(localStorage.getItem('savedQuotes') || '[]');
    const advisorQuotes = allQuotes.filter(q => q.advisor === advisorKey).sort((a, b) => b.quoteNumber - a.quoteNumber);
    DOMElements.savedQuotesList.innerHTML = '';
    if (advisorQuotes.length === 0) {
        DOMElements.savedQuotesList.innerHTML = '<p>×œ× × ××¦××• ×”×¦×¢×•×ª ×©××•×¨×•×ª.</p>';
    } else {
        advisorQuotes.forEach(quote => {
            const div = document.createElement('div');
            div.className = 'flex justify-between items-center p-2 border rounded';
            div.innerHTML = `
                <div>
                    <p class="font-bold">×”×¦×¢×” #${quote.quoteNumber} - ${quote.clientName}</p>
                    <p class="text-sm text-gray-500">${new Date(quote.date).toLocaleDateString('he-IL')}</p>
                </div>
                <div>
                    <button data-id="${quote.id}" class="load-quote-btn bg-blue-500 text-white px-3 py-1 rounded text-sm ml-2">×˜×¢×Ÿ</button>
                    <button data-id="${quote.id}" class="delete-quote-btn bg-red-500 text-white px-3 py-1 rounded text-sm">××—×§</button>
                </div>
            `;
            DOMElements.savedQuotesList.appendChild(div);
        });
        DOMElements.savedQuotesList.querySelectorAll('.load-quote-btn').forEach(btn => {
            btn.addEventListener('click', (e) => loadQuote(e.target.dataset.id));
        });
        DOMElements.savedQuotesList.querySelectorAll('.delete-quote-btn').forEach(btn => {
            btn.addEventListener('click', (e) => deleteQuote(e.target.dataset.id));
        });
    }
    DOMElements.savedQuotesModal.style.display = 'block';
}
function getFormState() {
    const state = {};
    const formInputs = DOMElements.inputForm.querySelectorAll('input, select, textarea');
    formInputs.forEach(input => {
        if (input.closest('.room-entry, .flight-entry, .transfer-entry, .hotel-entry')) return;
        if (input.type === 'radio') {
            if (input.checked) state[input.name] = input.value;
        } else if (input.type === 'checkbox') {
            state[input.id] = input.checked;
        } else {
            state[input.id] = input.value;
        }
    });
    state.itineraryImageSrc = DOMElements.previewItineraryImage.src;
    state.quoteNumber = DOMElements.currentQuoteNumber.textContent.replace('××¡×¤×¨ ×”×¦×¢×”: ', '');
    const dynamicFields = {
        rooms: [], flights: [], transfers: [], hotels: []
    };
    DOMElements.roomsContainer.querySelectorAll('.room-entry').forEach(div => {
        const data = {};
        div.querySelectorAll('input, select, textarea').forEach(input => data[input.name] = input.value);
        dynamicFields.rooms.push(data);
    });
    DOMElements.flightsContainer.querySelectorAll('.flight-entry').forEach(div => {
        const data = {};
        div.querySelectorAll('input').forEach(input => data[input.name] = input.value);
        dynamicFields.flights.push(data);
    });
    DOMElements.transfersContainer.querySelectorAll('.transfer-entry').forEach(div => {
        const data = {};
        div.querySelectorAll('select, textarea').forEach(input => data[input.name] = input.value);
        dynamicFields.transfers.push(data);
    });
    DOMElements.hotelsContainer.querySelectorAll('.hotel-entry').forEach(div => {
        const data = {};
        div.querySelectorAll('input, select, textarea').forEach(input => {
            if (input.type === 'checkbox') data[input.name] = input.checked;
            else data[input.name] = input.value;
        });
        dynamicFields.hotels.push(data);
    });
    state.dynamicFields = dynamicFields;
    return state;
}
function loadState(state) {
    const formInputs = DOMElements.inputForm.querySelectorAll('input, select, textarea');
    formInputs.forEach(input => {
        if (input.closest('.room-entry, .flight-entry, .transfer-entry, .hotel-entry')) return;
        if (input.type === 'radio') {
            if (state[input.name] === input.value) input.checked = true;
        } else if (input.type === 'checkbox') {
            if (state[input.id] !== undefined) input.checked = state[input.id];
        } else {
            if (state[input.id] !== undefined) input.value = state[input.id];
        }
    });
    DOMElements.previewItineraryImage.src = state.itineraryImageSrc || 'https://placehold.co/800x300/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××¡×œ×•×œ';
    DOMElements.roomsContainer.innerHTML = ' <h3 class="text-xl font-bold mb-3">×—×“×¨×™×</h3>';
    DOMElements.flightsContainer.innerHTML = '';
    DOMElements.transfersContainer.innerHTML = '';
    DOMElements.hotelsContainer.innerHTML = '';
    populateShips(state.shipName);
    state.dynamicFields.rooms.forEach(data => addRoom(data));
    state.dynamicFields.flights.forEach(data => addFlight(data));
    state.dynamicFields.transfers.forEach(data => addTransfer(data));
    if (state.dynamicFields.hotels) {
        state.dynamicFields.hotels.forEach(data => addHotel(data));
    }
    updatePreview();
}
function updateStateAndPreview() {
    updatePreview();
}
function populateShips(selectedShip) {
    const cruiseLine = DOMElements.cruiseLine.value;
    const shipSelect = DOMElements.shipName;
    const currentVal = selectedShip || shipSelect.value;
    shipSelect.innerHTML = '';
    const ships = cruiseData[cruiseLine] || [];
    ships.forEach(ship => {
        const option = document.createElement('option');
        option.value = ship.name;
        option.textContent = ship.name;
        shipSelect.appendChild(option);
    });
    if(currentVal) shipSelect.value = currentVal;
}
function addRoom(initialData = {}) {
    const template = document.getElementById('roomTemplate');
    const clone = template.content.cloneNode(true);
    const roomDiv = clone.querySelector('.room-entry');
    DOMElements.roomsContainer.appendChild(clone);
    if (Object.keys(initialData).length > 0) {
        for (const key in initialData) {
            const input = roomDiv.querySelector(`[name="${key}"]`);
            if (input) input.value = initialData[key];
        }
    }
    roomDiv.querySelector('.remove-room-btn').addEventListener('click', () => { roomDiv.remove(); updateStateAndPreview(); });
    roomDiv.querySelector('select[name="roomType"]').addEventListener('change', () => toggleRoomDetails(roomDiv));
    toggleRoomDetails(roomDiv);
}
function addFlight(initialData = {}) {
    const template = document.getElementById('flightTemplate');
    const clone = template.content.cloneNode(true);
    const flightDiv = clone.querySelector('.flight-entry');
    DOMElements.flightsContainer.appendChild(clone);
    if (Object.keys(initialData).length > 0) {
        for (const key in initialData) {
            const input = flightDiv.querySelector(`[name="${key}"]`);
            if (input) input.value = initialData[key];
        }
    } else {
         const existingFlights = DOMElements.flightsContainer.querySelectorAll('.flight-entry');
         if (existingFlights.length > 1) {
            const prevFlight = existingFlights[existingFlights.length - 2];
            const prevFrom = prevFlight.querySelector('input[name="from"]').value;
            const prevTo = prevFlight.querySelector('input[name="to"]').value;
            const prevAirline = prevFlight.querySelector('input[name="airline"]').value;
            flightDiv.querySelector('input[name="airline"]').value = prevAirline;
            flightDiv.querySelector('input[name="from"]').value = prevTo;
            flightDiv.querySelector('input[name="to"]').value = prevFrom;
         }
    }
    flightDiv.querySelector('.remove-flight-btn').addEventListener('click', () => { flightDiv.remove(); updateStateAndPreview(); });
}
function addTransfer(initialData = {}) {
    const template = document.getElementById('transferTemplate');
    const clone = template.content.cloneNode(true);
    const transferDiv = clone.querySelector('.transfer-entry');
    DOMElements.transfersContainer.appendChild(clone);
    if (Object.keys(initialData).length > 0) {
        for (const key in initialData) {
            const input = transferDiv.querySelector(`[name="${key}"]`);
            if (input) input.value = initialData[key];
        }
    }
    transferDiv.querySelector('.remove-transfer-btn').addEventListener('click', () => { transferDiv.remove(); updateStateAndPreview(); });
}
function addHotel(initialData = {}) {
    const template = document.getElementById('hotelTemplate');
    const clone = template.content.cloneNode(true);
    const hotelDiv = clone.querySelector('.hotel-entry');
    DOMElements.hotelsContainer.appendChild(clone);
    if (Object.keys(initialData).length > 0) {
        for (const key in initialData) {
            const input = hotelDiv.querySelector(`[name="${key}"]`);
            if (input) {
                if (input.type === 'checkbox') input.checked = initialData[key];
                else input.value = initialData[key];
            }
        }
    }
    const cancellableCheckbox = hotelDiv.querySelector('[name="hotelCancellable"]');
    const cancelDetailsDiv = hotelDiv.querySelector('.hotel-cancel-details');
    const toggleDetails = () => cancelDetailsDiv.classList.toggle('hidden', !cancellableCheckbox.checked);
    cancellableCheckbox.addEventListener('change', toggleDetails);
    hotelDiv.querySelector('.remove-hotel-btn').addEventListener('click', () => { hotelDiv.remove(); updateStateAndPreview(); });
    toggleDetails();
}
function toggleTransfersCancelDetails() {
    DOMElements.transfersCancelDetails.classList.toggle('hidden', !DOMElements.transfersCancellable.checked);
}
function toggleFlightCancelDetails() {
    DOMElements.flightCancelDetails.classList.toggle('hidden', !DOMElements.flightCancellable.checked);
}
function toggleRoomDetails(roomEntry) {
    const detailsDiv = roomEntry.querySelector('.room-details');
    const roomType = roomEntry.querySelector('select[name="roomType"]').value;
    detailsDiv.classList.toggle('hidden', !detailRoomTypes.includes(roomType));
}
function handlePaste(event) {
    event.preventDefault();
    const items = (event.clipboardData || window.clipboardData).items;
    for (const item of items) {
        if (item.type.startsWith('image/')) {
            const blob = item.getAsFile();
            if (blob) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    DOMElements.previewItineraryImage.src = e.target.result;
                    DOMElements.itineraryPasteTarget.innerHTML = `<span class="text-green-600 font-semibold">×ª××•× ×” ×”×•×¢×œ×ª×”!</span>`;
                };
                reader.readAsDataURL(blob);
            }
            return;
        }
    }
}
function updatePreview() {
    const state = getFormState();
    const docType = state.docType || 'quote';
    if (docType === 'quote') {
        DOMElements.previewDocTitle.textContent = '×œ×›×‘×•×“';
        DOMElements.previewOpeningLine.textContent = '×‘×”××©×š ×œ×©×™×—×ª× ×•, ××¦×•×¨×¤×ª ×”×¦×¢×”:';
        if (!isLoaded) {
            DOMElements.previewQuoteNumber.textContent = state.quoteNumber && state.quoteNumber !== '×”×¦×¢×” ×—×“×©×”' ? `×”×¦×¢×” ××¡': ${state.quoteNumber}` : '';
        } else {
            DOMElements.previewQuoteNumber.textContent = '';
        }
        DOMElements.importantNote.classList.remove('hidden');
    } else {
        DOMElements.previewDocTitle.textContent = '××™×©×•×¨ ×”×–×× ×” ×¢×‘×•×¨';
        DOMElements.previewOpeningLine.textContent = '××¦×•×¨×¤×™× ×˜×¤×¡×™ ××™×©×•×¨ ×”×–×× ×”. ×× × ×§×¨×/×™ ×•××©×¨/×™ ×‘×”×•×“×¢×” ×—×•×–×¨×ª.';
        DOMElements.previewQuoteNumber.textContent = '';
        DOMElements.importantNote.classList.add('hidden');
    }
    DOMElements.previewClientName.textContent = state.clientName || '___';
    DOMElements.previewDate.textContent = state.offerDate ? `×ª××¨×™×š: ${new Date(state.offerDate).toLocaleDateString('he-IL')}` : '';
    DOMElements.previewAdvisor.textContent = advisors[state.advisor]?.details || '';
    const isCruiseHidden = state.hideCruise;
    DOMElements.cruiseFields.classList.toggle('hidden', isCruiseHidden);
    DOMElements.previewCruiseDetails.classList.toggle('hidden', isCruiseHidden);
    DOMElements.previewCruiseInclusions.classList.toggle('hidden', isCruiseHidden);
    DOMElements.previewItinerarySection.classList.toggle('hidden', isCruiseHidden);
    DOMElements.previewRoomsSection.classList.toggle('hidden', isCruiseHidden);
    DOMElements.previewShipImageSection.classList.toggle('hidden', isCruiseHidden);
    DOMElements.previewCruiseLine.textContent = state.cruiseLine;
    DOMElements.previewShipName.textContent = state.shipName;
    DOMElements.previewCruiseDuration.textContent = state.cruiseDuration || '7';
    const startDate = state.cruiseStartDate;
    if (startDate) {
        const date = new Date(startDate);
        date.setDate(date.getDate() + parseInt(state.cruiseDuration || 7));
        const endDate = date.toLocaleDateString('he-IL');
        DOMElements.previewCruiseDate.textContent = `${new Date(startDate).toLocaleDateString('he-IL')} - ${endDate}`;
    } else {
        DOMElements.previewCruiseDate.textContent = '___';
    }
    DOMElements.previewPorts.textContent = (state.departurePort && state.arrivalPort) ? `${state.departurePort} - ${state.arrivalPort}` : '___';
    const ship = cruiseData[state.cruiseLine]?.find(s => s.name === state.shipName);
    DOMElements.previewShipImage.src = (ship && ship.image) ? ship.image : 'https://placehold.co/800x300/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××•× ×™×™×”';
    DOMElements.previewShipVideo.classList.toggle('hidden', !state.shipVideo);
    if (state.shipVideo) DOMElements.previewShipVideo.querySelector('a').href = state.shipVideo;
    DOMElements.previewRoomsContainer.innerHTML = '';
    let totalPrice = 0;
    let totalPassengers = 0;
    let hasGuarantee = false;
    state.dynamicFields.rooms.forEach((room, index) => {
        const passengersInRoom = { '× ×•×¡×¢ ×™×—×™×“': 1, '×–×•×’': 2, '×–×•×’ + 1': 3, '×–×•×’ + 2': 4, '×–×•×’ + 3': 5, '××‘×•×’×¨ + ×™×œ×“': 2, '××‘×•×’×¨ + 2 ×™×œ×“×™×': 3, '××‘×•×’×¨ + 3 ×™×œ×“×™×': 4, '××‘×•×’×¨ + 4 ×™×œ×“×™×': 5, '3 ××‘×•×’×¨×™×': 3, '3 ××‘×•×’×¨×™× + 1': 4, '3 ××‘×•×’×¨×™× + 2': 5, '4 ××‘×•×’×¨×™×': 4, '4 ××‘×•×’×¨×™× + 1': 5, '5 ××‘×•×’×¨×™×': 5 }[room.composition] || 0;
        totalPassengers += passengersInRoom;
        if (room.roomType && room.roomType.includes('×’×¨× ×˜×™')) hasGuarantee = true;
        const costValue = parseFloat(room.roomCost) || 0;
        if (room.composition || room.roomType || costValue > 0) {
            let details = [];
            if (room.composition) details.push(`<strong>×”×¨×›×‘:</strong> ${room.composition}`);
            if (room.roomType) {
                let typeText = `<strong>×ª×™××•×¨:</strong> ${room.roomType}`;
                if (room.roomType.includes('×’×¨× ×˜×™')) typeText += ` - ${guaranteeMessage}`;
                else if (room.floor || room.roomNumber) typeText += ` (×§×•××”: ${room.floor || '×œ× ×¦×•×™×Ÿ'}, ×—×“×¨: ${room.roomNumber || '×œ× ×¦×•×™×Ÿ'})`;
                details.push(typeText);
            }
            if (room.extraDesc) details.push(room.extraDesc);
            const roomDiv = document.createElement('div');
            roomDiv.className = 'border p-3 rounded-lg bg-white no-split';
            roomDiv.innerHTML = `<p><strong>×—×“×¨ ${index + 1}:</strong></p>
                                 <p class="space-y-1 my-2">${details.join(' | ')}</p>
                                 <p class="font-semibold text-right">×¢×œ×•×ª: $${costValue.toLocaleString()}</p>`;
            DOMElements.previewRoomsContainer.appendChild(roomDiv);
            totalPrice += costValue;
        }
    });
    DOMElements.previewGuaranteeNote.classList.toggle('hidden', !hasGuarantee);
    const cruiseInclusionsList = DOMElements.previewCruiseInclusionsList;
    cruiseInclusionsList.innerHTML = '';
    if (!state.hideMealInclusion && !isCruiseHidden) {
        addInclusionItem(cruiseInclusionsList, '×›×•×œ×œ 3 ××¨×•×—×•×ª ××œ××•×ª ×‘×™×•×, ××™×¡×™× ×•×‘×•×¤×” ×¢×©×™×¨ ×œ××•×¨×š ×”×™×•×.');
    }
    if(state.cruiseLine === 'MSC' && !isCruiseHidden) {
        addInclusionItem(cruiseInclusionsList, '<strong>×›×•×œ×œ ×ª×©×œ×•× ×˜×™×¤×™× ××¨××©.</strong>');
    } else if (!isCruiseHidden) {
         addInclusionItem(cruiseInclusionsList, '×œ× ×›×•×œ×œ ×ª×©×œ×•× ×˜×™×¤×™× ××¨××©.');
    }
    const inclusionsList = DOMElements.previewInclusions;
    inclusionsList.innerHTML = '';
    if (state.customInclusions) {
        state.customInclusions.split('\n').filter(line => line.trim()).forEach(line => addInclusionItem(inclusionsList, line.trim()));
    }
    const flightCostPerPerson = parseFloat(state.flightCost) || 0;
    const flightCostValue = flightCostPerPerson * totalPassengers;
    const hasFlights = state.dynamicFields.flights.some(f => f.airline) || flightCostValue > 0;
    DOMElements.previewFlightsContainer.classList.toggle('hidden', !hasFlights);
    if (hasFlights) {
        DOMElements.previewFlightsList.innerHTML = '';
        state.dynamicFields.flights.forEach(flight => {
            if (flight.airline || flight.from || flight.to) {
                const date = flight.date ? new Date(flight.date).toLocaleDateString('he-IL') : '___';
                const p = document.createElement('p');
                p.innerHTML = `×˜×™×¡×” ×‘×—×‘×¨×ª ${flight.airline || '___'} | ${flight.from || '___'} &larr; ${flight.to || '___'} | ${date} | ×”××¨××”: ${flight.takeoff || '___'} | × ×—×™×ª×”: ${flight.landing || '___'}`;
                DOMElements.previewFlightsList.appendChild(p);
            }
        });
        const includesList = DOMElements.previewFlightIncludes;
        includesList.innerHTML = '';
        const includesText = state.flightIncludes.trim();
        DOMElements.previewFlightIncludesContainer.classList.toggle('hidden', !includesText);
        if (includesText) {
            includesText.split('\n').forEach(line => {
                if (line.trim()) addInclusionItem(includesList, line.trim());
            });
        }
        DOMElements.previewFlightFreeText.textContent = state.flightFreeText;
        if (flightCostPerPerson > 0 && totalPassengers > 0) {
            DOMElements.previewFlightCost.textContent = `×¢×œ×•×ª: $${flightCostPerPerson.toLocaleString()} ×œ××“× X ${totalPassengers} × ×•×¡×¢×™× = $${flightCostValue.toLocaleString()}`;
        } else if (flightCostPerPerson > 0) {
            DOMElements.previewFlightCost.textContent = `×¢×œ×•×ª: $${flightCostPerPerson.toLocaleString()} ×œ××“×`;
        } else {
            DOMElements.previewFlightCost.textContent = '';
        }
        totalPrice += flightCostValue;
        let conditionsText = '';
        if (state.flightCancelType === 'flightNoCancel') {
            conditionsText = '<p>×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™ ××¨×’×¢ ××™×©×•×¨ ×”×”×–×× ×”.</p>';
        } else if (state.flightCancelType === 'flightCancellable') {
            let parts = [];
            if (state.flightCancelCheck && state.flightCancelFee) {
                parts.push(`×‘×™×˜×•×œ â€“ × ×™×ª×Ÿ ×œ×‘×™×˜×•×œ ×¢×“ 72 ×©×¢×•×ª ×œ×¤× ×™ ×”×”××¨××” ×‘ ${state.flightCancelFee} ×œ× ×•×¡×¢.`);
            }
            if (state.flightChangeCheck && state.flightChangeFee) {
                parts.push(`×©×™× ×•×™ â€“ × ×™×ª×Ÿ ×œ×©×™× ×•×™ ×¢×“ 72 ×©×¢×•×ª ×œ×¤× ×™ ×”×”××¨××” ×‘ ${state.flightChangeFee} ×œ× ×•×¡×¢ ×•××•×ª× ×” ×‘××•×ª×” ××—×œ×§×ª ×©×™×¨×•×ª.`);
            }
            conditionsText = parts.map(p => `<p>${p}</p>`).join('');
        }
        DOMElements.previewFlightConditions.innerHTML = conditionsText;
    }
    DOMElements.previewHotelsContainer.innerHTML = '';
    const hasHotels = state.dynamicFields.hotels.some(h => h.hotelName || h.hotelCost > 0);
    DOMElements.previewHotelsSection.classList.toggle('hidden', !hasHotels);
    if (hasHotels) {
        state.dynamicFields.hotels.forEach(hotel => {
            const cost = parseFloat(hotel.hotelCost) || 0;
            if (hotel.hotelName || cost > 0) {
                totalPrice += cost;
                let conditionsText = '';
                if (hotel.hotelNoCancel) {
                    conditionsText = '<p>×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ/×©×™× ×•×™.</p>';
                } else if (hotel.hotelCancellable) {
                    const date = hotel.hotelCancelDate ? new Date(hotel.hotelCancelDate).toLocaleDateString('he-IL') : '___';
                    const fee = hotel.hotelCancelFee || '___';
                    conditionsText = `<p>×“××™ ×‘×™×˜×•×œ/×©×™× ×•×™ ×‘×¢×œ×•×ª ${fee} ×¢×“ ×œ×ª××¨×™×š ${date} - ×œ××—×¨ ××›×Ÿ ×“××™ ×‘×™×˜×•×œ ×‘×’×•×‘×” ×©×œ 100%</p>`;
                }
                const startDate = hotel.hotelStartDate ? new Date(hotel.hotelStartDate) : null;
                let dateRange = '___';
                if (startDate && hotel.hotelNights) {
                    const endDate = new Date(startDate);
                    endDate.setDate(endDate.getDate() + parseInt(hotel.hotelNights));
                    dateRange = `${startDate.toLocaleDateString('he-IL')} - ${endDate.toLocaleDateString('he-IL')}`;
                }
                const hotelDiv = document.createElement('div');
                hotelDiv.className = 'border p-3 rounded-lg bg-white space-y-2 no-split';
                hotelDiv.innerHTML = `
                    <h4 class="font-bold text-md">${hotel.hotelName}</h4>
                    <p>${hotel.hotelNights || '___'} ×œ×™×œ×•×ª ××ª××¨×™×š ${dateRange}</p>
                    <p>×¡×•×’ ×—×“×¨: ${hotel.hotelRoomDesc || '___'} | ×¤× ×¡×™×•×Ÿ: ${hotel.hotelPension || '___'}</p>
                    <p class="font-semibold text-right">×¢×œ×•×ª: $${cost.toLocaleString()}</p>
                    <div class="text-sm">${conditionsText}</div>`;
                DOMElements.previewHotelsContainer.appendChild(hotelDiv);
            }
        });
    }
    const transfersCost = parseFloat(state.transfersCost) || 0;
    const hasTransfers = state.dynamicFields.transfers.some(t => t.transferType) || transfersCost > 0;
    DOMElements.previewTransfersContainer.classList.toggle('hidden', !hasTransfers);
    if (hasTransfers) {
        DOMElements.previewTransfersList.innerHTML = '';
        state.dynamicFields.transfers.forEach((t, i) => {
            if (t.transferType || t.transferFreeText) {
                const p = document.createElement('p');
                p.textContent = `${i + 1}. ${t.transferType}${t.transferFreeText ? ` - ${t.transferFreeText}` : ''}`;
                DOMElements.previewTransfersList.appendChild(p);
            }
        });
        DOMElements.previewTransfersCost.textContent = `×¢×œ×•×ª: $${transfersCost.toLocaleString()}`;
        totalPrice += transfersCost;
        let conditionsText = '';
        if (state.transfersCancelType === 'transfersNoCancel') {
             conditionsText = '<p>×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™.</p>';
        } else if (state.transfersCancelType === 'transfersCancellable') {
            const date = state.transfersCancelDate ? new Date(state.transfersCancelDate).toLocaleDateString('he-IL') : '___';
            const fee = state.transfersCancelFee || '___';
            conditionsText = `<p>×“××™ ×‘×™×˜×•×œ/×©×™× ×•×™ ×‘×¢×œ×•×ª ${fee} ×¢×“ ×œ×ª××¨×™×š ${date} - ×œ××—×¨ ××›×Ÿ ×“××™ ×‘×™×˜×•×œ ×‘×’×•×‘×” ×©×œ 100%</p>`;
        }
        DOMElements.previewTransfersConditions.innerHTML = conditionsText;
    }
    DOMElements.previewTotalContainer.classList.toggle('hidden', state.hideTotal);
    DOMElements.previewTotalPrice.textContent = totalPrice.toLocaleString();
    DOMElements.previewInternalNumber.textContent = state.quoteNumber && state.quoteNumber !== '×”×¦×¢×” ×—×“×©×”' ? state.quoteNumber : '';
}
function addInclusionItem(list, text) {
    const li = document.createElement('li');
    li.innerHTML = text;
    list.appendChild(li);
}
async function generatePDF() {
    DOMElements.previewElement.classList.remove('shadow-lg');
    const { jsPDF } = window.jspdf;
    const clone = DOMElements.previewElement.cloneNode(true);
    clone.style.position = 'absolute';
    clone.style.left = '-9999px';
    clone.style.width = '794px';
    document.body.appendChild(clone);
    clone.querySelectorAll('.preview-container *').forEach(el => el.style.pointerEvents = 'auto');
    const images = clone.querySelectorAll('img');
    const promises = Array.from(images).map(img => new Promise(resolve => {
        if (img.complete && img.naturalHeight !== 0) resolve();
        else { img.onload = resolve; img.onerror = resolve; }
    }));
    await Promise.all(promises);
    const canvas = await html2canvas(clone, { scale: 2, useCORS: true, logging: false });
    clone.remove();
    const imgData = canvas.toDataURL('image/jpeg', 1.0);
    const pdf = new jsPDF('p', 'mm', 'a4');
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = pdf.internal.pageSize.getHeight();
    const imgHeight = canvas.height * pdfWidth / canvas.width;
    let heightLeft = imgHeight;
    let position = 0;
    pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, imgHeight);
    heightLeft -= pdfHeight;
    while (heightLeft > 0) {
        position -= pdfHeight;
        pdf.addPage();
        pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, imgHeight);
        heightLeft -= pdfHeight;
    }
    const clientName = DOMElements.clientName.value || '×”×¦×¢×”';
    const shipName = DOMElements.shipName.value || '×§×¨×•×–';
    pdf.save(`×”×¦×¢×ª ××—×™×¨ ${shipName} - ${clientName}.pdf`);
    DOMElements.previewElement.classList.add('shadow-lg');
}
</script>
<footer class="text-center mt-8 text-xs text-gray-500 no-print">
    ×¤×•×ª×— ×¢×œ ×™×“×™ ×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™
</footer>
</body>
</html>
