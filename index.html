<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחולל הצעות מחיר לקרוזים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        /* Custom styles to ensure the preview looks good */
        .preview-container {
            font-family: 'Assistant', sans-serif;
        }
        /* Prevent content from being editable in the preview */
        .preview-container * {
            pointer-events: none;
        }
        /* Helper class for printing */
        @media print {
            .no-print {
                display: none;
            }
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-800">מחולל הצעות מחיר לקרוזים</h1>
            <p class="text-gray-600 mt-2">מלא את הפרטים בטופס כדי ליצור הצעת מחיר מקצועית בפורמט PDF.</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Input Form -->
            <div class="lg:w-1/2 bg-white p-6 rounded-2xl shadow-lg no-print">
                <h2 class="text-2xl font-bold mb-6 border-b pb-3">פרטי ההצעה</h2>
              
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="clientName" class="block text-sm font-medium text-gray-700">שם הלקוח/ה</label>
                        <input type="text" id="clientName" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="offerDate" class="block text-sm font-medium text-gray-700">תאריך ההצעה</label>
                        <input type="date" id="offerDate" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div>
                        <label for="cruiseLine" class="block text-sm font-medium text-gray-700">חברת שייט</label>
                        <select id="cruiseLine" onchange="populateShips(); updatePreview();" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option>MSC</option>
                            <option>Royal Caribbean</option>
                            <option>Norwegian Cruise Line</option>
                        </select>
                    </div>
                    <div>
                        <label for="shipName" class="block text-sm font-medium text-gray-700">שם האונייה</label>
                        <select id="shipName" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></select>
                    </div>
                    <div>
                        <label for="cruiseDuration" class="block text-sm font-medium text-gray-700">משך ההפלגה (לילות)</label>
                        <input type="number" id="cruiseDuration" value="7" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div>
                        <label for="cruiseDate" class="block text-sm font-medium text-gray-700">תאריכי הפלגה</label>
                        <input type="text" id="cruiseDate" placeholder="לדוגמה: 01.01.2026 - 08.01.2026" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="advisor" class="block text-sm font-medium text-gray-700">יועץ שייט</label>
                        <select id="advisor" onchange="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="lior">ליאור דובינובסקי</option>
                            <option value="tatiana">טטיאנה לאונוב</option>
                            <option value="koren">קורן אבסעיד</option>
                            <option value="yarden">ירדן שקד</option>
                            <option value="nir">ניר</option>
                        </select>
                    </div>
                </div>
                <!-- Itinerary Image Paste Area -->
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700">תמונת מסלול</label>
                    <div id="itineraryPasteTarget" class="mt-1 flex justify-center items-center w-full h-24 border-2 border-dashed border-gray-300 rounded-md cursor-pointer text-gray-500 p-2 text-center transition-colors">
                        <span>הדבק תמונה כאן (Ctrl+V)</span>
                    </div>
                </div>
              
                <!-- Ship Image Paste Area -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700">תמונת אונייה</label>
                    <div id="shipPasteTarget" class="mt-1 flex justify-center items-center w-full h-24 border-2 border-dashed border-gray-300 rounded-md cursor-pointer text-gray-500 p-2 text-center transition-colors">
                        <span>הדבק תמונה כאן (Ctrl+V)</span>
                    </div>
                </div>
                <!-- Rooms Section -->
                <div id="roomsContainer" class="mt-6">
                    <h3 class="text-xl font-bold mb-3">חדרים</h3>
                    <!-- Room template will be cloned here -->
                </div>
                <button onclick="addRoom()" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ הוסף חדר</button>
                <!-- Inclusions -->
                <div class="mt-6">
                     <h3 class="text-xl font-bold mb-3">מה כלול</h3>
                     <div class="space-y-2">
                         <div class="flex items-start">
                             <input id="includeTips" type="checkbox" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                             <label for="includeTips" class="ml-2 block text-sm text-gray-900">כולל תשלום טיפים מראש</label>
                         </div>
                         <div class="flex items-start">
                             <input id="includeMeals" type="checkbox" onchange="updatePreview()" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                             <label for="includeMeals" class="ml-2 block text-sm text-gray-900">כולל 3 ארוחות מלאות ביום + מיסים + בופה עשיר</label>
                         </div>
                     </div>
                     <div class="mt-4">
                        <label for="customInclusions" class="block text-sm font-medium text-gray-700">הערות ודגשים נוספים (יופיע כסעיף)</label>
                        <textarea id="customInclusions" oninput="updatePreview()" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                <div class="mt-8 flex justify-center">
                    <button onclick="generatePDF()" class="w-full lg:w-auto bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        הורד PDF
                    </button>
                </div>
            </div>
            <!-- Live Preview -->
            <div class="lg:w-1/2">
                <div id="preview" class="bg-white p-8 rounded-2xl shadow-lg min-h-[1123px] w-full max-w-[794px] mx-auto preview-container">
                    <!-- Header -->
                    <header class="flex justify-between items-center border-b-2 pb-4 border-gray-200">
                         <div class="text-right">
                             <h1 class="text-4xl font-bold" style="color: #3f3c66;">באלי <span style="color: #ed1c24;">קרוז</span></h1>
                         </div>
                         <div style="font-size: 40px; color: #3f3c66;">⚓</div>
                    </header>
                    <!-- Offer Details -->
                    <main class="mt-8">
                        <p class="mb-4"><span id="previewDate" class="font-semibold"></span></p>
                        <p class="text-xl mb-6">לכבוד <span id="previewClientName" class="font-bold"></span>,</p>
                        <p class="mb-6">בהמשך לבקשתך, מצורפת הצעת מחיר להפלגת החלומות שלכם:</p>
                        <div class="bg-blue-50 rounded-lg p-4 mb-6">
                             <h2 class="text-2xl font-bold mb-4 text-blue-800">פרטי ההפלגה</h2>
                             <div class="grid grid-cols-2 gap-4 text-md">
                                 <p><strong>חברת שייט:</strong> <span id="previewCruiseLine"></span></p>
                                 <p><strong>אונייה:</strong> <span id="previewShipName"></span></p>
                                 <p><strong>משך הפלגה:</strong> <span id="previewCruiseDuration"></span> לילות</p>
                                 <p><strong>תאריכים:</strong> <span id="previewCruiseDate"></span></p>
                             </div>
                        </div>
                        <!-- Itinerary Image -->
                        <div class="my-6">
                            <h3 class="text-xl font-bold mb-3">מסלול ההפלגה:</h3>
                            <img id="previewItineraryImage" src="https://placehold.co/800x300/e2e8f0/adb5bd?text=תמונת+המסלול" class="w-full rounded-lg shadow-md" alt="Itinerary Map">
                        </div>
                        <!-- Rooms Details -->
                         <div class="my-6">
                             <h3 class="text-xl font-bold mb-3">פרטי החדרים:</h3>
                             <div id="previewRoomsContainer" class="space-y-4">
                                 <!-- Preview rooms will be added here -->
                             </div>
                         </div>
                       
                         <div class="mt-6 text-2xl font-bold text-right text-blue-900 bg-gray-100 p-4 rounded-lg">
                             סה"כ עלות: $<span id="previewTotalPrice">0</span>
                         </div>
                        <!-- Ship Image -->
                        <div class="my-8">
                           <img id="previewShipImage" src="https://placehold.co/800x450/e2e8f0/adb5bd?text=תמונת+האונייה" class="w-full rounded-lg shadow-md" alt="Cruise Ship">
                        </div>
                        <!-- Inclusions & Terms -->
                        <div class="mt-8 text-sm space-y-3">
                            <ul id="previewInclusions" class="list-disc list-inside bg-gray-50 p-4 rounded-lg">
                                <!-- Inclusions will be added dynamically -->
                            </ul>
                            <div class="border-t pt-4 mt-4">
                                 <h4 class="font-bold">תנאי תשלום וביטול:</h4>
                                 <p><strong>אפשרויות תשלום:</strong> כרטיס אשראי (עד 3 תשלומים), העברה בנקאית, או מזומן במשרדנו.</p>
                                 <p><strong>תנאי ביטול:</strong> בהתאם לתנאי חברת השייט המצורפים בנפרד.</p>
                                 <p class="text-xs text-gray-500 mt-2">לתשומת לבך: חוק הגנת הצרכן אינו תקף להזמנות שירותי תיירות המתחילים ומסתיימים מחוץ לישראל.</p>
                            </div>
                        </div>
                    </main>
                    <!-- Footer -->
                    <footer class="text-center mt-12 border-t-2 pt-6 border-gray-200">
                        <p class="font-bold text-lg text-blue-800">תודה שבחרתם להפליג איתנו!</p>
                        <p id="previewAdvisor">ליאור דובינובסקי | יועץ שייט | 03-3106454 | lior@balicruise.co.il</p>
                    </footer>
                </div>
            </div>
        </div>
    </div>
    <!-- Room HTML Template (for cloning) -->
    <template id="roomTemplate">
        <div class="room-entry border p-4 rounded-lg mt-2 bg-gray-50 relative">
             <button onclick="removeRoom(this)" class="absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">תיאור החדר</label>
                    <input type="text" name="roomDesc" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                 <div>
                    <label class="block text-sm font-medium text-gray-700">עלות ($)</label>
                    <input type="number" name="roomCost" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <script>
        // --- DATA (Simulating Excel file) ---
        const cruiseData = {
            "MSC": [
                "MSC Preziosa", "MSC World America", "MSC Splendida", "MSC World Asia",
                "MSC Magnifica", "MSC World Europa", "MSC Musica", "MSC Seashore",
                "MSC Orchestra", "MSC Seaside", "MSC Poesia", "MSC Seascape",
                "MSC Armonia", "MSC Seaview", "MSC Lirica", "MSC Bellissima",
                "MSC Opera", "MSC Euribia", "MSC Sinfonia", "MSC Grandiosa",
                "MSC Divina", "MSC Meraviglia", "MSC Fantasia", "MSC Virtuosa"
            ],
            "Royal Caribbean": [
                "Adventure of the Seas", "Allure of the Seas", "Anthem of the Seas",
                "Brilliance of the Seas", "Enchantment of the Seas", "Explorer of the Seas",
                "Freedom of the Seas", "Grandeur of the Seas", "Harmony of the Seas",
                "Icon of the Seas", "Independence of the Seas", "Jewel of the Seas",
                "Legend of the Seas", "Liberty of the Seas", "Mariner of the Seas",
                "Navigator of the Seas", "Oasis of the Seas", "Odyssey of the Seas",
                "Ovation of the Seas", "Quantum of the Seas", "Radiance of the Seas",
                "Rhapsody of the Seas", "Serenade of the Seas", "Spectrum of the Seas",
                "Star of the Seas", "Symphony of the Seas", "Utopia of the Seas"
            ],
            "Norwegian Cruise Line": [
                "Norwegian Aqua", "Norwegian Bliss", "Norwegian Breakaway",
                "Norwegian Dawn", "Norwegian Encore", "Norwegian Epic",
                "Norwegian Escape", "Norwegian Getaway", "Norwegian Jade",
                "Norwegian Jewel", "Norwegian Joy", "Norwegian Luna",
                "Norwegian Pearl", "Norwegian Prima", "Norwegian Sky",
                "Norwegian Spirit", "Norwegian Star", "Norwegian Sun",
                "Norwegian Viva", "Norwegian Gem", "Pride of America"
            ],
            "CELEBRITY": [
                "Celebrity Apex", "Celebrity Ascent", "Celebrity Beyond",
                "Celebrity Constellation", "Celebrity Eclipse", "Celebrity Edge",
                "Celebrity Equinox", "Celebrity Flora", "Celebrity Infinity",
                "Celebrity Millennium", "Celebrity Reflection", "Celebrity Silhouette",
                "Celebrity Solstice", "Celebrity Summit", "Celebrity Xce"
            ],
            "COSTA": [
                "Costa Deliziosa", "Costa Diadema", "Costa Fascinosa", "Costa Favolosa",
                "Costa Fortuna", "Costa Pacifica", "Costa Serena", "Costa Smeralda",
                "Costa Toscana"
            ]
        };

        // --- ADVISORS DATA ---
        const advisors = {
            "lior": "ליאור דובינובסקי / Lior Dovinovsky| יועץ שייט | 03-3106454 | lior@balicruise.co.il",
            "tatiana": "טטיאנה לאונוב/Tatyana Leonov | יועצת שייט | 03-3106454 | tatiana@balicruise.co.il",
            "koren": "קורן אבסעיד | Koren avsaid | מנהל מחלקת שייט | 03-3106454 | Koren@balicruise.co.il",
            "yarden": "ירדן שקד | Yarden shaked | יועץ שייט | 03-3106454 | Yarden@balicruise.co.il",
            "nir": "ניר | Nir | יועץ שייט | 03-3106454 | nir@balicruise.co.il"
        };
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('offerDate').valueAsDate = new Date();
            populateShips();
            addRoom();
            setupPasteListeners(); // Set up the new paste functionality
            updatePreview();
        });
      
        // --- IMAGE PASTE LOGIC ---
        function setupPasteListeners() {
            const itineraryTarget = document.getElementById('itineraryPasteTarget');
            const shipTarget = document.getElementById('shipPasteTarget');
            itineraryTarget.addEventListener('paste', (e) => handlePaste(e, 'previewItineraryImage', itineraryTarget));
            shipTarget.addEventListener('paste', (e) => handlePaste(e, 'previewShipImage', shipTarget));
        }
        function handlePaste(event, previewImageId, pasteTargetElement) {
            // Prevent the default paste action to stop the image from being inserted into the div
            event.preventDefault();
          
            // Get the clipboard data
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
          
            // Find and process the first image item from the clipboard
            for (const item of items) {
                if (item.type.startsWith('image/')) {
                    const blob = item.getAsFile();
                    if (blob) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            // Update the src of the corresponding preview image
                            const imgElement = document.getElementById(previewImageId);
                            imgElement.src = e.target.result;
                          
                            // Update the UI of the paste box to give user feedback
                            pasteTargetElement.innerHTML = `<span class="text-green-600 font-semibold">תמונה הועלתה בהצלחה!</span>`;
                            pasteTargetElement.classList.remove('border-gray-300');
                            pasteTargetElement.classList.add('border-green-500');
                        };
                        // Read the image file as a Base64 string
                        reader.readAsDataURL(blob);
                    }
                    // Stop after handling the first image found
                    return;
                }
            }
        }
        // --- DYNAMIC FORM LOGIC ---
        function populateShips() {
            const cruiseLine = document.getElementById('cruiseLine').value;
            const shipSelect = document.getElementById('shipName');
            shipSelect.innerHTML = '';
            if (cruiseData[cruiseLine]) {
                cruiseData[cruiseLine].forEach(ship => {
                    const option = document.createElement('option');
                    option.value = ship;
                    option.textContent = ship;
                    shipSelect.appendChild(option);
                });
            }
            updatePreview();
        }
        function addRoom() {
            const template = document.getElementById('roomTemplate');
            const clone = template.content.cloneNode(true);
            document.getElementById('roomsContainer').appendChild(clone);
            updatePreview();
        }
        function removeRoom(button) {
            button.closest('.room-entry').remove();
            updatePreview();
        }
        // --- PREVIEW UPDATE LOGIC ---
        function updatePreview() {
            // Simple text fields
            document.getElementById('previewClientName').textContent = document.getElementById('clientName').value || '___';
          
            const offerDate = document.getElementById('offerDate').value;
            if(offerDate) {
                 document.getElementById('previewDate').textContent = `תאריך: ${new Date(offerDate).toLocaleDateString('he-IL')}`;
            } else {
                 document.getElementById('previewDate').textContent = `תאריך: ${new Date().toLocaleDateString('he-IL')}`;
            }
            document.getElementById('previewCruiseLine').textContent = document.getElementById('cruiseLine').value;
            document.getElementById('previewShipName').textContent = document.getElementById('shipName').value;
            document.getElementById('previewCruiseDuration').textContent = document.getElementById('cruiseDuration').value || '7';
            document.getElementById('previewCruiseDate').textContent = document.getElementById('cruiseDate').value || '___';
          
            // Advisor
            const selectedAdvisor = document.getElementById('advisor').value;
            document.getElementById('previewAdvisor').textContent = advisors[selectedAdvisor];
          
            // Rooms and Total Price
            const roomsContainer = document.getElementById('roomsContainer');
            const previewRoomsContainer = document.getElementById('previewRoomsContainer');
            previewRoomsContainer.innerHTML = '';
            let totalPrice = 0;
          
            const roomEntries = roomsContainer.querySelectorAll('.room-entry');
            roomEntries.forEach((room, index) => {
                const desc = room.querySelector('input[name="roomDesc"]').value;
                const cost = room.querySelector('input[name="roomCost"]').value;
                const costValue = parseFloat(cost) || 0;
                totalPrice += costValue;
              
                if (desc || cost) {
                    const roomDiv = document.createElement('div');
                    roomDiv.className = 'border p-3 rounded-lg bg-white';
                    roomDiv.innerHTML = `<p><strong>חדר ${index + 1}:</strong> ${desc || 'לא צוין תיאור'}</p>
                                         <p class="font-semibold text-right">עלות: $${costValue.toLocaleString()}</p>`;
                    previewRoomsContainer.appendChild(roomDiv);
                }
            });
            document.getElementById('previewTotalPrice').textContent = totalPrice.toLocaleString();
          
            // Inclusions
            const inclusionsList = document.getElementById('previewInclusions');
            inclusionsList.innerHTML = '';
            if (document.getElementById('includeMeals').checked) {
                const li = document.createElement('li');
                li.textContent = 'כולל 3 ארוחות מלאות ביום, מיסים ובופה עשיר לאורך היום.';
                inclusionsList.appendChild(li);
            }
            if (document.getElementById('includeTips').checked) {
                 const li = document.createElement('li');
                li.textContent = 'כולל תשלום טיפים מראש.';
                inclusionsList.appendChild(li);
            }
            const customInclusionsText = document.getElementById('customInclusions').value;
            if (customInclusionsText.trim() !== '') {
                const li = document.createElement('li');
                li.textContent = customInclusionsText;
                inclusionsList.appendChild(li);
            }
             if (inclusionsList.innerHTML === '') {
                 inclusionsList.innerHTML = '<li>אין הכללות מיוחדות.</li>';
             }
        }
        // --- PDF GENERATION ---
        async function generatePDF() {
            const element = document.getElementById('preview');
            const clientName = document.getElementById('clientName').value || 'הצעה';
            const shipName = document.getElementById('shipName').value;
            // Temporarily remove shadow for a cleaner PDF edge
            element.classList.remove('shadow-lg');
            // Create temporary container for clones
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            document.body.appendChild(tempContainer);
            // Clone for page 1 (up to total cost)
            const clone1 = element.cloneNode(true);
            clone1.style.width = element.offsetWidth + 'px';
            clone1.style.minHeight = '0';
            clone1.style.height = 'auto'; // Allow natural height
            tempContainer.appendChild(clone1);
            // Remove elements after total in clone1
            const main1 = clone1.querySelector('main');
            const total1 = main1.querySelector('.mt-6.text-2xl.font-bold.text-right.text-blue-900.bg-gray-100.p-4.rounded-lg');
            let sib1 = total1.nextElementSibling;
            while (sib1) {
                const next = sib1.nextElementSibling;
                sib1.remove();
                sib1 = next;
            }
            // Remove footer from page 1
            const footer1 = clone1.querySelector('footer');
            if (footer1) footer1.remove();
            // Clone for page 2 (from ship image onwards)
            const clone2 = element.cloneNode(true);
            clone2.style.width = element.offsetWidth + 'px';
            clone2.style.minHeight = '0';
            clone2.style.height = 'auto';
            tempContainer.appendChild(clone2);
            // Remove header from page 2
            const header2 = clone2.querySelector('header');
            if (header2) header2.remove();
            // Remove elements up to and including total from main in page 2
            const main2 = clone2.querySelector('main');
            let child2 = main2.firstElementChild;
            while (child2) {
                const next = child2.nextElementSibling;
                main2.removeChild(child2);
                if (child2.classList.contains('mt-6') && child2.classList.contains('text-2xl') && child2.classList.contains('font-bold')) {
                    break;
                }
                child2 = next;
            }
            // Canvas options
            const canvasOptions = {
                scale: 2,
                useCORS: true,
                letterRendering: true,
                windowWidth: element.scrollWidth,
            };
            // Generate canvases
            const canvas1 = await html2canvas(clone1, { ...canvasOptions, windowHeight: clone1.scrollHeight });
            const canvas2 = await html2canvas(clone2, { ...canvasOptions, windowHeight: clone2.scrollHeight });
            // jsPDF setup
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'a4'
            });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            // Function to add canvas to PDF, scaled to fit one page
            const addCanvasToPdf = (canvas) => {
                const imgData = canvas.toDataURL('image/jpeg', 0.98);
                const imgWidth = canvas.width / 2;
                const imgHeight = canvas.height / 2;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const finalWidth = imgWidth * ratio;
                const finalHeight = imgHeight * ratio;
                pdf.addImage(imgData, 'JPEG', 0, 0, finalWidth, finalHeight);
                // No multi-page logic; fit to one page
            };
            // Add page 1
            addCanvasToPdf(canvas1);
            // Add page 2
            pdf.addPage();
            addCanvasToPdf(canvas2);
            // Save PDF
            pdf.save(`הצעת מחיר ${shipName} - ${clientName}.pdf`);
            // Cleanup
            tempContainer.remove();
            element.classList.add('shadow-lg');
        }
    </script>
    <footer class="text-center mt-8 text-xs text-gray-500">
        פותח על ידי ליאור דובינובסקי
    </footer>
</body>
</html>
