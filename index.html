<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×”×¦×¢×•×ª ××—×™×¨ ×œ×§×¨×•×–×™×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 1400px;
        }
        .preview-container {
            font-family: 'Assistant', sans-serif;
        }
        .preview-container * {
            pointer-events: none;
        }
        /* New styles for PDF splitting */
        .pdf-section {
            break-after: page;
        }
        .no-split {
            break-inside: avoid;
        }
        @media print {
            .no-print {
                display: none;
            }
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-800">××—×•×œ×œ ×”×¦×¢×•×ª ××—×™×¨ ×œ×§×¨×•×–×™×</h1>
            <p class="text-gray-600 mt-2">××œ× ××ª ×”×¤×¨×˜×™× ×‘×˜×•×¤×¡ ×›×“×™ ×œ×™×¦×•×¨ ×”×¦×¢×ª ××—×™×¨ ××§×¦×•×¢×™×ª ×‘×¤×•×¨××˜ PDF.</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Input Form -->
            <div id="inputForm" class="lg:w-1/2 bg-white p-6 rounded-2xl shadow-lg no-print">
                <h2 class="text-2xl font-bold mb-6 border-b pb-3">×¤×¨×˜×™ ×”×”×¦×¢×”</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="clientName" class="block text-sm font-medium text-gray-700">×©× ×”×œ×§×•×—/×”</label>
                        <input type="text" id="clientName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="offerDate" class="block text-sm font-medium text-gray-700">×ª××¨×™×š ×”×”×¦×¢×”</label>
                        <input type="date" id="offerDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="cruiseLine" class="block text-sm font-medium text-gray-700">×—×‘×¨×ª ×©×™×™×˜</label>
                        <select id="cruiseLine" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option>MSC</option>
                            <option>Royal Caribbean</option>
                            <option>Norwegian Cruise Line</option>
                            <option>CELEBRITY</option>
                            <option>COSTA</option>
                        </select>
                    </div>
                    <div>
                        <label for="shipName" class="block text-sm font-medium text-gray-700">×©× ×”××•× ×™×™×”</label>
                        <select id="shipName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></select>
                    </div>
                    <div>
                        <label for="cruiseDuration" class="block text-sm font-medium text-gray-700">××©×š ×”×”×¤×œ×’×” (×œ×™×œ×•×ª)</label>
                        <input type="number" id="cruiseDuration" value="7" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="col-span-2 md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700">×ª××¨×™×›×™ ×”×¤×œ×’×”</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="cruiseStartDate" class="block text-sm font-medium text-gray-700">××ª××¨×™×š</label>
                                <input type="date" id="cruiseStartDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="cruiseEndDate" class="block text-sm font-medium text-gray-700">×¢×“ ×ª××¨×™×š</label>
                                <input type="date" id="cruiseEndDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="advisor" class="block text-sm font-medium text-gray-700">×™×•×¢×¥ ×©×™×™×˜</label>
                        <select id="advisor" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="lior">×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™</option>
                            <option value="tatiana">×˜×˜×™×× ×” ×œ××•× ×•×‘</option>
                            <option value="koren">×§×•×¨×Ÿ ××‘×¡×¢×™×“</option>
                            <option value="yarden">×™×¨×“×Ÿ ×©×§×“</option>
                            <option value="nir">× ×™×¨</option>
                        </select>
                    </div>
                </div>
                <!-- Itinerary Image Paste Area -->
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700">×ª××•× ×ª ××¡×œ×•×œ</label>
                    <div id="itineraryPasteTarget" contenteditable="true" tabindex="0" class="mt-1 flex justify-center items-center w-full h-24 border-2 border-dashed border-gray-300 rounded-md cursor-pointer text-gray-500 p-2 text-center transition-colors">
                        <span>×”×“×‘×§ ×ª××•× ×” ×›××Ÿ (Ctrl+V)</span>
                    </div>
                </div>
                <!-- Rooms Section -->
                <div id="roomsContainer" class="mt-6">
                    <h3 class="text-xl font-bold mb-3">×—×“×¨×™×</h3>
                </div>
                <button id="addRoomBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ×—×“×¨</button>
                <!-- Inclusions -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">××” ×›×œ×•×œ</h3>
                    <div class="space-y-2">
                        <div class="flex items-start">
                            <input id="includeTips" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                            <label for="includeTips" class="ml-2 block text-sm text-gray-900">×›×•×œ×œ ×ª×©×œ×•× ×˜×™×¤×™× ××¨××©</label>
                        </div>
                        <div class="flex items-start">
                            <input id="includeMeals" type="checkbox" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                            <label for="includeMeals" class="ml-2 block text-sm text-gray-900">×›×•×œ×œ 3 ××¨×•×—×•×ª ××œ××•×ª ×‘×™×•× + ××™×¡×™× + ×‘×•×¤×” ×¢×©×™×¨</label>
                        </div>
                        <div class="flex items-start">
                            <input id="hideTotal" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                            <label for="hideTotal" class="ml-2 block text-sm text-gray-900">×”×¡×ª×¨ ×¡×”"×› ×¢×œ×•×ª</label>
                        </div>
                        <div class="flex items-start">
                            <input id="hideCruise" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                            <label for="hideCruise" class="ml-2 block text-sm text-gray-900">×”×¡×ª×¨ ×¤×¨×˜×™ ×©×™×™×˜</label>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label for="customInclusions" class="block text-sm font-medium text-gray-700">×”×¢×¨×•×ª ×•×“×’×©×™× × ×•×¡×¤×™× (×›×œ ×©×•×¨×” ×ª×•×¤×™×¢ ×›×¡×¢×™×£ × ×¤×¨×“)</label>
                        <textarea id="customInclusions" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                <!-- Flights Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">×˜×™×¡×•×ª (××•×¤×¦×™×•× ×œ×™)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div id="flightsContainer" class="space-y-4">
                        </div>
                        <button id="addFlightBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ×˜×™×¡×”</button>
                        <div>
                            <label for="flightIncludes" class="block text-sm font-medium text-gray-700">×”×›×¨×˜×™×¡ ×›×•×œ×œ (× ×™×ª×Ÿ ×œ×¢×¨×•×š)</label>
                            <textarea id="flightIncludes" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">××–×•×•×“×” 20 ×§"×’
×˜×¨×•×œ×™ 7 ×§"×’</textarea>
                        </div>
                        <div>
                            <label for="flightFreeText" class="block text-sm font-medium text-gray-700">××œ×œ ×—×•×¤×©×™ ×œ×˜×™×¡×•×ª</label>
                            <textarea id="flightFreeText" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                        </div>
                        <div>
                            <label for="flightCost" class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ×›×¨×˜×™×¡ ×˜×™×¡×” ×œ××“× ($)</label>
                            <input type="number" id="flightCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">×ª× ××™ ×‘×™×˜×•×œ/×©×™× ×•×™</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="flightNoCancel" name="flightCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightNoCancel" class="ml-2">×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="flightCancellable" name="flightCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightCancellable" class="ml-2">× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ / ×©×™× ×•×™</label>
                                </div>
                                <div id="flightCancelDetails" class="hidden space-y-2 ml-6">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="flightCancelCheck" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                        <label for="flightCancelCheck" class="ml-2">×‘×™×˜×•×œ</label>
                                        <input type="text" id="flightCancelFee" placeholder="×“××™ ×‘×™×˜×•×œ ×œ× ×•×¡×¢" class="ml-2 w-32 border-gray-300 rounded-md shadow-sm">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="flightChangeCheck" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                        <label for="flightChangeCheck" class="ml-2">×©×™× ×•×™</label>
                                        <input type="text" id="flightChangeFee" placeholder="×“××™ ×©×™× ×•×™ ×œ× ×•×¡×¢" class="ml-2 w-32 border-gray-300 rounded-md shadow-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hotel Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">××œ×•× ×•×ª (××•×¤×¦×™×•× ×œ×™)</h3>
                    <div id="hotelsContainer" class="space-y-4">
                        <!-- Hotels will be dynamically added here -->
                    </div>
                    <button id="addHotelBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ××œ×•×Ÿ</button>
                </div>
                <!-- Transfers Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">×”×¢×‘×¨×•×ª (××•×¤×¦×™×•× ×œ×™)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div id="transfersContainer" class="space-y-4">
                        </div>
                        <button id="addTransferBtn" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ ×”×•×¡×£ ×”×¢×‘×¨×”</button>
                        <div>
                            <label for="transfersCost" class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ×›×œ ×”×”×¢×‘×¨×•×ª ($)</label>
                            <input type="number" id="transfersCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">×ª× ××™ ×‘×™×˜×•×œ</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="transfersNoCancel" name="transfersCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="transfersNoCancel" class="ml-2">×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="transfersCancellable" name="transfersCancelType" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="transfersCancellable" class="ml-2">× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ</label>
                                </div>
                                <div id="transfersCancelDetails" class="hidden space-y-2 ml-6">
                                    <div>
                                        <label for="transfersCancelDate" class="block text-sm font-medium text-gray-700">×¢×“ ×ª××¨×™×š</label>
                                        <input type="date" id="transfersCancelDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    </div>
                                    <div>
                                        <label for="transfersCancelFee" class="block text-sm font-medium text-gray-700">×“××™ ×‘×™×˜×•×œ</label>
                                        <input type="text" id="transfersCancelFee" placeholder="×œ×“×•×’××”: $50" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 flex justify-center">
                    <button id="generatePDFBtn" class="w-full lg:w-auto bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        ×”×•×¨×“ PDF
                    </button>
                </div>
            </div>
            <!-- Live Preview -->
            <div class="lg:w-1/2">
                <div id="preview" class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-[794px] mx-auto preview-container">
                    <!-- Header -->
                    <header class="flex justify-between items-center border-b-2 pb-4 border-gray-200">
                        <div class="text-right">
                             <img src="https://i.postimg.cc/8T2V9VQ8/2-300-X1200.png" alt="×‘××œ×™ ×§×¨×•×–" class="h-16" />
                        </div>
                        <div style="font-size: 40px; color: #3f3c66;">âš“</div>
                    </header>
                    <!-- Offer Details -->
                    <main id="preview-main" class="mt-8">
                        <p class="mb-4 text-left"><span id="previewDate" class="font-semibold"></span></p>
                        <p class="text-xl mb-6">×œ×›×‘×•×“ <span id="previewClientName" class="font-bold"></span>,</p>
                        <p class="mb-6">×‘×”××©×š ×œ×‘×§×©×ª×š, ××¦×•×¨×¤×ª ×”×¦×¢×ª ××—×™×¨ ×œ×”×¤×œ×’×ª ×”×—×œ×•××•×ª ×©×œ×›×:</p>
                        <div id="previewCruiseDetails" class="bg-blue-50 rounded-lg p-4 mb-6 no-split hidden">
                            <h2 class="text-2xl font-bold mb-4 text-blue-800">×¤×¨×˜×™ ×”×”×¤×œ×’×”</h2>
                            <div class="grid grid-cols-2 gap-4 text-md">
                                <p><strong>×—×‘×¨×ª ×©×™×™×˜:</strong> <span id="previewCruiseLine"></span></p>
                                <p><strong>××•× ×™×™×”:</strong> <span id="previewShipName"></span></p>
                                <p><strong>××©×š ×”×¤×œ×’×”:</strong> <span id="previewCruiseDuration"></span> ×œ×™×œ×•×ª</p>
                                <p><strong>×ª××¨×™×›×™×:</strong> <span id="previewCruiseDate"></span></p>
                            </div>
                        </div>
                        <!-- Itinerary Image -->
                        <div id="previewItinerarySection" class="my-6 no-split hidden">
                            <h3 class="text-xl font-bold mb-3">××¡×œ×•×œ ×”×”×¤×œ×’×”:</h3>
                            <img id="previewItineraryImage" src="https://placehold.co/800x300/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××¡×œ×•×œ" class="w-full rounded-lg shadow-md" alt="Itinerary Map">
                        </div>
                        <!-- Rooms Details -->
                        <div id="previewRoomsSection" class="my-6 hidden">
                            <h3 class="text-xl font-bold mb-3 no-split">×¤×¨×˜×™ ×”×—×“×¨×™×:</h3>
                            <div id="previewRoomsContainer" class="space-y-4">
                            </div>
                            <div id="previewGuaranteeNote" class="mt-4 text-sm bg-yellow-100 p-3 rounded-lg hidden no-split">
                                ×—×“×¨ ××¡×•×’ "×’×¨× ×˜×™" ×”×•× ×—×“×¨ ×©×‘×• ×—×‘×¨×ª ×”×©×™×™×˜ ××ª×—×™×™×‘×ª ×œ×¡×•×’ ×”×—×“×¨ ×©×‘×—×¨×ª×, ××š ××™×§×•× ×”×—×“×¨ (×§×•××” ××• ××™×§×•× ×¡×¤×¦×™×¤×™ ×‘××•× ×™×™×”) ××™× ×• ××•×‘×˜×—. ××›×™×•×•×Ÿ ×©××™×§×•× ×”×—×“×¨ ××™× ×• ×™×“×•×¢ ××¨××©, ×œ× × ×™×ª×Ÿ ×œ×“×¢×ª ×× ×”× ×•×£ ××”×—×“×¨ ×™×”×™×” × ×•×£ ××œ×, ×—×œ×§×™ ××• ××•×¡×ª×¨.<br>ğŸ’¡ ×—×©×•×‘ ×œ×“×¢×ª!<br>×—×“×¨×™× ××¡×•×’ "×’×¨× ×˜×™" ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª ×¢×©×•×™×™× ×œ×”×™×•×ª ××©×•×“×¨×’×™× ×‘××§×¨×™× ×©×œ ××•×‘×¨×‘×•×§×™× ×’, ×›×š ×©×™×© ×¡×™×›×•×™ ×œ×§×‘×œ ×©×“×¨×•×’ ×œ×¡×•×’ ×—×“×¨ ×˜×•×‘ ×™×•×ª×¨ ğŸ˜Š
                            </div>
                        </div>
                        <!-- Inclusions & Terms -->
                        <div class="mt-8 text-sm space-y-3 no-split">
                            <ul id="previewInclusions" class="list-disc list-inside bg-gray-50 p-4 rounded-lg">
                            </ul>
                        </div>
                        <!-- Flights Details -->
                        <div id="previewFlightsContainer" class="my-6 hidden">
                            <h3 class="text-xl font-bold mb-3">×¤×¨×˜×™ ×˜×™×¡×•×ª:</h3>
                            <div class="border p-3 rounded-lg bg-white space-y-2 no-split">
                                <div id="previewFlightsList" class="space-y-2"></div>
                                <ul id="previewFlightIncludes" class="list-disc list-inside"></ul>
                                <p id="previewFlightFreeText"></p>
                                <p class="font-semibold text-right" id="previewFlightCost"></p>
                                <div id="previewFlightConditions" class="text-sm"></div>
                            </div>
                        </div>
                        <!-- Hotel Details -->
                        <div id="previewHotelsSection" class="my-6 hidden">
                            <h3 class="text-xl font-bold mb-3">×¤×¨×˜×™ ××œ×•× ×•×ª:</h3>
                            <div id="previewHotelsContainer" class="space-y-4">
                                <!-- Hotel previews go here -->
                            </div>
                        </div>
                        <!-- Transfers Details -->
                        <div id="previewTransfersContainer" class="my-6 hidden">
                            <h3 class="text-xl font-bold mb-3">×¤×¨×˜×™ ×”×¢×‘×¨×•×ª:</h3>
                            <div class="border p-3 rounded-lg bg-white space-y-2 no-split">
                                <div id="previewTransfersList" class="space-y-2"></div>
                                <p class="font-semibold text-right" id="previewTransfersCost"></p>
                                <div id="previewTransfersConditions" class="text-sm"></div>
                            </div>
                        </div>
                        <div id="previewTotalContainer" class="mt-6 text-2xl font-bold text-right text-blue-900 bg-gray-100 p-4 rounded-lg no-split">
                            ×¡×”"×› ×¢×œ×•×ª: $<span id="previewTotalPrice">0</span>
                        </div>
                        <!-- Ship Image -->
                        <!-- <div id="previewShipImageSection" class="my-8 no-split hidden">
                           <img id="previewShipImage" src="https://placehold.co/800x450/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××•× ×™×™×”" class="w-full rounded-lg shadow-md" alt="Cruise Ship">
                        </div> -->
                        <!-- Terms -->
                        <div class="mt-8 text-sm space-y-3">
                            <div class="border-t pt-4 mt-4 no-split">
                                <h4 class="font-bold">×ª× ××™ ×ª×©×œ×•× ×•×‘×™×˜×•×œ:</h4>
                                <p><strong>××¤×©×¨×•×™×•×ª ×ª×©×œ×•×:</strong></p>
                                <ul class="list-disc list-inside">
                                    <li>×›×¨×˜×™×¡ ××©×¨××™ ×¢×“ 3 ×ª×©×œ×•××™× ×œ×œ× ×¨×™×‘×™×ª â€“ ×¢×“ 6 ×ª×©×œ×•××™× ×¢× ×¨×™×‘×™×ª 3% - ××¢×œ 6 ×•×¢×“ 18 ×‘×§×¨×“×™×˜.</li>
                                    <li>×”×¢×‘×¨×” ×‘× ×§××™×ª ×©×§×œ/×“×•×œ×¨/×™×•×¨×•</li>
                                    <li>××–×•××Ÿ ×œ×¤×™ ×—×•×§ ×”××–×•××Ÿ ×‘××©×¨×“× ×•</li>
                                </ul>
                                <p><strong>×ª× ××™ ×‘×™×˜×•×œ:</strong> ×‘×”×ª×× ×œ×ª× ××™ ×—×‘×¨×ª ×”×©×™×™×˜ ×”××¦×•×¨×¤×™× ×‘× ×¤×¨×“.</p>
                                <p class="text-xs text-gray-500 mt-2">×œ×ª×©×•××ª ×œ×‘×š: ×—×•×§ ×”×’× ×ª ×”×¦×¨×›×Ÿ ××™× ×• ×ª×§×£ ×œ×”×–×× ×•×ª ×©×™×¨×•×ª×™ ×ª×™×™×¨×•×ª ×”××ª×—×™×œ×™× ×•××¡×ª×™×™××™× ××—×•×¥ ×œ×™×©×¨××œ.</p>
                                <p class="text-xs text-gray-500 mt-2">×˜×œ"×—</p>
                                <p class="text-xs text-gray-500 mt-2">*×¨×›×™×©×ª ×›×œ ××•×¦×¨ ×•×‘×™×˜×•×œ×• ××™× ×” ×›×¤×•×¤×” ×œ×©×•× ××•×¦×¨ ××—×¨!</p>
                                <p class="font-bold mt-4">×—×©×•×‘ ×œ×™ ×œ×¦×™×™×Ÿ ×©×›×œ ×”××—×™×¨×™× × ×›×•× ×™× ×œ×”×¨×’×¢ ×•×™×›×•×œ×™× ×œ×”×©×ª× ×•×ª ×‘×›×œ ×¨×’×¢ × ×ª×•×Ÿ.</p>
                            </div>
                        </div>
                    </main>
                    <!-- Footer -->
                    <footer class="text-center mt-12 border-t-2 pt-6 border-gray-200">
                        <p class="font-bold text-lg text-blue-800">×ª×•×“×” ×©×‘×—×¨×ª× ×œ×”×¤×œ×™×’ ××™×ª× ×•!</p>
                        <p id="previewAdvisor">×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™ | ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | lior@balicruise.co.il</p>
                    </footer>
                </div>
            </div>
        </div>
    </div>
    <!-- Room HTML Template (for cloning) -->
    <template id="roomTemplate">
        <div class="room-entry border p-4 rounded-lg mt-2 bg-gray-50 relative">
            <button class="remove-room-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <!-- Composition -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">×”×¨×›×‘</label>
                    <select name="composition" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">×‘×—×¨ ×”×¨×›×‘</option>
                        <option value="× ×•×¡×¢ ×™×—×™×“">× ×•×¡×¢ ×™×—×™×“</option>
                        <option value="×–×•×’">×–×•×’</option>
                        <option value="×–×•×’ + 1">×–×•×’ + 1</option>
                        <option value="×–×•×’ + 2">×–×•×’ + 2</option>
                        <option value="×–×•×’ + 3">×–×•×’ + 3</option>
                        <option value="××‘×•×’×¨ + ×™×œ×“">××‘×•×’×¨ + ×™×œ×“</option>
                        <option value="××‘×•×’×¨ + 2 ×™×œ×“×™×">××‘×•×’×¨ + 2 ×™×œ×“×™×</option>
                        <option value="××‘×•×’×¨ + 3 ×™×œ×“×™×">××‘×•×’×¨ + 3 ×™×œ×“×™×</option>
                        <option value="××‘×•×’×¨ + 4 ×™×œ×“×™×">××‘×•×’×¨ + 4 ×™×œ×“×™×</option>
                        <option value="3 ××‘×•×’×¨×™×">3 ××‘×•×’×¨×™×</option>
                        <option value="3 ××‘×•×’×¨×™× + 1">3 ××‘×•×’×¨×™× + 1</option>
                        <option value="3 ××‘×•×’×¨×™× + 2">3 ××‘×•×’×¨×™× + 2</option>
                        <option value="4 ××‘×•×’×¨×™×">4 ××‘×•×’×¨×™×</option>
                        <option value="4 ××‘×•×’×¨×™× + 1">4 ××‘×•×’×¨×™× + 1</option>
                        <option value="5 ××‘×•×’×¨×™×">5 ××‘×•×’×¨×™×</option>
                    </select>
                </div>
                <!-- Room Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª×™××•×¨ ×—×“×¨</label>
                    <select name="roomType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">×‘×—×¨ ×¡×•×’ ×—×“×¨</option>
                        <option value="×¤× ×™××™ ×’×¨× ×˜×™">×¤× ×™××™ ×’×¨× ×˜×™</option>
                        <option value="×¤× ×™××™ ×¢× ×‘×—×™×¨×ª ××™×§×•×">×¤× ×™××™ ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="×—×œ×•×Ÿ ×’×¨× ×˜×™">×—×œ×•×Ÿ ×’×¨× ×˜×™</option>
                        <option value="×—×œ×•×Ÿ ×¢× ×‘×—×™×¨×ª ××™×§×•×">×—×œ×•×Ÿ ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="××¨×¤×¡×ª ×œ×™× ×’×¨× ×˜×™">××¨×¤×¡×ª ×œ×™× ×’×¨× ×˜×™</option>
                        <option value="××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×’×¨× ×˜×™">××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×’×¨× ×˜×™</option>
                        <option value="××¨×¤×¡×ª ×œ×™× ×¢× ×‘×—×™×¨×ª ××™×§×•×">××¨×¤×¡×ª ×œ×™× ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×¢× ×‘×—×™×¨×ª ××™×§×•×">××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×¢× ×‘×—×™×¨×ª ××™×§×•×</option>
                        <option value="×¡×•×•×™×˜×”">×¡×•×•×™×˜×”</option>
                    </select>
                </div>
                <!-- Additional Room Details (Floor and Room Number) -->
                <div class="room-details hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">×§×•××”</label>
                        <input type="text" name="floor" placeholder="×œ×“×•×’××”: 10" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">××¡×¤×¨ ×—×“×¨</label>
                        <input type="text" name="roomNumber" placeholder="×œ×“×•×’××”: 1234" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <!-- Additional Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª×™××•×¨ × ×•×¡×£ (×œ× ×—×•×‘×”)</label>
                    <textarea name="extraDesc" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="×”×•×¡×£ ×¤×¨×˜×™× × ×•×¡×¤×™× ×¢×œ ×”×—×“×¨..."></textarea>
                </div>
                <!-- Price -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ($)</label>
                    <input type="number" name="roomCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <!-- Flight HTML Template (for cloning) -->
    <template id="flightTemplate">
        <div class="flight-entry border p-4 rounded-lg bg-gray-50 relative">
            <button class="remove-flight-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">×—×‘×¨×ª ×ª×¢×•×¤×”</label>
                    <input type="text" name="airline" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">××•×¦×</label>
                    <input type="text" name="from" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×™×¢×“</label>
                    <input type="text" name="to" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª××¨×™×š</label>
                    <input type="date" name="date" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×©×¢×ª ×”××¨××”</label>
                    <input type="text" name="takeoff" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×©×¢×ª × ×—×™×ª×”</label>
                    <input type="text" name="landing" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <!-- Transfer HTML Template (for cloning) -->
    <template id="transferTemplate">
        <div class="transfer-entry border p-4 rounded-lg bg-gray-50 relative">
            <button class="remove-transfer-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¡×•×’ ×”×¢×‘×¨×”</label>
                    <select name="transferType" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">×‘×—×¨ ×¡×•×’</option>
                        <option value="×©×“×” ×ª×¢×•×¤×” - ××œ×•×Ÿ">×©×“×” ×ª×¢×•×¤×” - ××œ×•×Ÿ</option>
                        <option value="××œ×•×Ÿ - × ××œ ×§×¨×•×–×™×">××œ×•×Ÿ - × ××œ ×§×¨×•×–×™×</option>
                        <option value="× ××œ ×§×¨×•×–×™× - ××œ×•×Ÿ">× ××œ ×§×¨×•×–×™× - ××œ×•×Ÿ</option>
                        <option value="××œ×•×Ÿ - ×©×“×” ×ª×¢×•×¤×”">××œ×•×Ÿ - ×©×“×” ×ª×¢×•×¤×”</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">××œ×œ ×—×•×¤×©×™</label>
                    <textarea name="transferFreeText" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                </div>
            </div>
        </div>
    </template>
    <!-- Hotel HTML Template (for cloning) -->
    <template id="hotelTemplate">
        <div class="hotel-entry border p-4 rounded-lg bg-gray-50 relative">
            <button class="remove-hotel-btn absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">×©× ×”××œ×•×Ÿ</label>
                    <input type="text" name="hotelName" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">××¡×¤×¨ ×œ×™×œ×•×ª</label>
                        <input type="number" name="hotelNights" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">××ª××¨×™×š</label>
                        <input type="date" name="hotelStartDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¡×•×’ ×—×“×¨</label>
                    <textarea name="hotelRoomDesc" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¤× ×¡×™×•×Ÿ</label>
                    <select name="hotelPension" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        <option value="">×‘×—×¨</option>
                        <option value="×œ×™× ×” ×‘×œ×‘×“">×œ×™× ×” ×‘×œ×‘×“</option>
                        <option value="×œ×™× ×” ×•××¨×•×—×ª ×‘×•×§×¨">×œ×™× ×” ×•××¨×•×—×ª ×‘×•×§×¨</option>
                        <option value="×—×¦×™ ×¤× ×¡×™×•×Ÿ">×—×¦×™ ×¤× ×¡×™×•×Ÿ</option>
                        <option value="×¤× ×¡×™×•×Ÿ ××œ×">×¤× ×¡×™×•×Ÿ ××œ×</option>
                        <option value="×”×›×œ ×›×œ×•×œ">×”×›×œ ×›×œ×•×œ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×¢×œ×•×ª ××œ×•×Ÿ ($)</label>
                    <input type="number" name="hotelCost" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">×ª× ××™ ×‘×™×˜×•×œ</label>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" name="hotelCancellable" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <label class="ml-2">× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ ×¢× ×“××™</label>
                        </div>
                        <div class="hotel-cancel-details hidden space-y-2 ml-6">
                            <input type="text" name="hotelCancelFee" placeholder="×“××™ ×‘×™×˜×•×œ ×œ×—×“×¨" class="w-full border-gray-300 rounded-md shadow-sm">
                            <label class="block text-sm font-medium text-gray-700 mt-2">×¢×“ ×œ×ª××¨×™×š</label>
                            <input type="date" name="hotelCancelDate" class="w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="hotelNoCancel" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <label class="ml-2">×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ/×©×™× ×•×™</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    <script>
        // --- DATA (Simulating Excel file with images integrated) ---
        const cruiseData = {
            "MSC": [
                {name: "MSC Preziosa", year: 2013, image: "https://i.postimg.cc/mrYsMd0L/MSC-300x225.webp"},
                {name: "MSC World America", year: 2025, image: "https://i.postimg.cc/rwB97TQJ/MSC-World-America-main-300x225.webp"},
                {name: "MSC Splendida", year: 2009, image: "https://i.postimg.cc/DwY9X9j3/MSC-300x225.webp"},
                {name: "MSC World Asia", year: 2026, image: "https://i.postimg.cc/9F3QkF90/MSC-World-Asia.jpg"},
                {name: "MSC Magnifica", year: 2010, image: "https://i.postimg.cc/s2rpwX0Y/MSC-300x225.webp"},
                {name: "MSC World Europa", year: 2022, image: "https://i.postimg.cc/V6jZKvwn/MSC-World-Europa-main-300x225.webp"},
                {name: "MSC Musica", year: 2006, image: "https://i.postimg.cc/K8LPPLQc/MSC-300x225.webp"},
                {name: "MSC Seashore", year: 2021, image: "https://i.postimg.cc/PrX9FX0k/MSC-300x225.webp"},
                {name: "MSC Orchestra", year: 2007, image: "https://i.postimg.cc/BQwpcHFR/MSC-main-300x225.webp"},
                {name: "MSC Seaside", year: 2017, image: "https://i.postimg.cc/cHG570f2/MSC-300x225.webp"},
                {name: "MSC Poesia", year: 2008, image: "https://i.postimg.cc/ZKJztFB2/MSC-300x225.webp"},
                {name: "MSC Seascape", year: 2022, image: "https://i.postimg.cc/wBmGs7RD/MSC-300x225.webp"},
                {name: "MSC Armonia", year: 2001, image: "https://i.postimg.cc/FsKGLDYj/MSC-main-300x225.webp"},
                {name: "MSC Seaview", year: 2018, image: "https://i.postimg.cc/J4zY5TBr/MSC-300x225.webp"},
                {name: "MSC Lirica", year: 2003, image: "https://i.postimg.cc/fbfYFN66/MSC-300x225.webp"},
                {name: "MSC Bellissima", year: 2019, image: "https://i.postimg.cc/SNQ1GmvY/MSC-main-300x225.webp"},
                {name: "MSC Opera", year: 2004, image: "https://i.postimg.cc/52Y3Pyqy/MSC-main-300x225.webp"},
                {name: "MSC Euribia", year: 2023, image: "https://i.postimg.cc/3w2ZTqqH/MSC-Euribia-main-300x225.webp"},
                {name: "MSC Sinfonia", year: 2002, image: "https://i.postimg.cc/2jwXvpy9/MSC-300x225.webp"},
                {name: "MSC Grandiosa", year: 2019, image: "https://i.postimg.cc/yxjQzGkN/MSC-main-300x225.webp"},
                {name: "MSC Divina", year: 2012, image: "https://i.postimg.cc/yxsQtK65/MSC-main-300x225.webp"},
                {name: "MSC Meraviglia", year: 2017, image: "https://i.postimg.cc/J4S3HKNd/MSC-300x225.webp"},
                {name: "MSC Fantasia", year: 2008, image: "https://i.postimg.cc/x877BHWp/MSC-300x225.webp"},
                {name: "MSC Virtuosa", year: 2021, image: "https://i.postimg.cc/sXF0PSk3/MSC-300x225.webp"}
            ],
            "Royal Caribbean": [
                {name: "Adventure of the Seas", year: 2001, image: "https://i.postimg.cc/gknzTbwr/Adventure-of-the-Seas-300x225.webp"},
                {name: "Allure of the Seas", year: 2010, image: "https://i.postimg.cc/4xcJXvQg/Allure-of-the-Seas-300x225.webp"},
                {name: "Anthem of the Seas", year: 2015, image: "https://i.postimg.cc/fbhMy380/Anthem-of-the-Seas-300x225.webp"},
                {name: "Brilliance of the Seas", year: 2002, image: "https://i.postimg.cc/3wCYvKqf/Brilliance-of-the-Seas-300x225.webp"},
                {name: "Enchantment of the Seas", year: 1997, image: "https://i.postimg.cc/NMsY83qs/Enchantment-of-the-Seas-300x225.webp"},
                {name: "Explorer of the Seas", year: 2000, image: "https://i.postimg.cc/4xpTDfX4/Explorer-of-the-Seas-300x225.webp"},
                {name: "Freedom of the Seas", year: 2006, image: "https://i.postimg.cc/Bvgfvm8d/Freedom-of-the-Seas-300x225.webp"},
                {name: "Grandeur of the Seas", year: 1996, image: "https://i.postimg.cc/269pQ37G/Grandeur-of-the-Seas-300x225.webp"},
                {name: "Harmony of the Seas", year: 2016, image: "https://i.postimg.cc/Y0v5bkXH/Harmony-of-the-Seas-300x225.webp"},
                {name: "Icon of the Seas", year: 2024, image: "https://i.postimg.cc/ZYgt0BRK/Icon-of-the-Seas-300x225.webp"},
                {name: "Independence of the Seas", year: 2008, image: "https://i.postimg.cc/2SxBzfwm/Independence-of-the-Seas-300x225.webp"},
                {name: "Jewel of the Seas", year: 2004, image: "https://i.postimg.cc/nzXsY9tc/Jewel-of-the-Seas-300x225.webp"},
                {name: "Legend of the Seas", year: 1995, image: "https://i.postimg.cc/C19RvMFC/LEGEND-OF-THE-SEAS-300x225.webp"},
                {name: "Liberty of the Seas", year: 2007, image: "https://i.postimg.cc/ZYyBWNcw/Liberty-of-the-Seas-300x225.webp"},
                {name: "Mariner of the Seas", year: 2003, image: "https://i.postimg.cc/QxQFbrv5/Mariner-of-the-Seas-300x225.webp"},
                {name: "Navigator of the Seas", year: 2002, image: "https://i.postimg.cc/9Qcrgnjk/Navigator-of-the-Seas-300x225.webp"},
                {name: "Oasis of the Seas", year: 2009, image: "https://i.postimg.cc/PrytJfB6/Oasis-of-the-Seas-300x225.webp"},
                {name: "Odyssey of the Seas", year: 2021, image: "https://i.postimg.cc/Fzm4FwG5/Odyssey-of-the-Seas-300x225.webp"},
                {name: "Ovation of the Seas", year: 2016, image: "https://i.postimg.cc/vTzd4XS1/Ovation-of-the-Seas-300x225.webp"},
                {name: "Quantum of the Seas", year: 2014, image: "https://i.postimg.cc/SsgrjMfS/Quantum-of-the-Seas-300x225.webp"},
                {name: "Radiance of the Seas", year: 2001, image: "https://i.postimg.cc/rsz94wfS/Radiance-of-the-Seas-300x225.webp"},
                {name: "Rhapsody of the Seas", year: 1997, image: "https://i.postimg.cc/zXbjX3bN/Rhapsody-of-the-Seas-300x225.webp"},
                {name: "Serenade of the Seas", year: 2003, image: "https://i.postimg.cc/02TC6xDw/Serenade-of-the-Seas-300x225.webp"},
                {name: "Spectrum of the Seas", year: 2019, image: "https://i.postimg.cc/bv8HTT6Y/Spectrum-of-the-Seas-300x225.webp"},
                {name: "Star of the Seas", year: 2025, image: "https://i.postimg.cc/284SNRdw/Star-of-the-Seas.jpg"},
                {name: "Symphony of the Seas", year: 2018, image: "https://i.postimg.cc/0NfGHw3Y/Symphony-of-the-Seas-300x225.webp"},
                {name: "Utopia of the Seas", year: 2024, image: "https://i.postimg.cc/Z54KT7Vh/Utopia-of-the-Seas.jpg"}
            ],
            "Norwegian Cruise Line": [
                {name: "Norwegian Aqua", year: 2025, image: "https://i.postimg.cc/T3hRkwRy/NORWEIGAN-AQUA-300x202.png"},
                {name: "Norwegian Bliss", year: 2018, image: "https://i.postimg.cc/jC05VYZV/Norwegian-Bliss-300x225.webp"},
                {name: "Norwegian Breakaway", year: 2013, image: "https://i.postimg.cc/MHx6tmTx/Norwegian-Breakaway-300x225.webp"},
                {name: "Norwegian Dawn", year: 2002, image: "https://i.postimg.cc/5yMB3TL0/Norwegian-Dawn-300x225.webp"},
                {name: "Norwegian Encore", year: 2019, image: "https://i.postimg.cc/wxhcvxYs/Norwegian-Encore-300x225.webp"},
                {name: "Norwegian Epic", year: 2010, image: "https://i.postimg.cc/VLm9byzZ/Norwegian-Epic-300x225.webp"},
                {name: "Norwegian Escape", year: 2015, image: "https://i.postimg.cc/CL7GGv1h/Norwegian-Escape-300x225.webp"},
                {name: "Norwegian Getaway", year: 2014, image: "https://i.postimg.cc/x8GFC77H/Norwegian-Getaway-300x225.webp"},
                {name: "Norwegian Jade", year: 2006, image: "https://i.postimg.cc/4xxFfW17/Norwegian-Jade-300x225.webp"},
                {name: "Norwegian Jewel", year: 2005, image: "https://i.postimg.cc/dtq565pH/Norwegian-Jewel-300x225.webp"},
                {name: "Norwegian Joy", year: 2017, image: "https://i.postimg.cc/TPW01F5w/Norwegian-Joy-300x225.webp"},
                {name: "Norwegian Luna", year: 2026, image: "https://i.postimg.cc/WzZb4xBs/NORWEGIAN-LUNA.jpg"},
                {name: "Norwegian Pearl", year: 2006, image: "https://i.postimg.cc/sxK9bRqn/Norwegian-Pearl-300x225.webp"},
                {name: "Norwegian Prima", year: 2022, image: "https://i.postimg.cc/xjPRXK8K/Norwegian-Prima-300x225.webp"},
                {name: "Norwegian Sky", year: 1999, image: "https://i.postimg.cc/yYYTck32/Norwegian-Sky-300x225.webp"},
                {name: "Norwegian Spirit", year: 1998, image: "https://i.postimg.cc/L8JBQwTT/Norwegian-Spirit-300x225.webp"},
                {name: "Norwegian Star", year: 2001, image: "https://i.postimg.cc/qvWcPwDd/Norwegian-Star-300x225.webp"},
                {name: "Norwegian Sun", year: 2001, image: "https://i.postimg.cc/FsB0SG4J/Norwegian-Sun-300x225.webp"},
                {name: "Norwegian Viva", year: 2023, image: "https://i.postimg.cc/g09RSJrz/Norwegian-Viva-300x225.webp"},
                {name: "Norwegian Gem", year: 2007, image: "https://i.postimg.cc/90fqRwgp/Norwegian-Gem-300x225.webp"},
                {name: "Pride of America", year: 2005, image: "https://i.postimg.cc/59Pzcpjk/Pride-of-America-300x225.webp"}
            ],
            "CELEBRITY": [
                {name: "Celebrity Apex", year: 2020, image: "https://i.postimg.cc/76hB396G/Celebrity-Apex-300x225.webp"},
                {name: "Celebrity Ascent", year: 2023, image: "https://i.postimg.cc/zvR0MfTq/Celebrity-Ascent-300x225.webp"},
                {name: "Celebrity Beyond", year: 2022, image: "https://i.postimg.cc/JzmCNwWs/Celebrity-Beyond-300x225.webp"},
                {name: "Celebrity Constellation", year: 2002, image: "https://i.postimg.cc/N0jhn1FY/Celebrity-Constellation-300x225.webp"},
                {name: "Celebrity Eclipse", year: 2010, image: "https://i.postimg.cc/TwKzdfn4/Celebrity-Eclipse-300x225.webp"},
                {name: "Celebrity Edge", year: 2018, image: "https://i.postimg.cc/1X6bFBC0/Celebrity-Edge-300x225.webp"},
                {name: "Celebrity Equinox", year: 2009, image: "https://i.postimg.cc/L6tr6yZ2/Celebrity-Equinox-300x225.webp"},
                {name: "Celebrity Flora", year: 2019, image: "https://i.postimg.cc/g2G1wvvR/Celebrity-Flora-300x225.webp"},
                {name: "Celebrity Infinity", year: 2001, image: "https://i.postimg.cc/jj59ct3S/Celebrity-Infinity-300x225.webp"},
                {name: "Celebrity Millennium", year: 2000, image: "https://i.postimg.cc/KYHWswCr/Celebrity-Millennium-300x225.webp"},
                {name: "Celebrity Reflection", year: 2012, image: "https://i.postimg.cc/C5yQwDhR/Celebrity-Reflection-300x225.webp"},
                {name: "Celebrity Silhouette", year: 2011, image: "https://i.postimg.cc/RhcbhFhX/Celebrity-Silhouette-300x225.webp"},
                {name: "Celebrity Solstice", year: 2008, image: "https://i.postimg.cc/1R6dJWBw/Celebrity-Solstice-300x225.webp"},
                {name: "Celebrity Summit", year: 2001, image: "https://i.postimg.cc/VL8VTjZT/Celebrity-Summit-300x225.webp"},
                {name: "Celebrity Xce", year: 2025, image: "https://i.postimg.cc/ZKxMhC1q/Celebrity-Xcel-300x225.webp"}
            ],
            "COSTA": [
                {name: "Costa Deliziosa", year: 2010, image: "https://i.postimg.cc/ryCJD7gn/Costa-Deliziosa-300x225.webp"},
                {name: "Costa Diadema", year: 2014, image: "https://i.postimg.cc/Fsrx3GB9/Costa-Diadema-300x225.webp"},
                {name: "Costa Fascinosa", year: 2012, image: "https://i.postimg.cc/TYtJ9mzn/Costa-Fascinosa-300x225.webp"},
                {name: "Costa Favolosa", year: 2011, image: "https://i.postimg.cc/t4ft0bCT/Costa-Favolosa-300x225.webp"},
                {name: "Costa Fortuna", year: 2003, image: "https://i.postimg.cc/Ssb6sG9b/Costa-Fortuna-300x225.webp"},
                {name: "Costa Pacifica", year: 2009, image: "https://i.postimg.cc/bNwQsrZr/Costa-Pacifica-300x225.webp"},
                {name: "Costa Serena", year: 2007, image: "https://i.postimg.cc/7Z9Pb3WJ/Costa-Serena.jpg"},
                {name: "Costa Smeralda", year: 2019, image: "https://i.postimg.cc/YCgj9Bzj/Costa-Smeralda-300x225.webp"},
                {name: "Costa Toscana", year: 2021, image: "https://i.postimg.cc/FRK90M3y/Costa-Toscana-300x225.webp"},
                {name: "Costa Firenze", year: 2021, image: "https://i.postimg.cc/sgRsTQ5D/Costa-Firenze-300x225.webp"}
            ]
        };
        // --- ADVISORS DATA ---
        const advisors = {
            "lior": "×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™ / Lior Dovinovsky| ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | lior@balicruise.co.il",
            "tatiana": "×˜×˜×™×× ×” ×œ××•× ×•×‘/Tatyana Leonov | ×™×•×¢×¦×ª ×©×™×™×˜ | 03-3106454 | tatiana@balicruise.co.il",
            "koren": "×§×•×¨×Ÿ ××‘×¡×¢×™×“ | Koren avsaid | ×× ×”×œ ××—×œ×§×ª ×©×™×™×˜ | 03-3106454 | Koren@balicruise.co.il",
            "yarden": "×™×¨×“×Ÿ ×©×§×“ | Yarden shaked | ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | Yarden@balicruise.co.il",
            "nir": "× ×™×¨ | Nir | ×™×•×¢×¥ ×©×™×™×˜ | 03-3106454 | nir@balicruise.co.il"
        };
        // Guarantee message
        const guaranteeMessage = "××™×§×•× ×”×—×“×¨ ×™×™×§×‘×¢ ×¢×œ ×™×“×™ ×—×‘×¨×ª ×”×©×™×™×˜";
        // Room types that require details
        const detailRoomTypes = [
            "×¤× ×™××™ ×¢× ×‘×—×™×¨×ª ××™×§×•×",
            "×—×œ×•×Ÿ ×¢× ×‘×—×™×¨×ª ××™×§×•×",
            "××¨×¤×¡×ª ×œ×™× ×¢× ×‘×—×™×¨×ª ××™×§×•×",
            "××¨×¤×¡×ª ×œ×¤× ×™× ×”××•× ×™×™×” ×¢× ×‘×—×™×¨×ª ××™×§×•×",
            "×¡×•×•×™×˜×”"
        ];
        
        // --- CACHE DOM ELEMENTS ---
        const elements = {
            clientName: document.getElementById('clientName'),
            offerDate: document.getElementById('offerDate'),
            cruiseLine: document.getElementById('cruiseLine'),
            shipName: document.getElementById('shipName'),
            cruiseDuration: document.getElementById('cruiseDuration'),
            cruiseStartDate: document.getElementById('cruiseStartDate'),
            cruiseEndDate: document.getElementById('cruiseEndDate'),
            advisor: document.getElementById('advisor'),
            itineraryPasteTarget: document.getElementById('itineraryPasteTarget'),
            roomsContainer: document.getElementById('roomsContainer'),
            addRoomBtn: document.getElementById('addRoomBtn'),
            includeTips: document.getElementById('includeTips'),
            includeMeals: document.getElementById('includeMeals'),
            hideTotal: document.getElementById('hideTotal'),
            hideCruise: document.getElementById('hideCruise'),
            customInclusions: document.getElementById('customInclusions'),
            flightsContainer: document.getElementById('flightsContainer'),
            addFlightBtn: document.getElementById('addFlightBtn'),
            flightIncludes: document.getElementById('flightIncludes'),
            flightFreeText: document.getElementById('flightFreeText'),
            flightCost: document.getElementById('flightCost'),
            flightNoCancel: document.getElementById('flightNoCancel'),
            flightCancellable: document.getElementById('flightCancellable'),
            flightCancelCheck: document.getElementById('flightCancelCheck'),
            flightChangeCheck: document.getElementById('flightChangeCheck'),
            flightCancelFee: document.getElementById('flightCancelFee'),
            flightChangeFee: document.getElementById('flightChangeFee'),
            transfersContainer: document.getElementById('transfersContainer'),
            addTransferBtn: document.getElementById('addTransferBtn'),
            transfersCost: document.getElementById('transfersCost'),
            transfersNoCancel: document.getElementById('transfersNoCancel'),
            transfersCancellable: document.getElementById('transfersCancellable'),
            transfersCancelDate: document.getElementById('transfersCancelDate'),
            transfersCancelFee: document.getElementById('transfersCancelFee'),
            hotelsContainer: document.getElementById('hotelsContainer'),
            addHotelBtn: document.getElementById('addHotelBtn'),
            generatePDFBtn: document.getElementById('generatePDFBtn'),
            // Preview elements
            previewClientName: document.getElementById('previewClientName'),
            previewDate: document.getElementById('previewDate'),
            previewCruiseDetails: document.getElementById('previewCruiseDetails'),
            previewCruiseLine: document.getElementById('previewCruiseLine'),
            previewShipName: document.getElementById('previewShipName'),
            previewCruiseDuration: document.getElementById('previewCruiseDuration'),
            previewCruiseDate: document.getElementById('previewCruiseDate'),
            previewItinerarySection: document.getElementById('previewItinerarySection'),
            previewItineraryImage: document.getElementById('previewItineraryImage'),
            previewRoomsSection: document.getElementById('previewRoomsSection'),
            previewRoomsContainer: document.getElementById('previewRoomsContainer'),
            previewGuaranteeNote: document.getElementById('previewGuaranteeNote'),
            previewInclusions: document.getElementById('previewInclusions'),
            previewFlightsContainer: document.getElementById('previewFlightsContainer'),
            previewFlightsList: document.getElementById('previewFlightsList'),
            previewFlightIncludes: document.getElementById('previewFlightIncludes'),
            previewFlightFreeText: document.getElementById('previewFlightFreeText'),
            previewFlightCost: document.getElementById('previewFlightCost'),
            previewFlightConditions: document.getElementById('previewFlightConditions'),
            previewHotelsSection: document.getElementById('previewHotelsSection'),
            previewHotelsContainer: document.getElementById('previewHotelsContainer'),
            previewTransfersContainer: document.getElementById('previewTransfersContainer'),
            previewTransfersList: document.getElementById('previewTransfersList'),
            previewTransfersCost: document.getElementById('previewTransfersCost'),
            previewTransfersConditions: document.getElementById('previewTransfersConditions'),
            previewTotalContainer: document.getElementById('previewTotalContainer'),
            previewTotalPrice: document.getElementById('previewTotalPrice'),
            // previewShipImageSection: document.getElementById('previewShipImageSection'),
            // previewShipImage: document.getElementById('previewShipImage'),
            previewAdvisor: document.getElementById('previewAdvisor'),
            previewElement: document.getElementById('preview'),
            previewMain: document.getElementById('preview-main'),
            inputForm: document.getElementById('inputForm')
        };
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            populateShips();
            setupEventListeners();
            updatePreview();
        });
        
        function setupEventListeners() {
            // All form inputs
            elements.inputForm.addEventListener('input', updateStateAndPreview);
            elements.inputForm.addEventListener('change', updateStateAndPreview);
            // Dynamic buttons
            elements.addRoomBtn.addEventListener('click', () => { addRoom(); updateStateAndPreview(); });
            elements.addFlightBtn.addEventListener('click', () => { addFlight(); updateStateAndPreview(); });
            elements.addHotelBtn.addEventListener('click', () => { addHotel(); updateStateAndPreview(); });
            elements.addTransferBtn.addEventListener('click', () => { addTransfer(); updateStateAndPreview(); });
            // Specific event listeners
            elements.cruiseLine.addEventListener('change', populateShips);
            elements.itineraryPasteTarget.addEventListener('paste', handlePaste);
            elements.itineraryPasteTarget.addEventListener('click', () => elements.itineraryPasteTarget.focus());
            elements.generatePDFBtn.addEventListener('click', generatePDF);
            elements.flightCancellable.addEventListener('change', toggleFlightCancelDetails);
            elements.transfersCancellable.addEventListener('change', toggleTransfersCancelDetails);
        }
        // --- STATE MANAGEMENT (localStorage) ---
        function saveState() {
            const state = {};
            const formInputs = elements.inputForm.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => {
                if(input.closest('.hotel-entry')) return; // Handled in dynamic fields
                if (input.type === 'checkbox' || input.type === 'radio') {
                    state[input.id] = input.checked;
                } else {
                    state[input.id] = input.value;
                }
            });
            const dynamicFields = {
                rooms: [],
                flights: [],
                transfers: [],
                hotels: []
            };
            elements.roomsContainer.querySelectorAll('.room-entry').forEach(roomDiv => {
                const roomData = {};
                roomDiv.querySelectorAll('input, select, textarea').forEach(input => {
                    roomData[input.name] = input.value;
                });
                dynamicFields.rooms.push(roomData);
            });
            elements.flightsContainer.querySelectorAll('.flight-entry').forEach(flightDiv => {
                const flightData = {};
                flightDiv.querySelectorAll('input').forEach(input => {
                    flightData[input.name] = input.value;
                });
                dynamicFields.flights.push(flightData);
            });
            elements.transfersContainer.querySelectorAll('.transfer-entry').forEach(transferDiv => {
                const transferData = {};
                transferDiv.querySelectorAll('select, textarea').forEach(input => {
                    transferData[input.name] = input.value;
                });
                dynamicFields.transfers.push(transferData);
            });
            elements.hotelsContainer.querySelectorAll('.hotel-entry').forEach(hotelDiv => {
                const hotelData = {};
                hotelDiv.querySelectorAll('input, select, textarea').forEach(input => {
                    if (input.type === 'checkbox') {
                        hotelData[input.name] = input.checked;
                    } else {
                        hotelData[input.name] = input.value;
                    }
                });
                dynamicFields.hotels.push(hotelData);
            });
            localStorage.setItem('quoteFormState', JSON.stringify({ ...state, dynamicFields }));
        }
        function loadState() {
            const savedState = JSON.parse(localStorage.getItem('quoteFormState'));
            if (!savedState) {
                elements.offerDate.valueAsDate = new Date();
                addRoom();
                addFlight();
                addHotel();
                return;
            }
            // Restore static inputs
            const formInputs = elements.inputForm.querySelectorAll('input, select, textarea');
            formInputs.forEach(input => {
                if(input.closest('.hotel-entry')) return;
                if (savedState[input.id] !== undefined) {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = savedState[input.id];
                    } else {
                        input.value = savedState[input.id];
                    }
                }
            });
            // Restore dynamic fields
            elements.roomsContainer.innerHTML = '';
            elements.flightsContainer.innerHTML = '';
            elements.transfersContainer.innerHTML = '';
            elements.hotelsContainer.innerHTML = '';
            savedState.dynamicFields.rooms.forEach(roomData => addRoom(roomData));
            savedState.dynamicFields.flights.forEach(flightData => addFlight(flightData));
            savedState.dynamicFields.transfers.forEach(transferData => addTransfer(transferData));
             if (savedState.dynamicFields.hotels) { 
                savedState.dynamicFields.hotels.forEach(hotelData => addHotel(hotelData));
            }
        }
        function updateStateAndPreview() {
            saveState();
            updatePreview();
        }
        // --- DYNAMIC FORM LOGIC ---
        function populateShips() {
            const cruiseLine = elements.cruiseLine.value;
            const shipSelect = elements.shipName;
            shipSelect.innerHTML = '';
            const ships = cruiseData[cruiseLine] || [];
            ships.forEach(ship => {
                const option = document.createElement('option');
                option.value = ship.name;
                option.textContent = `${ship.name} (${ship.year})`;
                shipSelect.appendChild(option);
            });
            updateStateAndPreview();
        }
        
        function addRoom(initialData = {}) {
            const template = document.getElementById('roomTemplate');
            const clone = template.content.cloneNode(true);
            const roomDiv = clone.querySelector('.room-entry');
            elements.roomsContainer.appendChild(clone);
            
            // Set initial data and setup listeners
            if (Object.keys(initialData).length > 0) {
                 for (const key in initialData) {
                    const input = roomDiv.querySelector(`[name="${key}"]`);
                    if (input) input.value = initialData[key];
                }
            }
            
            roomDiv.querySelector('.remove-room-btn').addEventListener('click', () => {
                roomDiv.remove();
                updateStateAndPreview();
            });
            roomDiv.querySelector('select[name="roomType"]').addEventListener('change', () => toggleRoomDetails(roomDiv));
            toggleRoomDetails(roomDiv); // Initial toggle
        }
        function addFlight(initialData = {}) {
            const template = document.getElementById('flightTemplate');
            const clone = template.content.cloneNode(true);
            const flightDiv = clone.querySelector('.flight-entry');
            elements.flightsContainer.appendChild(clone);
            
            if (Object.keys(initialData).length > 0) {
                for (const key in initialData) {
                    const input = flightDiv.querySelector(`[name="${key}"]`);
                    if (input) input.value = initialData[key];
                }
            }

            // Default airline from previous flight if exists
            const existingFlights = elements.flightsContainer.querySelectorAll('.flight-entry');
            if (existingFlights.length > 1 && !initialData.airline) { // Since we just added one
                const previousAirline = existingFlights[existingFlights.length - 2].querySelector('input[name="airline"]').value;
                if (previousAirline) {
                    flightDiv.querySelector('input[name="airline"]').value = previousAirline;
                }
            }
            flightDiv.querySelector('.remove-flight-btn').addEventListener('click', () => {
                flightDiv.remove();
                updateStateAndPreview();
            });
        }
        
        function addTransfer(initialData = {}) {
            const template = document.getElementById('transferTemplate');
            const clone = template.content.cloneNode(true);
            const transferDiv = clone.querySelector('.transfer-entry');
            elements.transfersContainer.appendChild(clone);
            if (Object.keys(initialData).length > 0) {
                for (const key in initialData) {
                    const input = transferDiv.querySelector(`[name="${key}"]`);
                    if (input) input.value = initialData[key];
                }
            }
            transferDiv.querySelector('.remove-transfer-btn').addEventListener('click', () => {
                transferDiv.remove();
                updateStateAndPreview();
            });
        }

        function addHotel(initialData = {}) {
            const template = document.getElementById('hotelTemplate');
            const clone = template.content.cloneNode(true);
            const hotelDiv = clone.querySelector('.hotel-entry');
            elements.hotelsContainer.appendChild(clone);

            if (Object.keys(initialData).length > 0) {
                for (const key in initialData) {
                    const input = hotelDiv.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = initialData[key];
                        } else {
                            input.value = initialData[key];
                        }
                    }
                }
            }

            const cancellableCheckbox = hotelDiv.querySelector('[name="hotelCancellable"]');
            const cancelDetailsDiv = hotelDiv.querySelector('.hotel-cancel-details');

            const toggleDetails = () => {
                cancelDetailsDiv.classList.toggle('hidden', !cancellableCheckbox.checked);
            };

            cancellableCheckbox.addEventListener('change', toggleDetails);
            
            hotelDiv.querySelector('.remove-hotel-btn').addEventListener('click', () => {
                hotelDiv.remove();
                updateStateAndPreview();
            });
            
            toggleDetails(); // Initial check
        }
        
        function toggleTransfersCancelDetails() {
            const detailsDiv = document.getElementById('transfersCancelDetails');
            const isCancellable = elements.transfersCancellable.checked;
            detailsDiv.classList.toggle('hidden', !isCancellable);
        }
        
        function toggleFlightCancelDetails() {
            const detailsDiv = document.getElementById('flightCancelDetails');
            const isCancellable = elements.flightCancellable.checked;
            detailsDiv.classList.toggle('hidden', !isCancellable);
        }
        
        function toggleRoomDetails(roomEntry) {
            const detailsDiv = roomEntry.querySelector('.room-details');
            const roomType = roomEntry.querySelector('select[name="roomType"]').value;
            const isDetailed = detailRoomTypes.includes(roomType);
            detailsDiv.classList.toggle('hidden', !isDetailed);
        }
        
        // --- IMAGE PASTE LOGIC (only for itinerary) ---
        function handlePaste(event) {
            event.preventDefault();
            const items = (event.clipboardData || window.clipboardData).items;
            for (const item of items) {
                if (item.type.startsWith('image/')) {
                    const blob = item.getAsFile();
                    if (blob) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            elements.previewItineraryImage.src = e.target.result;
                            elements.itineraryPasteTarget.innerHTML = `<span class="text-green-600 font-semibold">×ª××•× ×” ×”×•×¢×œ×ª×” ×‘×”×¦×œ×—×”!</span>`;
                            elements.itineraryPasteTarget.classList.remove('border-gray-300');
                            elements.itineraryPasteTarget.classList.add('border-green-500');
                            saveState(); // Save image state
                        };
                        reader.readAsDataURL(blob);
                    }
                    return;
                }
            }
        }
        // --- PREVIEW UPDATE LOGIC ---
        function updatePreview() {
            // Simple text fields
            elements.previewClientName.textContent = elements.clientName.value || '___';
            const offerDate = elements.offerDate.value;
            elements.previewDate.textContent = offerDate ? `×ª××¨×™×š: ${new Date(offerDate).toLocaleDateString('he-IL')}` : '';
            elements.previewCruiseLine.textContent = elements.cruiseLine.value;
            elements.previewShipName.textContent = elements.shipName.value;
            elements.previewCruiseDuration.textContent = elements.cruiseDuration.value || '7';
            const cruiseStart = elements.cruiseStartDate.value ? new Date(elements.cruiseStartDate.value).toLocaleDateString('he-IL') : '';
            const cruiseEnd = elements.cruiseEndDate.value ? new Date(elements.cruiseEndDate.value).toLocaleDateString('he-IL') : '';
            elements.previewCruiseDate.textContent = cruiseStart && cruiseEnd ? `${cruiseStart} - ${cruiseEnd}` : '___';
        
            // Advisor
            const selectedAdvisor = elements.advisor.value;
            elements.previewAdvisor.textContent = advisors[selectedAdvisor];
        
            // Show cruise sections only if cruise line is selected and not hidden
            const hasCruiseLine = !!elements.cruiseLine.value;
            const hideCruiseSection = elements.hideCruise.checked;
            elements.previewCruiseDetails.classList.toggle('hidden', hideCruiseSection || !hasCruiseLine);
            elements.previewItinerarySection.classList.toggle('hidden', hideCruiseSection || !hasCruiseLine);
            elements.previewRoomsSection.classList.toggle('hidden', hideCruiseSection || !hasCruiseLine);
            // elements.previewShipImageSection.classList.toggle('hidden', hideCruiseSection || !hasCruiseLine);
        
            // Ship Image
            /* const cruiseLine = elements.cruiseLine.value;
            const shipName = elements.shipName.value;
            const ship = cruiseData[cruiseLine]?.find(s => s.name === shipName);
            if (ship && ship.image) {
                elements.previewShipImage.src = ship.image;
            } else {
                elements.previewShipImage.src = 'https://placehold.co/800x450/e2e8f0/adb5bd?text=×ª××•× ×ª+×”××•× ×™×™×”';
            } */
        
            // Rooms and Total Price
            elements.previewRoomsContainer.innerHTML = '';
            let totalPrice = 0;
            let totalPassengers = 0;
            let hasGuarantee = false;
        
            const roomEntries = elements.roomsContainer.querySelectorAll('.room-entry');
            roomEntries.forEach((room, index) => {
                const composition = room.querySelector('select[name="composition"]').value;
                switch(composition) {
                    case '× ×•×¡×¢ ×™×—×™×“': totalPassengers += 1; break;
                    case '×–×•×’': totalPassengers += 2; break;
                    case '×–×•×’ + 1': totalPassengers += 3; break;
                    case '×–×•×’ + 2': totalPassengers += 4; break;
                    case '×–×•×’ + 3': totalPassengers += 5; break;
                    case '××‘×•×’×¨ + ×™×œ×“': totalPassengers += 2; break;
                    case '××‘×•×’×¨ + 2 ×™×œ×“×™×': totalPassengers += 3; break;
                    case '××‘×•×’×¨ + 3 ×™×œ×“×™×': totalPassengers += 4; break;
                    case '××‘×•×’×¨ + 4 ×™×œ×“×™×': totalPassengers += 5; break;
                    case '3 ××‘×•×’×¨×™×': totalPassengers += 3; break;
                    case '3 ××‘×•×’×¨×™× + 1': totalPassengers += 4; break;
                    case '3 ××‘×•×’×¨×™× + 2': totalPassengers += 5; break;
                    case '4 ××‘×•×’×¨×™×': totalPassengers += 4; break;
                    case '4 ××‘×•×’×¨×™× + 1': totalPassengers += 5; break;
                    case '5 ××‘×•×’×¨×™×': totalPassengers += 5; break;
                }

                const roomType = room.querySelector('select[name="roomType"]').value;
                const floor = room.querySelector('input[name="floor"]').value;
                const roomNumber = room.querySelector('input[name="roomNumber"]').value;
                const extraDesc = room.querySelector('textarea[name="extraDesc"]').value;
                const costValue = parseFloat(room.querySelector('input[name="roomCost"]').value) || 0;
        
                if (roomType && roomType.includes('×’×¨× ×˜×™')) {
                    hasGuarantee = true;
                }
        
                if (composition || roomType || extraDesc || costValue > 0) {
                    let roomDetails = [];
                    if (composition) roomDetails.push(`<strong>×”×¨×›×‘:</strong> ${composition}`);
                    if (roomType) {
                        let typeText = `<strong>×ª×™××•×¨:</strong> ${roomType}`;
                        if (roomType.includes('×’×¨× ×˜×™')) {
                            typeText += ` - ${guaranteeMessage}`;
                        } else if (floor || roomNumber) {
                            const locationDetails = [];
                            if (floor) locationDetails.push(`×§×•××”: ${floor}`);
                            if (roomNumber) locationDetails.push(`×—×“×¨: ${roomNumber}`);
                            if (locationDetails.length > 0) {
                                typeText += ` (${locationDetails.join(', ')})`;
                            }
                        }
                        roomDetails.push(typeText);
                    }
                    if (extraDesc) roomDetails.push(`${extraDesc}`);
        
                    const roomDiv = document.createElement('div');
                    roomDiv.className = 'border p-3 rounded-lg bg-white no-split';
                    roomDiv.innerHTML = `
                        <p><strong>×—×“×¨ ${index + 1}:</strong></p>
                        <p class="space-y-1 my-2">${roomDetails.join(' | ')}</p>
                        <p class="font-semibold text-right">×¢×œ×•×ª: $${costValue.toLocaleString()}</p>
                    `;
                    elements.previewRoomsContainer.appendChild(roomDiv);
                    totalPrice += costValue;
                }
            });
            elements.previewGuaranteeNote.classList.toggle('hidden', !hasGuarantee);
        
            // Inclusions
            const inclusionsList = elements.previewInclusions;
            inclusionsList.innerHTML = '';
            let hasInclusions = false;
            
            if (elements.includeMeals.checked) {
                addInclusionItem(inclusionsList, '×›×•×œ×œ 3 ××¨×•×—×•×ª ××œ××•×ª ×‘×™×•×, ××™×¡×™× ×•×‘×•×¤×” ×¢×©×™×¨ ×œ××•×¨×š ×”×™×•×.');
                hasInclusions = true;
            }
            addInclusionItem(inclusionsList, elements.includeTips.checked ? '×›×•×œ×œ ×ª×©×œ×•× ×˜×™×¤×™× ××¨××©.' : '×œ× ×›×•×œ×œ ×ª×©×œ×•× ×˜×™×¤×™× ××¨××©.');
            hasInclusions = true;
            const customInclusionsText = elements.customInclusions.value.trim();
            if (customInclusionsText) {
                customInclusionsText.split('\n').filter(line => line.trim()).forEach(line => {
                    addInclusionItem(inclusionsList, line.trim());
                    hasInclusions = true;
                });
            }
            if (!hasInclusions) {
                addInclusionItem(inclusionsList, '××™×Ÿ ×”×›×œ×œ×•×ª ××™×•×—×“×•×ª.');
            }
            // Flights
            const flightCostPerPerson = parseFloat(elements.flightCost.value) || 0;
            const flightCostValue = flightCostPerPerson * totalPassengers;
            const hasFlights = elements.flightsContainer.querySelectorAll('.flight-entry').length > 0 || flightCostValue > 0;
            elements.previewFlightsContainer.classList.toggle('hidden', !hasFlights);
            if (hasFlights) {
                elements.previewFlightsList.innerHTML = '';
                elements.flightsContainer.querySelectorAll('.flight-entry').forEach((flight, index) => {
                    const airline = flight.querySelector('input[name="airline"]').value || '___';
                    const from = flight.querySelector('input[name="from"]').value || '___';
                    const to = flight.querySelector('input[name="to"]').value || '___';
                    const date = flight.querySelector('input[name="date"]').value ? new Date(flight.querySelector('input[name="date"]').value).toLocaleDateString('he-IL') : '___';
                    const takeoff = flight.querySelector('input[name="takeoff"]').value || '___';
                    const landing = flight.querySelector('input[name="landing"]').value || '___';
                    const p = document.createElement('p');
                    p.textContent = `×˜×™×¡×” ×‘×—×‘×¨×ª ${airline} × ${from} ×œ ${to} ×‘×ª××¨×™×š ${date} ×”××¨××” ${takeoff} × ×—×™×ª×” ${landing}`;
                    elements.previewFlightsList.appendChild(p);
                });
                const includesList = elements.previewFlightIncludes;
                includesList.innerHTML = '';
                elements.flightIncludes.value.split('\n').forEach(line => {
                    if (line.trim()) {
                        addInclusionItem(includesList, line.trim());
                    }
                });
                elements.previewFlightFreeText.textContent = elements.flightFreeText.value;
                
                if (flightCostPerPerson > 0 && totalPassengers > 0) {
                    elements.previewFlightCost.textContent = `×¢×œ×•×ª: $${flightCostPerPerson.toLocaleString()} ×œ××“× X ${totalPassengers} × ×•×¡×¢×™× = $${flightCostValue.toLocaleString()}`;
                } else if (flightCostPerPerson > 0) {
                    elements.previewFlightCost.textContent = `×¢×œ×•×ª: $${flightCostPerPerson.toLocaleString()} ×œ××“×`;
                } else {
                    elements.previewFlightCost.textContent = '';
                }

                totalPrice += flightCostValue;
        
                let conditionsText = '';
                if (elements.flightNoCancel.checked) {
                    conditionsText = '<p>×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™ ××¨×’×¢ ××™×©×•×¨ ×”×”×–×× ×”</p>';
                } else if (elements.flightCancellable.checked) {
                    const cancelFee = elements.flightCancelFee.value;
                    const changeFee = elements.flightChangeFee.value;
                    if (elements.flightCancelCheck.checked && cancelFee) {
                        conditionsText += `<p>×‘×™×˜×•×œ â€“ × ×™×ª×Ÿ ×œ×‘×™×˜×•×œ ×¢×“ 72 ×©×¢×•×ª ×œ×¤× ×™ ×”×”××¨××” ×‘ ${cancelFee} ×œ× ×•×¡×¢</p>`;
                    }
                    if (elements.flightChangeCheck.checked && changeFee) {
                        conditionsText += `<p>×©×™× ×•×™ â€“ × ×™×ª×Ÿ ×œ×©×™× ×•×™ ×¢×“ 72 ×©×¢×•×ª ×œ×¤× ×™ ×”×”××¨××” ×‘ ${changeFee} ×œ× ×•×¡×¢ ×•××•×ª× ×” ×‘××•×ª×” ××—×œ×§×ª ×©×™×¨×•×ª, ×‘××™×“×” ×•××™×Ÿ ××©×œ××™× ×”×¤×¨×©×™ ××—×™×¨×™×.</p>`;
                    }
                }
                elements.previewFlightConditions.innerHTML = conditionsText;
            }
        
            // Hotels
            elements.previewHotelsContainer.innerHTML = '';
            let totalHotelCost = 0;
            const hotelEntries = elements.hotelsContainer.querySelectorAll('.hotel-entry');
            const hasHotels = hotelEntries.length > 0 && Array.from(hotelEntries).some(h => h.querySelector('[name="hotelName"]').value || h.querySelector('[name="hotelCost"]').value > 0);
            
            elements.previewHotelsSection.classList.toggle('hidden', !hasHotels);

            if (hasHotels) {
                hotelEntries.forEach((hotel) => {
                    const hotelName = hotel.querySelector('[name="hotelName"]').value || '___';
                    const hotelCostValue = parseFloat(hotel.querySelector('[name="hotelCost"]').value) || 0;
                    
                    if (!hotelName && !hotelCostValue) return;

                    const hotelNights = hotel.querySelector('[name="hotelNights"]').value || '___';
                    const hotelStartDateValue = hotel.querySelector('[name="hotelStartDate"]').value;
                    const hotelStartDate = hotelStartDateValue ? new Date(hotelStartDateValue).toLocaleDateString('he-IL') : '___';
                    const hotelRoomDesc = hotel.querySelector('[name="hotelRoomDesc"]').value || '___';
                    const hotelPension = hotel.querySelector('[name="hotelPension"]').value || '___';
                    
                    totalHotelCost += hotelCostValue;

                    let conditionsText = '';
                    const hotelNoCancel = hotel.querySelector('[name="hotelNoCancel"]').checked;
                    const hotelCancellable = hotel.querySelector('[name="hotelCancellable"]').checked;
                    
                    if (hotelNoCancel) {
                        conditionsText += '<p>×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ/ ×©×™× ×•×™ ××¨×’×¢ ××™×©×•×¨ ×”×”×–×× ×”</p>';
                    } else if (hotelCancellable) {
                        const cancelFee = hotel.querySelector('[name="hotelCancelFee"]').value;
                        const cancelDateValue = hotel.querySelector('[name="hotelCancelDate"]').value;
                        const cancelDate = cancelDateValue ? new Date(cancelDateValue).toLocaleDateString('he-IL') : '___';
                        
                        if (cancelFee && cancelDate !== '___') {
                            conditionsText += `<p>×‘×™×˜×•×œ â€“ × ×™×ª×Ÿ ×œ×‘×˜×œ ×‘×¢×œ×•×ª ×©×œ ${cancelFee} ×œ×—×“×¨ ×¢×“ ×œ×ª××¨×™×š ${cancelDate} ×•×œ××—×¨×™×• ×“××™ ×‘×™×˜×•×œ ××œ××™×</p>`;
                        }
                    }
                    
                    const hotelPreviewDiv = document.createElement('div');
                    hotelPreviewDiv.className = 'border p-3 rounded-lg bg-white space-y-2 no-split';
                    hotelPreviewDiv.innerHTML = `
                        <h4 class="font-bold text-md">${hotelName}</h4>
                        <p>${hotelNights} ×œ×™×œ×•×ª ××ª××¨×™×š ${hotelStartDate}</p>
                        <p>×¡×•×’ ×—×“×¨: ${hotelRoomDesc}</p>
                        <p>×¤× ×¡×™×•×Ÿ: ${hotelPension}</p>
                        <p class="font-semibold text-right">×¢×œ×•×ª: $${hotelCostValue.toLocaleString()}</p>
                        <div class="text-sm">${conditionsText}</div>
                    `;
                    elements.previewHotelsContainer.appendChild(hotelPreviewDiv);
                });
            }
            
            totalPrice += totalHotelCost;

            // Transfers
            const transfersCostValue = parseFloat(elements.transfersCost.value) || 0;
            const hasTransfers = elements.transfersContainer.querySelectorAll('.transfer-entry').length > 0 || transfersCostValue > 0;
            elements.previewTransfersContainer.classList.toggle('hidden', !hasTransfers);
            if (hasTransfers) {
                elements.previewTransfersList.innerHTML = '';
                elements.transfersContainer.querySelectorAll('.transfer-entry').forEach((transfer, index) => {
                    const type = transfer.querySelector('select[name="transferType"]').value || '___';
                    const freeText = transfer.querySelector('textarea[name="transferFreeText"]').value || '';
                    if (type !== '___' || freeText) {
                        const p = document.createElement('p');
                        p.textContent = `${index + 1}. ${type}${freeText ? ` - ${freeText}` : ''}`;
                        elements.previewTransfersList.appendChild(p);
                    }
                });
                elements.previewTransfersCost.textContent = `×¢×œ×•×ª: $${transfersCostValue.toLocaleString()}`;
                totalPrice += transfersCostValue;
        
                let conditionsText = '';
                if (elements.transfersNoCancel.checked) {
                    conditionsText += `<p>×œ×œ× ××¤×©×¨×•×ª ×‘×™×˜×•×œ / ×©×™× ×•×™</p>`;
                } else if (elements.transfersCancellable.checked && elements.transfersCancelDate.value && elements.transfersCancelFee.value) {
                    const transfersCancelDateFormatted = new Date(elements.transfersCancelDate.value).toLocaleDateString('he-IL');
                    conditionsText += `<p>× ×™×ª×Ÿ ×œ×‘×™×˜×•×œ ×¢×“ ×œ×ª××¨×™×š ${transfersCancelDateFormatted} ×‘×“××™ ×‘×™×˜×•×œ ×‘×¡×š ${elements.transfersCancelFee.value}</p>`;
                }
                elements.previewTransfersConditions.innerHTML = conditionsText;
            }
        
            // Total
            elements.previewTotalContainer.classList.toggle('hidden', elements.hideTotal.checked);
            elements.previewTotalPrice.textContent = totalPrice.toLocaleString();
            
            // Toggle conditional fields
            toggleFlightCancelDetails();
            toggleTransfersCancelDetails();
        }
        
        function addInclusionItem(list, text) {
            const li = document.createElement('li');
            li.textContent = text;
            list.appendChild(li);
        }
        // --- PDF GENERATION ---
        async function generatePDF() {
            elements.previewElement.classList.remove('shadow-lg');
            const { jsPDF } = window.jspdf;
        
            // Clone the preview element to a temporary container for rendering
            const previewClone = elements.previewElement.cloneNode(true);
            previewClone.style.position = 'absolute';
            previewClone.style.left = '-9999px';
            previewClone.style.width = '794px'; // A4 width in px for rendering
            document.body.appendChild(previewClone);
        
            // Remove any dynamic buttons that shouldn't be in the PDF
            previewClone.querySelectorAll('.remove-room-btn, .remove-flight-btn, .remove-transfer-btn, .remove-hotel-btn').forEach(btn => btn.remove());
        
            // Ensure all images are loaded before rendering to canvas
            const images = previewClone.querySelectorAll('img');
            const promises = Array.from(images).map(img => new Promise(resolve => {
                if (img.complete) {
                    resolve();
                } else {
                    img.onload = resolve;
                    img.onerror = resolve; // Handle errors gracefully
                }
            }));
            await Promise.all(promises);
        
            const canvas = await html2canvas(previewClone, {
                scale: 2,
                useCORS: true,
                letterRendering: true
            });
        
            // Remove the clone after rendering
            previewClone.remove();
        
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const imgHeight = canvas.height * pdfWidth / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;
        
            pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, imgHeight);
            heightLeft -= pdfHeight;
        
            while (heightLeft > 0) {
                position -= pdfHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, imgHeight);
                heightLeft -= pdfHeight;
            }
        
            const clientName = elements.clientName.value || '×”×¦×¢×”';
            const shipName = elements.shipName.value || '×§×¨×•×–';
            pdf.save(`×”×¦×¢×ª ××—×™×¨ ${shipName} - ${clientName}.pdf`);
            elements.previewElement.classList.add('shadow-lg');
        }
    </script>
    <footer class="text-center mt-8 text-xs text-gray-500">
        ×¤×•×ª×— ×¢×œ ×™×“×™ ×œ×™××•×¨ ×“×•×‘×™× ×•×‘×¡×§×™
    </footer>
</body>
</html>

