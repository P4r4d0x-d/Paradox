<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחולל הצעות מחיר לקרוזים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Assistant', sans-serif;
        }
        /* Custom styles to ensure the preview looks good */
        .preview-container {
            font-family: 'Assistant', sans-serif;
        }
        /* Prevent content from being editable in the preview */
        .preview-container * {
            pointer-events: none;
        }
        /* Helper class for printing */
        @media print {
            .no-print {
                display: none;
            }
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-800">מחולל הצעות מחיר לקרוזים</h1>
            <p class="text-gray-600 mt-2">מלא את הפרטים בטופס כדי ליצור הצעת מחיר מקצועית בפורמט PDF.</p>
        </header>
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Input Form -->
            <div class="lg:w-1/2 bg-white p-6 rounded-2xl shadow-lg no-print">
                <h2 class="text-2xl font-bold mb-6 border-b pb-3">פרטי ההצעה</h2>
           
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="clientName" class="block text-sm font-medium text-gray-700">שם הלקוח/ה</label>
                        <input type="text" id="clientName" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="offerDate" class="block text-sm font-medium text-gray-700">תאריך ההצעה</label>
                        <input type="date" id="offerDate" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div>
                        <label for="cruiseLine" class="block text-sm font-medium text-gray-700">חברת שייט</label>
                        <select id="cruiseLine" onchange="populateShips(); updatePreview();" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option>MSC</option>
                            <option>Royal Caribbean</option>
                            <option>Norwegian Cruise Line</option>
                            <option>CELEBRITY</option>
                            <option>COSTA</option>
                        </select>
                    </div>
                    <div>
                        <label for="shipName" class="block text-sm font-medium text-gray-700">שם האונייה</label>
                        <select id="shipName" onchange="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></select>
                    </div>
                    <div>
                        <label for="cruiseDuration" class="block text-sm font-medium text-gray-700">משך ההפלגה (לילות)</label>
                        <input type="number" id="cruiseDuration" value="7" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                     <div>
                        <label for="cruiseDate" class="block text-sm font-medium text-gray-700">תאריכי הפלגה</label>
                        <input type="text" id="cruiseDate" placeholder="לדוגמה: 01.01.2026 - 08.01.2026" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="advisor" class="block text-sm font-medium text-gray-700">יועץ שייט</label>
                        <select id="advisor" onchange="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                            <option value="lior">ליאור דובינובסקי</option>
                            <option value="tatiana">טטיאנה לאונוב</option>
                            <option value="koren">קורן אבסעיד</option>
                            <option value="yarden">ירדן שקד</option>
                            <option value="nir">ניר</option>
                        </select>
                    </div>
                </div>
                <!-- Itinerary Image Paste Area -->
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700">תמונת מסלול</label>
                    <div id="itineraryPasteTarget" class="mt-1 flex justify-center items-center w-full h-24 border-2 border-dashed border-gray-300 rounded-md cursor-pointer text-gray-500 p-2 text-center transition-colors">
                        <span>הדבק תמונה כאן (Ctrl+V)</span>
                    </div>
                </div>
                <!-- Rooms Section -->
                <div id="roomsContainer" class="mt-6">
                    <h3 class="text-xl font-bold mb-3">חדרים</h3>
                    <!-- Room template will be cloned here -->
                </div>
                <button onclick="addRoom()" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ הוסף חדר</button>
                <!-- Inclusions -->
                <div class="mt-6">
                     <h3 class="text-xl font-bold mb-3">מה כלול</h3>
                     <div class="space-y-2">
                         <div class="flex items-start">
                             <input id="includeTips" type="checkbox" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                             <label for="includeTips" class="ml-2 block text-sm text-gray-900">כולל תשלום טיפים מראש</label>
                         </div>
                         <div class="flex items-start">
                             <input id="includeMeals" type="checkbox" onchange="updatePreview()" checked class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1">
                             <label for="includeMeals" class="ml-2 block text-sm text-gray-900">כולל 3 ארוחות מלאות ביום + מיסים + בופה עשיר</label>
                         </div>
                     </div>
                     <div class="mt-4">
                        <label for="customInclusions" class="block text-sm font-medium text-gray-700">הערות ודגשים נוספים (כל שורה תופיע כסעיף נפרד)</label>
                        <textarea id="customInclusions" oninput="updatePreview()" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                <!-- Flights Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">טיסות (אופציונלי)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div id="flightsContainer" class="space-y-4">
                            <!-- Flight templates will be cloned here -->
                        </div>
                        <button onclick="addFlight()" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ הוסף טיסה</button>
                        <div>
                            <label for="airline" class="block text-sm font-medium text-gray-700">חברת תעופה</label>
                            <input type="text" id="airline" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="flightIncludes" class="block text-sm font-medium text-gray-700">הכרטיס כולל (ניתן לערוך)</label>
                            <textarea id="flightIncludes" oninput="updatePreview()" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">מזוודה 20 ק"ג\nטרולי 7 ק"ג</textarea>
                        </div>
                        <div>
                            <label for="flightFreeText" class="block text-sm font-medium text-gray-700">מלל חופשי לטיסות</label>
                            <textarea id="flightFreeText" oninput="updatePreview()" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                        </div>
                        <div>
                            <label for="flightCost" class="block text-sm font-medium text-gray-700">עלות טיסות ($)</label>
                            <input type="number" id="flightCost" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">תנאי ביטול/שינוי</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="flightCancellable" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightCancellable" class="ml-2">ניתן לביטול עם דמי</label>
                                    <input type="text" id="flightCancelFee" placeholder="דמי ביטול לנוסע" oninput="updatePreview()" class="ml-2 w-32 border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="flightChangeable" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightChangeable" class="ml-2">ניתן לשינוי עם דמי</label>
                                    <input type="text" id="flightChangeFee" placeholder="דמי שינוי לנוסע" oninput="updatePreview()" class="ml-2 w-32 border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="flightNoCancel" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="flightNoCancel" class="ml-2">ללא אפשרות ביטול/שינוי</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hotel Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">מלון (אופציונלי)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div>
                            <label for="hotelName" class="block text-sm font-medium text-gray-700">שם המלון</label>
                            <input type="text" id="hotelName" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="hotelRoomDesc" class="block text-sm font-medium text-gray-700">חדר, הרכב ומחיר</label>
                            <textarea id="hotelRoomDesc" oninput="updatePreview()" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                        </div>
                        <div>
                            <label for="hotelPension" class="block text-sm font-medium text-gray-700">פנסיון</label>
                            <select id="hotelPension" onchange="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                <option value="">בחר</option>
                                <option value="לינה וארוחת בוקר">לינה וארוחת בוקר</option>
                                <option value="חצי פנסיון">חצי פנסיון</option>
                                <option value="פנסיון מלא">פנסיון מלא</option>
                                <option value="הכל כלול">הכל כלול</option>
                            </select>
                        </div>
                        <div>
                            <label for="hotelCost" class="block text-sm font-medium text-gray-700">עלות מלון ($)</label>
                            <input type="number" id="hotelCost" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">תנאי ביטול/שינוי</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="hotelCancellable" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="hotelCancellable" class="ml-2">ניתן לביטול עם דמי</label>
                                    <input type="text" id="hotelCancelFee" placeholder="דמי ביטול לנוסע" oninput="updatePreview()" class="ml-2 w-32 border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="hotelChangeable" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="hotelChangeable" class="ml-2">ניתן לשינוי עם דמי</label>
                                    <input type="text" id="hotelChangeFee" placeholder="דמי שינוי לנוסע" oninput="updatePreview()" class="ml-2 w-32 border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="hotelNoCancel" onchange="updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="hotelNoCancel" class="ml-2">ללא אפשרות ביטול/שינוי</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Transfers Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold mb-3">העברות (אופציונלי)</h3>
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg">
                        <div id="transfersContainer" class="space-y-4">
                            <!-- Transfer templates will be cloned here -->
                        </div>
                        <button onclick="addTransfer()" class="mt-2 text-sm font-semibold text-blue-600 hover:text-blue-800">+ הוסף העברה</button>
                        <div>
                            <label for="transfersCost" class="block text-sm font-medium text-gray-700">עלות כל ההעברות ($)</label>
                            <input type="number" id="transfersCost" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">תנאי ביטול</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="transfersNoCancel" name="transfersCancelType" onchange="toggleTransfersCancelDetails(); updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="transfersNoCancel" class="ml-2">ללא אפשרות ביטול / שינוי</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="transfersCancellable" name="transfersCancelType" onchange="toggleTransfersCancelDetails(); updatePreview()" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                    <label for="transfersCancellable" class="ml-2">ניתן לביטול</label>
                                </div>
                                <div id="transfersCancelDetails" class="hidden space-y-2 ml-6">
                                    <div>
                                        <label for="transfersCancelDate" class="block text-sm font-medium text-gray-700">עד תאריך</label>
                                        <input type="text" id="transfersCancelDate" oninput="updatePreview()" placeholder="לדוגמה: 01.01.2026" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    </div>
                                    <div>
                                        <label for="transfersCancelFee" class="block text-sm font-medium text-gray-700">דמי ביטול</label>
                                        <input type="text" id="transfersCancelFee" oninput="updatePreview()" placeholder="לדוגמה: $50" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 flex justify-center">
                    <button onclick="generatePDF()" class="w-full lg:w-auto bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">
                        הורד PDF
                    </button>
                </div>
            </div>
            <!-- Live Preview -->
            <div class="lg:w-1/2">
                <div id="preview" class="bg-white p-8 rounded-2xl shadow-lg min-h-[1123px] w-full max-w-[794px] mx-auto preview-container">
                    <!-- Header -->
                    <header class="flex justify-between items-center border-b-2 pb-4 border-gray-200">
                         <div class="text-right">
                             <img src="https://i.postimg.cc/8T2V9VQ8/2-300-X1200.png" alt="באלי קרוז" class="h-16" />
                         </div>
                         <div style="font-size: 40px; color: #3f3c66;">⚓</div>
                    </header>
                    <!-- Offer Details -->
                    <main class="mt-8">
                        <p class="mb-4"><span id="previewDate" class="font-semibold"></span></p>
                        <p class="text-xl mb-6">לכבוד <span id="previewClientName" class="font-bold"></span>,</p>
                        <p class="mb-6">בהמשך לבקשתך, מצורפת הצעת מחיר להפלגת החלומות שלכם:</p>
                        <div class="bg-blue-50 rounded-lg p-4 mb-6">
                             <h2 class="text-2xl font-bold mb-4 text-blue-800">פרטי ההפלגה</h2>
                             <div class="grid grid-cols-2 gap-4 text-md">
                                 <p><strong>חברת שייט:</strong> <span id="previewCruiseLine"></span></p>
                                 <p><strong>אונייה:</strong> <span id="previewShipName"></span></p>
                                 <p><strong>משך הפלגה:</strong> <span id="previewCruiseDuration"></span> לילות</p>
                                 <p><strong>תאריכים:</strong> <span id="previewCruiseDate"></span></p>
                             </div>
                        </div>
                        <!-- Itinerary Image -->
                        <div class="my-6">
                            <h3 class="text-xl font-bold mb-3">מסלול ההפלגה:</h3>
                            <img id="previewItineraryImage" src="https://placehold.co/800x300/e2e8f0/adb5bd?text=תמונת+המסלול" class="w-full rounded-lg shadow-md" alt="Itinerary Map">
                        </div>
                        <!-- Rooms Details -->
                         <div class="my-6">
                             <h3 class="text-xl font-bold mb-3">פרטי החדרים:</h3>
                             <div id="previewRoomsContainer" class="space-y-4">
                                 <!-- Preview rooms will be added here -->
                             </div>
                         </div>
                         <!-- Inclusions & Terms -->
                        <div class="mt-8 text-sm space-y-3">
                            <ul id="previewInclusions" class="list-disc list-inside bg-gray-50 p-4 rounded-lg">
                                <!-- Inclusions will be added dynamically -->
                            </ul>
                        </div>
                         <!-- Flights Details -->
                         <div id="previewFlightsContainer" class="my-6 hidden">
                             <h3 class="text-xl font-bold mb-3">פרטי טיסות:</h3>
                             <div class="border p-3 rounded-lg bg-white space-y-2">
                                 <div id="previewFlightsList" class="space-y-2"></div>
                                 <p id="previewAirline"></p>
                                 <ul id="previewFlightIncludes" class="list-disc list-inside"></ul>
                                 <p id="previewFlightFreeText"></p>
                                 <p class="font-semibold text-right" id="previewFlightCost"></p>
                                 <div id="previewFlightConditions" class="text-sm"></div>
                             </div>
                         </div>
                         <!-- Hotel Details -->
                         <div id="previewHotelContainer" class="my-6 hidden">
                             <h3 class="text-xl font-bold mb-3">פרטי מלון:</h3>
                             <div class="border p-3 rounded-lg bg-white space-y-2">
                                 <p id="previewHotelName"></p>
                                 <p id="previewHotelRoomDesc"></p>
                                 <p id="previewHotelPension"></p>
                                 <p class="font-semibold text-right" id="previewHotelCost"></p>
                                 <div id="previewHotelConditions" class="text-sm"></div>
                             </div>
                         </div>
                         <!-- Transfers Details -->
                         <div id="previewTransfersContainer" class="my-6 hidden">
                             <h3 class="text-xl font-bold mb-3">פרטי העברות:</h3>
                             <div class="border p-3 rounded-lg bg-white space-y-2">
                                 <div id="previewTransfersList" class="space-y-2"></div>
                                 <p class="font-semibold text-right" id="previewTransfersCost"></p>
                                 <div id="previewTransfersConditions" class="text-sm"></div>
                             </div>
                         </div>
                         <div id="previewTotalContainer" class="mt-6 text-2xl font-bold text-right text-blue-900 bg-gray-100 p-4 rounded-lg">
                             סה"כ עלות: $<span id="previewTotalPrice">0</span>
                         </div>
                        <!-- Ship Image -->
                        <div class="my-8">
                           <img id="previewShipImage" src="https://placehold.co/800x450/e2e8f0/adb5bd?text=תמונת+האונייה" class="w-full rounded-lg shadow-md" alt="Cruise Ship">
                        </div>
                        <!-- Terms -->
                        <div class="mt-8 text-sm space-y-3">
                            <div class="border-t pt-4 mt-4">
                                 <h4 class="font-bold">תנאי תשלום וביטול:</h4>
                                 <p><strong>אפשרויות תשלום:</strong></p>
                                 <ul class="list-disc list-inside">
                                     <li>כרטיס אשראי עד 3 תשלומים ללא ריבית – עד 6 תשלומים עם ריבית 3% - מעל 6 ועד 18 בקרדיט.</li>
                                     <li>העברה בנקאית שקל/דולר/יורו</li>
                                     <li>מזומן לפי חוק המזומן במשרדנו</li>
                                 </ul>
                                 <p><strong>תנאי ביטול:</strong> בהתאם לתנאי חברת השייט המצורפים בנפרד.</p>
                                 <p class="text-xs text-gray-500 mt-2">לתשומת לבך: חוק הגנת הצרכן אינו תקף להזמנות שירותי תיירות המתחילים ומסתיימים מחוץ לישראל.</p>
                                 <p class="text-xs text-gray-500 mt-2">טל"ח</p>
                                 <p class="text-xs text-gray-500 mt-2">*רכישת כל מוצר וביטולו אינה כפופה לשום מוצר אחר!</p>
                                 <p class="font-bold mt-4">חשוב לי לציין שכל המחירים נכונים להרגע ויכולים להשתנות בכל רגע נתון.</p>
                            </div>
                        </div>
                    </main>
                    <!-- Footer -->
                    <footer class="text-center mt-12 border-t-2 pt-6 border-gray-200">
                        <p class="font-bold text-lg text-blue-800">תודה שבחרתם להפליג איתנו!</p>
                        <p id="previewAdvisor">ליאור דובינובסקי | יועץ שייט | 03-3106454 | lior@balicruise.co.il</p>
                    </footer>
                </div>
            </div>
        </div>
    </div>
    <!-- Room HTML Template (for cloning) -->
    <template id="roomTemplate">
        <div class="room-entry border p-4 rounded-lg mt-2 bg-gray-50 relative">
             <button onclick="removeRoom(this)" class="absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <!-- Composition -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">הרכב</label>
                    <select name="composition" onchange="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">בחר הרכב</option>
                        <option value="נוסע יחיד">נוסע יחיד</option>
                        <option value="זוג">זוג</option>
                        <option value="זוג + 1">זוג + 1</option>
                        <option value="זוג + 2">זוג + 2</option>
                        <option value="זוג + 3">זוג + 3</option>
                        <option value="מבוגר + ילד">מבוגר + ילד</option>
                        <option value="מבוגר + 2 ילדים">מבוגר + 2 ילדים</option>
                        <option value="מבוגר + 3 ילדים">מבוגר + 3 ילדים</option>
                        <option value="מבוגר + 4 ילדים">מבוגר + 4 ילדים</option>
                        <option value="3 מבוגרים">3 מבוגרים</option>
                        <option value="3 מבוגרים + 1">3 מבוגרים + 1</option>
                        <option value="3 מבוגרים + 2">3 מבוגרים + 2</option>
                        <option value="4 מבוגרים">4 מבוגרים</option>
                        <option value="4 מבוגרים + 1">4 מבוגרים + 1</option>
                        <option value="5 מבוגרים">5 מבוגרים</option>
                    </select>
                </div>
                <!-- Room Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">תיאור חדר</label>
                    <select name="roomType" onchange="toggleRoomDetails(this); updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">בחר סוג חדר</option>
                        <option value="פנימי גרנטי">פנימי גרנטי</option>
                        <option value="פנימי עם בחירת מיקום">פנימי עם בחירת מיקום</option>
                        <option value="חלון גרנטי">חלון גרנטי</option>
                        <option value="חלון עם בחירת מיקום">חלון עם בחירת מיקום</option>
                        <option value="מרפסת לים גרנטי">מרפסת לים גרנטי</option>
                        <option value="מרפסת לפנים האונייה גרנטי">מרפסת לפנים האונייה גרנטי</option>
                        <option value="מרפסת לים עם בחירת מיקום">מרפסת לים עם בחירת מיקום</option>
                        <option value="מרפסת לפנים האונייה עם בחירת מיקום">מרפסת לפנים האונייה עם בחירת מיקום</option>
                        <option value="סוויטה">סוויטה</option>
                    </select>
                </div>
                <!-- Additional Room Details (Floor and Room Number) -->
                <div id="roomDetails" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">קומה</label>
                        <input type="text" name="floor" oninput="updatePreview()" placeholder="לדוגמה: 10" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">מספר חדר</label>
                        <input type="text" name="roomNumber" oninput="updatePreview()" placeholder="לדוגמה: 1234" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <!-- Additional Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">תיאור נוסף (לא חובה)</label>
                    <textarea name="extraDesc" oninput="updatePreview()" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="הוסף פרטים נוספים על החדר..."></textarea>
                </div>
                <!-- Price -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">עלות ($)</label>
                    <input type="number" name="roomCost" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <!-- Flight HTML Template (for cloning) -->
    <template id="flightTemplate">
        <div class="flight-entry border p-4 rounded-lg bg-gray-50 relative">
             <button onclick="removeFlight(this)" class="absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">מוצא</label>
                    <input type="text" name="from" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">יעד</label>
                    <input type="text" name="to" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">תאריך</label>
                    <input type="text" name="date" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">שעת המראה</label>
                    <input type="text" name="takeoff" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">שעת נחיתה</label>
                    <input type="text" name="landing" oninput="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                </div>
            </div>
        </div>
    </template>
    <!-- Transfer HTML Template (for cloning) -->
    <template id="transferTemplate">
        <div class="transfer-entry border p-4 rounded-lg bg-gray-50 relative">
             <button onclick="removeTransfer(this)" class="absolute top-2 left-2 text-red-500 hover:text-red-700 font-bold no-print">X</button>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">סוג העברה</label>
                    <select name="transferType" onchange="updatePreview()" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">בחר סוג</option>
                        <option value="שדה תעופה - מלון">שדה תעופה - מלון</option>
                        <option value="מלון - נמל קרוזים">מלון - נמל קרוזים</option>
                        <option value="נמל קרוזים - מלון">נמל קרוזים - מלון</option>
                        <option value="מלון - שדה תעופה">מלון - שדה תעופה</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">מלל חופשי</label>
                    <textarea name="transferFreeText" oninput="updatePreview()" rows="2" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                </div>
            </div>
        </div>
    </template>
    <script>
        // --- DATA (Simulating Excel file with images integrated) ---
        const cruiseData = {
            "MSC": [
                {name: "MSC Preziosa", year: 2013, image: "https://i.postimg.cc/mrYsMd0L/MSC-300x225.webp"},
                {name: "MSC World America", year: 2025, image: "https://i.postimg.cc/rwB97TQJ/MSC-World-America-main-300x225.webp"},
                {name: "MSC Splendida", year: 2009, image: "https://i.postimg.cc/DwY9X9j3/MSC-300x225.webp"},
                {name: "MSC World Asia", year: 2026, image: "https://i.postimg.cc/9F3QkF90/MSC-World-Asia.jpg"},
                {name: "MSC Magnifica", year: 2010, image: "https://i.postimg.cc/s2rpwX0Y/MSC-300x225.webp"},
                {name: "MSC World Europa", year: 2022, image: "https://i.postimg.cc/V6jZKvwn/MSC-World-Europa-main-300x225.webp"},
                {name: "MSC Musica", year: 2006, image: "https://i.postimg.cc/K8LPPLQc/MSC-300x225.webp"},
                {name: "MSC Seashore", year: 2021, image: "https://i.postimg.cc/PrX9FX0k/MSC-300x225.webp"},
                {name: "MSC Orchestra", year: 2007, image: "https://i.postimg.cc/BQwpcHFR/MSC-main-300x225.webp"},
                {name: "MSC Seaside", year: 2017, image: "https://i.postimg.cc/cHG570f2/MSC-300x225.webp"},
                {name: "MSC Poesia", year: 2008, image: "https://i.postimg.cc/ZKJztFB2/MSC-300x225.webp"},
                {name: "MSC Seascape", year: 2022, image: "https://i.postimg.cc/wBmGs7RD/MSC-300x225.webp"},
                {name: "MSC Armonia", year: 2001, image: "https://i.postimg.cc/FsKGLDYj/MSC-main-300x225.webp"},
                {name: "MSC Seaview", year: 2018, image: "https://i.postimg.cc/J4zY5TBr/MSC-300x225.webp"},
                {name: "MSC Lirica", year: 2003, image: "https://i.postimg.cc/fbfYFN66/MSC-300x225.webp"},
                {name: "MSC Bellissima", year: 2019, image: "https://i.postimg.cc/SNQ1GmvY/MSC-main-300x225.webp"},
                {name: "MSC Opera", year: 2004, image: "https://i.postimg.cc/52Y3Pyqy/MSC-main-300x225.webp"},
                {name: "MSC Euribia", year: 2023, image: "https://i.postimg.cc/3w2ZTqqH/MSC-Euribia-main-300x225.webp"},
                {name: "MSC Sinfonia", year: 2002, image: "https://i.postimg.cc/2jwXvpy9/MSC-300x225.webp"},
                {name: "MSC Grandiosa", year: 2019, image: "https://i.postimg.cc/yxjQzGkN/MSC-main-300x225.webp"},
                {name: "MSC Divina", year: 2012, image: "https://i.postimg.cc/yxsQtK65/MSC-main-300x225.webp"},
                {name: "MSC Meraviglia", year: 2017, image: "https://i.postimg.cc/J4S3HKNd/MSC-300x225.webp"},
                {name: "MSC Fantasia", year: 2008, image: "https://i.postimg.cc/x877BHWp/MSC-300x225.webp"},
                {name: "MSC Virtuosa", year: 2021, image: "https://i.postimg.cc/sXF0PSk3/MSC-300x225.webp"}
            ],
            "Royal Caribbean": [
                {name: "Adventure of the Seas", year: 2001, image: "https://i.postimg.cc/gknzTbwr/Adventure-of-the-Seas-300x225.webp"},
                {name: "Allure of the Seas", year: 2010, image: "https://i.postimg.cc/4xcJXvQg/Allure-of-the-Seas-300x225.webp"},
                {name: "Anthem of the Seas", year: 2015, image: "https://i.postimg.cc/fbhMy380/Anthem-of-the-Seas-300x225.webp"},
                {name: "Brilliance of the Seas", year: 2002, image: "https://i.postimg.cc/3wCYvKqf/Brilliance-of-the-Seas-300x225.webp"},
                {name: "Enchantment of the Seas", year: 1997, image: "https://i.postimg.cc/NMsY83qs/Enchantment-of-the-Seas-300x225.webp"},
                {name: "Explorer of the Seas", year: 2000, image: "https://i.postimg.cc/4xpTDfX4/Explorer-of-the-Seas-300x225.webp"},
                {name: "Freedom of the Seas", year: 2006, image: "https://i.postimg.cc/Bvgfvm8d/Freedom-of-the-Seas-300x225.webp"},
                {name: "Grandeur of the Seas", year: 1996, image: "https://i.postimg.cc/269pQ37G/Grandeur-of-the-Seas-300x225.webp"},
                {name: "Harmony of the Seas", year: 2016, image: "https://i.postimg.cc/Y0v5bkXH/Harmony-of-the-Seas-300x225.webp"},
                {name: "Icon of the Seas", year: 2024, image: "https://i.postimg.cc/ZYgt0BRK/Icon-of-the-Seas-300x225.webp"},
                {name: "Independence of the Seas", year: 2008, image: "https://i.postimg.cc/2SxBzfwm/Independence-of-the-Seas-300x225.webp"},
                {name: "Jewel of the Seas", year: 2004, image: "https://i.postimg.cc/nzXsY9tc/Jewel-of-the-Seas-300x225.webp"},
                {name: "Legend of the Seas", year: 1995, image: "https://i.postimg.cc/C19RvMFC/LEGEND-OF-THE-SEAS-300x225.webp"},
                {name: "Liberty of the Seas", year: 2007, image: "https://i.postimg.cc/ZYyBWNcw/Liberty-of-the-Seas-300x225.webp"},
                {name: "Mariner of the Seas", year: 2003, image: "https://i.postimg.cc/QxQFbrv5/Mariner-of-the-Seas-300x225.webp"},
                {name: "Navigator of the Seas", year: 2002, image: "https://i.postimg.cc/9Qcrgnjk/Navigator-of-the-Seas-300x225.webp"},
                {name: "Oasis of the Seas", year: 2009, image: "https://i.postimg.cc/PrytJfB6/Oasis-of-the-Seas-300x225.webp"},
                {name: "Odyssey of the Seas", year: 2021, image: "https://i.postimg.cc/Fzm4FwG5/Odyssey-of-the-Seas-300x225.webp"},
                {name: "Ovation of the Seas", year: 2016, image: "https://i.postimg.cc/vTzd4XS1/Ovation-of-the-Seas-300x225.webp"},
                {name: "Quantum of the Seas", year: 2014, image: "https://i.postimg.cc/SsgrjMfS/Quantum-of-the-Seas-300x225.webp"},
                {name: "Radiance of the Seas", year: 2001, image: "https://i.postimg.cc/rsz94wfS/Radiance-of-the-Seas-300x225.webp"},
                {name: "Rhapsody of the Seas", year: 1997, image: "https://i.postimg.cc/zXbjX3bN/Rhapsody-of-the-Seas-300x225.webp"},
                {name: "Serenade of the Seas", year: 2003, image: "https://i.postimg.cc/02TC6xDw/Serenade-of-the-Seas-300x225.webp"},
                {name: "Spectrum of the Seas", year: 2019, image: "https://i.postimg.cc/bv8HTT6Y/Spectrum-of-the-Seas-300x225.webp"},
                {name: "Star of the Seas", year: 2025, image: "https://i.postimg.cc/284SNRdw/Star-of-the-Seas.jpg"},
                {name: "Symphony of the Seas", year: 2018, image: "https://i.postimg.cc/0NfGHw3Y/Symphony-of-the-Seas-300x225.webp"},
                {name: "Utopia of the Seas", year: 2024, image: "https://i.postimg.cc/Z54KT7Vh/Utopia-of-the-Seas.jpg"}
            ],
            "Norwegian Cruise Line": [
                {name: "Norwegian Aqua", year: 2025, image: "https://i.postimg.cc/T3hRkwRy/NORWEIGAN-AQUA-300x202.png"},
                {name: "Norwegian Bliss", year: 2018, image: "https://i.postimg.cc/jC05VYZV/Norwegian-Bliss-300x225.webp"},
                {name: "Norwegian Breakaway", year: 2013, image: "https://i.postimg.cc/MHx6tmTx/Norwegian-Breakaway-300x225.webp"},
                {name: "Norwegian Dawn", year: 2002, image: "https://i.postimg.cc/5yMB3TL0/Norwegian-Dawn-300x225.webp"},
                {name: "Norwegian Encore", year: 2019, image: "https://i.postimg.cc/wxhcvxYs/Norwegian-Encore-300x225.webp"},
                {name: "Norwegian Epic", year: 2010, image: "https://i.postimg.cc/VLm9byzZ/Norwegian-Epic-300x225.webp"},
                {name: "Norwegian Escape", year: 2015, image: "https://i.postimg.cc/CL7GGv1h/Norwegian-Escape-300x225.webp"},
                {name: "Norwegian Getaway", year: 2014, image: "https://i.postimg.cc/x8GFC77H/Norwegian-Getaway-300x225.webp"},
                {name: "Norwegian Jade", year: 2006, image: "https://i.postimg.cc/4xxFfW17/Norwegian-Jade-300x225.webp"},
                {name: "Norwegian Jewel", year: 2005, image: "https://i.postimg.cc/dtq565pH/Norwegian-Jewel-300x225.webp"},
                {name: "Norwegian Joy", year: 2017, image: "https://i.postimg.cc/TPW01F5w/Norwegian-Joy-300x225.webp"},
                {name: "Norwegian Luna", year: 2026, image: "https://i.postimg.cc/WzZb4xBs/NORWEGIAN-LUNA.jpg"},
                {name: "Norwegian Pearl", year: 2006, image: "https://i.postimg.cc/sxK9bRqn/Norwegian-Pearl-300x225.webp"},
                {name: "Norwegian Prima", year: 2022, image: "https://i.postimg.cc/xjPRXK8K/Norwegian-Prima-300x225.webp"},
                {name: "Norwegian Sky", year: 1999, image: "https://i.postimg.cc/yYYTck32/Norwegian-Sky-300x225.webp"},
                {name: "Norwegian Spirit", year: 1998, image: "https://i.postimg.cc/L8JBQwTT/Norwegian-Spirit-300x225.webp"},
                {name: "Norwegian Star", year: 2001, image: "https://i.postimg.cc/qvWcPwDd/Norwegian-Star-300x225.webp"},
                {name: "Norwegian Sun", year: 2001, image: "https://i.postimg.cc/FsB0SG4J/Norwegian-Sun-300x225.webp"},
                {name: "Norwegian Viva", year: 2023, image: "https://i.postimg.cc/g09RSJrz/Norwegian-Viva-300x225.webp"},
                {name: "Norwegian Gem", year: 2007, image: "https://i.postimg.cc/90fqRwgp/Norwegian-Gem-300x225.webp"},
                {name: "Pride of America", year: 2005, image: "https://i.postimg.cc/59Pzcpjk/Pride-of-America-300x225.webp"}
            ],
            "CELEBRITY": [
                {name: "Celebrity Apex", year: 2020, image: "https://i.postimg.cc/76hB396G/Celebrity-Apex-300x225.webp"},
                {name: "Celebrity Ascent", year: 2023, image: "https://i.postimg.cc/zvR0MfTq/Celebrity-Ascent-300x225.webp"},
                {name: "Celebrity Beyond", year: 2022, image: "https://i.postimg.cc/JzmCNwWs/Celebrity-Beyond-300x225.webp"},
                {name: "Celebrity Constellation", year: 2002, image: "https://i.postimg.cc/N0jhn1FY/Celebrity-Constellation-300x225.webp"},
                {name: "Celebrity Eclipse", year: 2010, image: "https://i.postimg.cc/TwKzdfn4/Celebrity-Eclipse-300x225.webp"},
                {name: "Celebrity Edge", year: 2018, image: "https://i.postimg.cc/1X6bFBC0/Celebrity-Edge-300x225.webp"},
                {name: "Celebrity Equinox", year: 2009, image: "https://i.postimg.cc/L6tr6yZ2/Celebrity-Equinox-300x225.webp"},
                {name: "Celebrity Flora", year: 2019, image: "https://i.postimg.cc/g2G1wvvR/Celebrity-Flora-300x225.webp"},
                {name: "Celebrity Infinity", year: 2001, image: "https://i.postimg.cc/jj59ct3S/Celebrity-Infinity-300x225.webp"},
                {name: "Celebrity Millennium", year: 2000, image: "https://i.postimg.cc/KYHWswCr/Celebrity-Millennium-300x225.webp"},
                {name: "Celebrity Reflection", year: 2012, image: "https://i.postimg.cc/C5yQwDhR/Celebrity-Reflection-300x225.webp"},
                {name: "Celebrity Silhouette", year: 2011, image: "https://i.postimg.cc/RhcbhFhX/Celebrity-Silhouette-300x225.webp"},
                {name: "Celebrity Solstice", year: 2008, image: "https://i.postimg.cc/1R6dJWBw/Celebrity-Solstice-300x225.webp"},
                {name: "Celebrity Summit", year: 2001, image: "https://i.postimg.cc/VL8VTjZT/Celebrity-Summit-300x225.webp"},
                {name: "Celebrity Xce", year: 2025, image: "https://i.postimg.cc/ZKxMhC1q/Celebrity-Xcel-300x225.webp"}
            ],
            "COSTA": [
                {name: "Costa Deliziosa", year: 2010, image: "https://i.postimg.cc/ryCJD7gn/Costa-Deliziosa-300x225.webp"},
                {name: "Costa Diadema", year: 2014, image: "https://i.postimg.cc/Fsrx3GB9/Costa-Diadema-300x225.webp"},
                {name: "Costa Fascinosa", year: 2012, image: "https://i.postimg.cc/TYtJ9mzn/Costa-Fascinosa-300x225.webp"},
                {name: "Costa Favolosa", year: 2011, image: "https://i.postimg.cc/t4ft0bCT/Costa-Favolosa-300x225.webp"},
                {name: "Costa Fortuna", year: 2003, image: "https://i.postimg.cc/Ssb6sG9b/Costa-Fortuna-300x225.webp"},
                {name: "Costa Pacifica", year: 2009, image: "https://i.postimg.cc/bNwQsrZr/Costa-Pacifica-300x225.webp"},
                {name: "Costa Serena", year: 2007, image: "https://i.postimg.cc/7Z9Pb3WJ/Costa-Serena.jpg"},
                {name: "Costa Smeralda", year: 2019, image: "https://i.postimg.cc/YCgj9Bzj/Costa-Smeralda-300x225.webp"},
                {name: "Costa Toscana", year: 2021, image: "https://i.postimg.cc/FRK90M3y/Costa-Toscana-300x225.webp"},
                {name: "Costa Firenze", year: 2021, image: "https://i.postimg.cc/sgRsTQ5D/Costa-Firenze-300x225.webp"}
            ]
        };
        // --- ADVISORS DATA ---
        const advisors = {
            "lior": "ליאור דובינובסקי / Lior Dovinovsky| יועץ שייט | 03-3106454 | lior@balicruise.co.il",
            "tatiana": "טטיאנה לאונוב/Tatyana Leonov | יועצת שייט | 03-3106454 | tatiana@balicruise.co.il",
            "koren": "קורן אבסעיד | Koren avsaid | מנהל מחלקת שייט | 03-3106454 | Koren@balicruise.co.il",
            "yarden": "ירדן שקד | Yarden shaked | יועץ שייט | 03-3106454 | Yarden@balicruise.co.il",
            "nir": "ניר | Nir | יועץ שייט | 03-3106454 | nir@balicruise.co.il"
        };
        // Guarantee message
        const guaranteeMessage = "מיקום החדר ייקבע על ידי חברת השייט";
        // Room types that require details
        const detailRoomTypes = [
            "פנימי עם בחירת מיקום",
            "חלון עם בחירת מיקום",
            "מרפסת לים עם בחירת מיקום",
            "מרפסת לפנים האונייה עם בחירת מיקום"
        ];
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('offerDate').valueAsDate = new Date();
            populateShips();
            addRoom();
            addFlight(); // Add first flight by default
            setupPasteListeners();
            updatePreview();
        });
   
        // --- IMAGE PASTE LOGIC (only for itinerary) ---
        function setupPasteListeners() {
            const itineraryTarget = document.getElementById('itineraryPasteTarget');
            itineraryTarget.addEventListener('paste', (e) => handlePaste(e, 'previewItineraryImage', itineraryTarget));
        }
        function handlePaste(event, previewImageId, pasteTargetElement) {
            event.preventDefault();
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            for (const item of items) {
                if (item.type.startsWith('image/')) {
                    const blob = item.getAsFile();
                    if (blob) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imgElement = document.getElementById(previewImageId);
                            imgElement.src = e.target.result;
                            pasteTargetElement.innerHTML = `<span class="text-green-600 font-semibold">תמונה הועלתה בהצלחה!</span>`;
                            pasteTargetElement.classList.remove('border-gray-300');
                            pasteTargetElement.classList.add('border-green-500');
                        };
                        reader.readAsDataURL(blob);
                    }
                    return;
                }
            }
        }
        // --- DYNAMIC FORM LOGIC ---
        function populateShips() {
            const cruiseLine = document.getElementById('cruiseLine').value;
            const shipSelect = document.getElementById('shipName');
            shipSelect.innerHTML = '';
            if (cruiseData[cruiseLine]) {
                cruiseData[cruiseLine].forEach(ship => {
                    const option = document.createElement('option');
                    option.value = ship.name;
                    option.textContent = `${ship.name} (${ship.year})`;
                    shipSelect.appendChild(option);
                });
            }
            updatePreview();
        }
        function addRoom() {
            const template = document.getElementById('roomTemplate');
            const clone = template.content.cloneNode(true);
            document.getElementById('roomsContainer').appendChild(clone);
            updatePreview();
        }
        function removeRoom(button) {
            button.closest('.room-entry').remove();
            updatePreview();
        }
        function addFlight() {
            const template = document.getElementById('flightTemplate');
            const clone = template.content.cloneNode(true);
            const container = document.getElementById('flightsContainer');
            container.appendChild(clone);
            const newEntry = container.lastChild;
            const count = container.children.length;
            if (count === 1) {
                newEntry.querySelector('input[name="from"]').value = "תל אביב";
            } else if (count === 2) {
                newEntry.querySelector('input[name="to"]').value = "תל אביב";
            }
            updatePreview();
        }
        function removeFlight(button) {
            button.closest('.flight-entry').remove();
            updatePreview();
        }
        function addTransfer() {
            const template = document.getElementById('transferTemplate');
            const clone = template.content.cloneNode(true);
            document.getElementById('transfersContainer').appendChild(clone);
            updatePreview();
        }
        function removeTransfer(button) {
            button.closest('.transfer-entry').remove();
            updatePreview();
        }
        function toggleTransfersCancelDetails() {
            const cancellable = document.getElementById('transfersCancellable').checked;
            const detailsDiv = document.getElementById('transfersCancelDetails');
            if (cancellable) {
                detailsDiv.classList.remove('hidden');
            } else {
                detailsDiv.classList.add('hidden');
            }
            updatePreview();
        }
        function toggleRoomDetails(selectElement) {
            const roomEntry = selectElement.closest('.room-entry');
            const detailsDiv = roomEntry.querySelector('#roomDetails');
            if (detailsDiv) {
                if (detailRoomTypes.includes(selectElement.value)) {
                    detailsDiv.classList.remove('hidden');
                } else {
                    detailsDiv.classList.add('hidden');
                }
            }
            updatePreview();
        }
        // --- PREVIEW UPDATE LOGIC ---
        function updatePreview() {
            // Simple text fields
            document.getElementById('previewClientName').textContent = document.getElementById('clientName').value || '___';
       
            const offerDate = document.getElementById('offerDate').value;
            if(offerDate) {
                 document.getElementById('previewDate').textContent = `תאריך: ${new Date(offerDate).toLocaleDateString('he-IL')}`;
            } else {
                 document.getElementById('previewDate').textContent = `תאריך: ${new Date().toLocaleDateString('he-IL')}`;
            }
            document.getElementById('previewCruiseLine').textContent = document.getElementById('cruiseLine').value;
            const shipName = document.getElementById('shipName').value;
            document.getElementById('previewShipName').textContent = shipName;
            document.getElementById('previewCruiseDuration').textContent = document.getElementById('cruiseDuration').value || '7';
            document.getElementById('previewCruiseDate').textContent = document.getElementById('cruiseDate').value || '___';
       
            // Advisor
            const selectedAdvisor = document.getElementById('advisor').value;
            document.getElementById('previewAdvisor').textContent = advisors[selectedAdvisor];
       
            // Rooms and Total Price
            const roomsContainer = document.getElementById('roomsContainer');
            const previewRoomsContainer = document.getElementById('previewRoomsContainer');
            previewRoomsContainer.innerHTML = '';
            let totalPrice = 0;
       
            const roomEntries = roomsContainer.querySelectorAll('.room-entry');
            roomEntries.forEach((room, index) => {
                const composition = room.querySelector('select[name="composition"]').value;
                const roomType = room.querySelector('select[name="roomType"]').value;
                const floor = room.querySelector('input[name="floor"]').value;
                const roomNumber = room.querySelector('input[name="roomNumber"]').value;
                const extraDesc = room.querySelector('textarea[name="extraDesc"]').value;
                const costInput = room.querySelector('input[name="roomCost"]');
                const cost = costInput ? costInput.value : '';
                const costValue = parseFloat(cost) || 0;
                totalPrice += costValue;
           
                if (composition || roomType || cost) {
                    let roomDesc = '';
                    if (composition) {
                        roomDesc += `הרכב: ${composition}`;
                    }
                    if (roomType) {
                        let typePart = roomType;
                        if (roomType.includes('גרנטי')) {
                            typePart += ` - ${guaranteeMessage}`;
                        } else if (floor || roomNumber) {
                            typePart += ` (קומה: ${floor || ''}${floor && roomNumber ? ', ' : ''}חדר: ${roomNumber || ''})`;
                        }
                        roomDesc += ` | תיאור: ${typePart}`;
                    }
                    if (extraDesc) {
                        roomDesc += ` | נוסף: ${extraDesc}`;
                    }
           
                    const roomDiv = document.createElement('div');
                    roomDiv.className = 'border p-3 rounded-lg bg-white';
                    roomDiv.innerHTML = `<p><strong>חדר ${index + 1}:</strong> ${roomDesc || 'לא צוין תיאור'}</p>
                                         <p class="font-semibold text-right">עלות: $${costValue.toLocaleString()}</p>`;
                    previewRoomsContainer.appendChild(roomDiv);
                }
            });

            // Inclusions
            const inclusionsList = document.getElementById('previewInclusions');
            inclusionsList.innerHTML = '';
            if (document.getElementById('includeMeals').checked) {
                const li = document.createElement('li');
                li.textContent = 'כולל 3 ארוחות מלאות ביום, מיסים ובופה עשיר לאורך היום.';
                inclusionsList.appendChild(li);
            }
            if (document.getElementById('includeTips').checked) {
                 const li = document.createElement('li');
                li.textContent = 'כולל תשלום טיפים מראש.';
                inclusionsList.appendChild(li);
            } else {
                const li = document.createElement('li');
                li.textContent = 'לא כולל תשלום טיפים מראש.';
                inclusionsList.appendChild(li);
            }
            const customInclusionsText = document.getElementById('customInclusions').value;
            if (customInclusionsText.trim() !== '') {
                const lines = customInclusionsText.split('\n').filter(line => line.trim() !== '');
                lines.forEach(line => {
                    const li = document.createElement('li');
                    li.textContent = line;
                    inclusionsList.appendChild(li);
                });
            }
             if (inclusionsList.innerHTML === '') {
                 inclusionsList.innerHTML = '<li>אין הכללות מיוחדות.</li>';
             }

            // Flights
            const previewFlightsContainer = document.getElementById('previewFlightsContainer');
            const previewFlightsList = document.getElementById('previewFlightsList');
            previewFlightsList.innerHTML = '';
            const flightsContainer = document.getElementById('flightsContainer');
            const flightEntries = flightsContainer.querySelectorAll('.flight-entry');
            let hasFlights = false;
            flightEntries.forEach((flight) => {
                const from = flight.querySelector('input[name="from"]').value || '___';
                const to = flight.querySelector('input[name="to"]').value || '___';
                const date = flight.querySelector('input[name="date"]').value || '___';
                const takeoff = flight.querySelector('input[name="takeoff"]').value || '___';
                const landing = flight.querySelector('input[name="landing"]').value || '___';
                if (from !== '___' || to !== '___' || date !== '___' || takeoff !== '___' || landing !== '___') {
                    hasFlights = true;
                }
                const p = document.createElement('p');
                p.textContent = `טיסה מ ${from} ל ${to} בתאריך ${date} המראה ${takeoff} נחיתה ${landing}`;
                previewFlightsList.appendChild(p);
            });
            const airline = document.getElementById('airline').value;
            const flightIncludes = document.getElementById('flightIncludes').value;
            const flightFreeText = document.getElementById('flightFreeText').value;
            const flightCost = parseFloat(document.getElementById('flightCost').value) || 0;
            const flightCancellable = document.getElementById('flightCancellable').checked;
            const flightCancelFee = document.getElementById('flightCancelFee').value;
            const flightChangeable = document.getElementById('flightChangeable').checked;
            const flightChangeFee = document.getElementById('flightChangeFee').value;
            const flightNoCancel = document.getElementById('flightNoCancel').checked;

            if (hasFlights || airline || flightIncludes.trim() || flightFreeText || flightCost > 0) {
                previewFlightsContainer.classList.remove('hidden');
                document.getElementById('previewAirline').textContent = `טיסה בחברת תעופה ${airline || '___'}`;
                const includesList = document.getElementById('previewFlightIncludes');
                includesList.innerHTML = '';
                flightIncludes.split('\n').forEach(line => {
                    if (line.trim()) {
                        const li = document.createElement('li');
                        li.textContent = line.trim();
                        includesList.appendChild(li);
                    }
                });
                document.getElementById('previewFlightFreeText').textContent = flightFreeText || '';
                document.getElementById('previewFlightCost').textContent = `עלות: $${flightCost.toLocaleString()}`;
                const conditionsDiv = document.getElementById('previewFlightConditions');
                conditionsDiv.innerHTML = '';
                if (flightCancellable && flightCancelFee) {
                    conditionsDiv.innerHTML += `<p>ביטול – ניתן לביטול עד 72 שעות לפני ההמראה ב ${flightCancelFee} לנוסע</p>`;
                }
                if (flightChangeable && flightChangeFee) {
                    conditionsDiv.innerHTML += `<p>שינוי – ניתן לשינוי עד 72 שעות לפני ההמראה ב ${flightChangeFee} לנוסע ומותנה באותה מחלקת שירות, במידה ואין משלמים הפרשי מחירים.</p>`;
                }
                if (flightNoCancel) {
                    conditionsDiv.innerHTML += `<p>ללא אפשרות ביטול/ שינוי מרגע אישור ההזמנה</p>`;
                }
                totalPrice += flightCost;
            } else {
                previewFlightsContainer.classList.add('hidden');
            }

            // Hotel
            const previewHotelContainer = document.getElementById('previewHotelContainer');
            const hotelName = document.getElementById('hotelName').value;
            const hotelRoomDesc = document.getElementById('hotelRoomDesc').value;
            const hotelPension = document.getElementById('hotelPension').value;
            const hotelCost = parseFloat(document.getElementById('hotelCost').value) || 0;
            const hotelCancellable = document.getElementById('hotelCancellable').checked;
            const hotelCancelFee = document.getElementById('hotelCancelFee').value;
            const hotelChangeable = document.getElementById('hotelChangeable').checked;
            const hotelChangeFee = document.getElementById('hotelChangeFee').value;
            const hotelNoCancel = document.getElementById('hotelNoCancel').checked;

            if (hotelName || hotelCost > 0) {
                previewHotelContainer.classList.remove('hidden');
                document.getElementById('previewHotelName').textContent = `שם המלון: ${hotelName || '___'}`;
                document.getElementById('previewHotelRoomDesc').textContent = `חדר, הרכב ומחיר: ${hotelRoomDesc || '___'}`;
                document.getElementById('previewHotelPension').textContent = `פנסיון: ${hotelPension || '___'}`;
                document.getElementById('previewHotelCost').textContent = `עלות: $${hotelCost.toLocaleString()}`;
                const conditionsDiv = document.getElementById('previewHotelConditions');
                conditionsDiv.innerHTML = '';
                if (hotelCancellable && hotelCancelFee) {
                    conditionsDiv.innerHTML += `<p>ביטול – ניתן לביטול עד 72 שעות לפני ההגעה ב ${hotelCancelFee} לנוסע</p>`;
                }
                if (hotelChangeable && hotelChangeFee) {
                    conditionsDiv.innerHTML += `<p>שינוי – ניתן לשינוי עד 72 שעות לפני ההגעה ב ${hotelChangeFee} לנוסע ומותנה באותה מחלקת שירות, במידה ואין משלמים הפרשי מחירים.</p>`;
                }
                if (hotelNoCancel) {
                    conditionsDiv.innerHTML += `<p>ללא אפשרות ביטול/ שינוי מרגע אישור ההזמנה</p>`;
                }
                totalPrice += hotelCost;
            } else {
                previewHotelContainer.classList.add('hidden');
            }

            // Transfers
            const previewTransfersContainer = document.getElementById('previewTransfersContainer');
            const previewTransfersList = document.getElementById('previewTransfersList');
            previewTransfersList.innerHTML = '';
            const transfersContainer = document.getElementById('transfersContainer');
            const transferEntries = transfersContainer.querySelectorAll('.transfer-entry');
            let hasTransfers = false;
            transferEntries.forEach((transfer, index) => {
                const type = transfer.querySelector('select[name="transferType"]').value || '___';
                const freeText = transfer.querySelector('textarea[name="transferFreeText"]').value || '';
                if (type !== '___' || freeText) {
                    hasTransfers = true;
                }
                const p = document.createElement('p');
                p.textContent = `${index + 1}. ${type}${freeText ? ` - ${freeText}` : ''}`;
                previewTransfersList.appendChild(p);
            });
            const transfersCost = parseFloat(document.getElementById('transfersCost').value) || 0;
            const transfersNoCancel = document.getElementById('transfersNoCancel').checked;
            const transfersCancellable = document.getElementById('transfersCancellable').checked;
            const transfersCancelDate = document.getElementById('transfersCancelDate').value;
            const transfersCancelFee = document.getElementById('transfersCancelFee').value;

            if (hasTransfers || transfersCost > 0) {
                previewTransfersContainer.classList.remove('hidden');
                document.getElementById('previewTransfersCost').textContent = `עלות: $${transfersCost.toLocaleString()}`;
                const conditionsDiv = document.getElementById('previewTransfersConditions');
                conditionsDiv.innerHTML = '';
                if (transfersNoCancel) {
                    conditionsDiv.innerHTML += `<p>ללא אפשרות ביטול / שינוי</p>`;
                } else if (transfersCancellable && transfersCancelDate && transfersCancelFee) {
                    conditionsDiv.innerHTML += `<p>ניתן לביטול עד לתאריך ${transfersCancelDate} בדמי ביטול בסך ${transfersCancelFee}</p>`;
                }
                totalPrice += transfersCost;
            } else {
                previewTransfersContainer.classList.add('hidden');
            }

            // Total
            const previewTotalContainer = document.getElementById('previewTotalContainer');
            const hideTotal = document.getElementById('hideTotal').checked;
            if (hideTotal) {
                previewTotalContainer.classList.add('hidden');
            } else {
                previewTotalContainer.classList.remove('hidden');
                document.getElementById('previewTotalPrice').textContent = totalPrice.toLocaleString();
            }

             // Set ship image automatically based on selection
             const cruiseLine = document.getElementById('cruiseLine').value;
             const ship = cruiseData[cruiseLine]?.find(s => s.name === shipName);
             if (ship && ship.image) {
                 document.getElementById('previewShipImage').src = ship.image;
             } else {
                 document.getElementById('previewShipImage').src = 'https://placehold.co/800x450/e2e8f0/adb5bd?text=תמונת+האונייה';
             }
        }
        // --- PDF GENERATION ---
        async function generatePDF() {
            const element = document.getElementById('preview');
            const clientName = document.getElementById('clientName').value || 'הצעה';
            const shipName = document.getElementById('shipName').value;
            // Temporarily remove shadow for a cleaner PDF edge
            element.classList.remove('shadow-lg');
            // Create temporary container for clones
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            document.body.appendChild(tempContainer);
            // Clone for page 1 (up to total cost)
            const clone1 = element.cloneNode(true);
            clone1.style.width = element.offsetWidth + 'px';
            clone1.style.minHeight = '0';
            clone1.style.height = 'auto'; // Allow natural height
            tempContainer.appendChild(clone1);
            // Remove elements after total in clone1
            const main1 = clone1.querySelector('main');
            const total1 = main1.querySelector('#previewTotalContainer');
            let sib1 = total1.nextElementSibling;
            while (sib1) {
                const next = sib1.nextElementSibling;
                sib1.remove();
                sib1 = next;
            }
            // Remove footer from page 1
            const footer1 = clone1.querySelector('footer');
            if (footer1) footer1.remove();
            // Clone for page 2 (from ship image onwards)
            const clone2 = element.cloneNode(true);
            clone2.style.width = element.offsetWidth + 'px';
            clone2.style.minHeight = '0';
            clone2.style.height = 'auto';
            tempContainer.appendChild(clone2);
            // Remove header from page 2
            const header2 = clone2.querySelector('header');
            if (header2) header2.remove();
            // Remove elements up to and including total from main in page 2
            const main2 = clone2.querySelector('main');
            let child2 = main2.firstElementChild;
            while (child2) {
                const next = child2.nextElementSibling;
                main2.removeChild(child2);
                if (child2.id === 'previewTotalContainer') {
                    break;
                }
                child2 = next;
            }
            // Canvas options
            const canvasOptions = {
                scale: 2,
                useCORS: true,
                letterRendering: true,
                windowWidth: element.scrollWidth,
            };
            // Generate canvases
            const canvas1 = await html2canvas(clone1, { ...canvasOptions, windowHeight: clone1.scrollHeight });
            const canvas2 = await html2canvas(clone2, { ...canvasOptions, windowHeight: clone2.scrollHeight });
            // jsPDF setup
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'a4'
            });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            // Function to add canvas to PDF, scaled to fit one page
            const addCanvasToPdf = (canvas) => {
                const imgData = canvas.toDataURL('image/jpeg', 0.98);
                const imgWidth = canvas.width / 2;
                const imgHeight = canvas.height / 2;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const finalWidth = imgWidth * ratio;
                const finalHeight = imgHeight * ratio;
                pdf.addImage(imgData, 'JPEG', 0, 0, finalWidth, finalHeight);
                // No multi-page logic; fit to one page
            };
            // Add page 1
            addCanvasToPdf(canvas1);
            // Add page 2
            pdf.addPage();
            addCanvasToPdf(canvas2);
            // Save PDF
            pdf.save(`הצעת מחיר ${shipName} - ${clientName}.pdf`);
            // Cleanup
            tempContainer.remove();
            element.classList.add('shadow-lg');
        }
    </script>
    <footer class="text-center mt-8 text-xs text-gray-500">
        פותח על ידי ליאור דובינובסקי
    </footer>
</body>
</html>
